 //TODO: make this file nicer

// Iron Golem
ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
            ~GOLIRO01~                                                             // Iron Golem
            ~GORGRD01~                                                             // Guardian (Iron) Golem (Watcher's Keep)
            ~GORGRD02~                                                             // Guardian (Iron) Golem (Watcher's Keep)
             ~KPGOL04~                                                             // Iron Golem (d'Arnise Keep)
              ~SHIRON~                                                             // Iron Golem (Shapechange spell)
              ~garsaph1~                                                           //who knows? Ask Miloch :P  (note: list pruned, we don't want to recolor Adamantine Golems)
              ~garsaph2~ 
              ~gholim~ 
              ~godgol1~ 
              ~godgol2~ 
              ~golkill2~ 
              ~golsaph1~ 
              ~golsaph2~ 
              ~golsaph3~ 
              ~ritgol0~ 
              ~ritgol1~ 
              ~ritgol2~ 
              ~giaearth~
              ~cbgorgrd~ 
              ~cbgorgre~ 
              ~gartopz1~ 
              ~gartopz2~ 
              ~godgol3~ 
              ~godgol4~ 
              ~godgol5~ 
              ~godgol6~ 
              ~godruby~ 
              ~golruby1~ 
              ~gorsta08~ 
              ~irontomb~ 
              ~kpgol07~ 
              ~tomegol4~ 
              ~yacasas~
             ~dw#vigol~
             ~h#giron~
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY END
PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_validity.tpp~                                    // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
PATCH_IF valid AND LONG_AT 0x28 = 32516 BEGIN // GOLEM_IRON
  PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_reindex.tpp~                                   // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
// =============================================================================== // the actual work starts from here
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "51" END                                                // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "52" END                                                // mark opcode #52 (Colour: Very Bright by RGB) for deletion
SET opcode = "51"                                                                  // effect: #51 (Colour: Strong/Dark by RGB)
SET target = "1"                                                                   // target: 1 (self)
SET timing = "9"                                                                   // timing mode: 9 (permanent after death)
SET parameter1 = "-1261572608"                                                     // param1: (color designation)
SET parameter2 = "2"                                                               // param2: 2 (location - major color)
SET parameter3 = "0"                                                               // param3: 0
SET parameter4 = "0"                                                               // param4: 0
SET power = "0"                                                                    // power: 0
SET resist_dispel = "0"                                                            // dispel/resistance: 0 (non-magical)
SET duration = "0"                                                                 // duration: 0
SET probability1 = "100"                                                           // probability1: 100%
SET probability2 = "0"                                                             // probability2: 0%
SET dicenumber = "0"                                                               // dicenumber: 0
SET dicesize = "0"                                                                 // dicesize: 0
SET savingthrow = "0"                                                              // saving throw type: 0 (none)
SET savebonus = "0"                                                                // save bonus: 0
SET school = "0"                                                                   // school: 0 (schoolless)
SET lowestafflvl = "0"                                                             // lowest level affected: 0
SET highestafflvl = "0"                                                            // highest level affected: 0
SET casterx = "0"                                                                  // casterx: 0
SET castery = "0"                                                                  // castery: 0
SET targetx = "0"                                                                  // targetx: 0
SET targety = "0"                                                                  // targety: 0
SET casterlvl  = "0"                                                               // caster level: 0
SET sectype = "0"                                                                  // secondary type: 0
SPRINT ~resource~ ~~                                                               // resref: none
SPRINT ~resource2~ ~~                                                              // resref2: none
SPRINT ~resource3~ ~~                                                              // resref3: none
SPRINT ~vvcresource~ ~~                                                            // vvcresref: none
SPRINT ~effsource~ ~~                                                              // effsource: none
SPRINT ~effvar~ ~~                                                                 // effvar: none
LAUNCH_PATCH_MACRO ADD_CRE_EFFECT                                                // add new creature effect
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
WRITE_BYTE  0x2E "23"                                                              // major color (Light Copper)
// =============================================================================== // the actual work ends here
END                                                                                // ends file validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block



// Stone Golem

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~GOLSTO01~                                                           // Stone Golem
               ~DSTONE1~                                                           // Stone Golem (Rayic Gethras' home)
               ~KPGOL03~                                                           // Stone Golem (d'Arnise Keep)
               ~KPGOL05~                                                           // Stone Golem (d'Arnise Keep)
               ~STGOL01~                                                           // Stone Golem (Planar Prison)
              ~TOMEGOL3~                                                           // Stone Golem (Golem Manual)
              ~DW#DRCTG~                                                           // Stone Golem (Stratagems)
              ~H#GSTONE~                                                           // Stone Golem (Stratagems)
              ~UDDOOR07~                                                           // Stone Golem (Stratagems - Improved Drow component)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY END
PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_validity.tpp~                                    // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
PATCH_IF valid AND LONG_AT 0x28 = 32519 BEGIN // GOLEM_CLAY
  PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_reindex.tpp~                                   // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
// =============================================================================== // the actual work starts from here
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "51" END                                                // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "52" END                                                // mark opcode #52 (Colour: Very Bright by RGB) for deletion
SET opcode = "52"                                                                  // effect: #52 (Colour: Very Bright by RGB)
SET target = "1"                                                                   // target: 1 (self)
SET timing = "9"                                                                   // timing mode: 9 (permanent after death)
SET parameter1 = "117900288"                                                       // param1: (color designation)
SET parameter2 = "2"                                                               // param2: 2 (location - major color)
SET parameter3 = "0"                                                               // param3: 0
SET parameter4 = "0"                                                               // param4: 0
SET power = "0"                                                                    // power: 0
SET resist_dispel = "0"                                                            // dispel/resistance: 0 (non-magical)
SET duration = "0"                                                                 // duration: 0
SET probability1 = "100"                                                           // probability1: 100%
SET probability2 = "0"                                                             // probability2: 0%
SET dicenumber = "0"                                                               // dicenumber: 0
SET dicesize = "0"                                                                 // dicesize: 0
SET savingthrow = "0"                                                              // saving throw type: 0 (none)
SET savebonus = "0"                                                                // save bonus: 0
SET school = "0"                                                                   // school: 0 (schoolless)
SET lowestafflvl = "0"                                                             // lowest level affected: 0
SET highestafflvl = "0"                                                            // highest level affected: 0
SET casterx = "0"                                                                  // casterx: 0
SET castery = "0"                                                                  // castery: 0
SET targetx = "0"                                                                  // targetx: 0
SET targety = "0"                                                                  // targety: 0
SET casterlvl  = "0"                                                               // caster level: 0
SET sectype = "0"                                                                  // secondary type: 0
SPRINT ~resource~ ~~                                                               // resref: none
SPRINT ~resource2~ ~~                                                              // resref2: none
SPRINT ~resource3~ ~~                                                              // resref3: none
SPRINT ~vvcresource~ ~~                                                            // vvcresref: none
SPRINT ~effsource~ ~~                                                              // effsource: none
SPRINT ~effvar~ ~~                                                                 // effvar: none
LAUNCH_PATCH_MACRO ADD_CRE_EFFECT                                                // add new creature effect
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
WRITE_BYTE  0x2E "5"                                                               // major color (Light Silver)
// =============================================================================== // the actual work ends here
END                                                                                // ends file validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block



// Flesh Golem

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~GOLFLE01~                                                           // Flesh Golem
               ~KPGOL01~                                                           // Flesh Golem (d'Arnise Keep)
               ~KPGOL06~                                                           // Flesh Golem (d'Arnise Keep)
              ~TOMEGOL1~                                                           // Flesh Golem (Golem Manual)
                ~XGOLEM~                                                           // Flesh Golem (Xzar's quest)
               ~XGOLEM1~                                                           // Flesh Golem
               ~H#GFLES~                                                           // Flesh Golem
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY END
PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_validity.tpp~                                    // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
PATCH_IF valid AND LONG_AT 0x28 = 32519 BEGIN // GOLEM_CLAY
  PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_reindex.tpp~                                   // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
// =============================================================================== // the actual work starts from here
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "51" END                                                // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "52" END                                                // mark opcode #52 (Colour: Very Bright by RGB) for deletion
SET opcode = "52"                                                                  // effect: #52 (Colour: Very Bright by RGB)
SET target = "1"                                                                   // target: 1 (self)
SET timing = "9"                                                                   // timing mode: 9 (permanent after death)
SET parameter1 = "84215808"                                                        // param1: (color designation)
SET parameter2 = "2"                                                               // param2: 2 (location - major color)
SET parameter3 = "0"                                                               // param3: 0
SET parameter4 = "0"                                                               // param4: 0
SET power = "0"                                                                    // power: 0
SET resist_dispel = "0"                                                            // dispel/resistance: 0 (non-magical)
SET duration = "0"                                                                 // duration: 0
SET probability1 = "100"                                                           // probability1: 100%
SET probability2 = "0"                                                             // probability2: 0%
SET dicenumber = "0"                                                               // dicenumber: 0
SET dicesize = "0"                                                                 // dicesize: 0
SET savingthrow = "0"                                                              // saving throw type: 0 (none)
SET savebonus = "0"                                                                // save bonus: 0
SET school = "0"                                                                   // school: 0 (schoolless)
SET lowestafflvl = "0"                                                             // lowest level affected: 0
SET highestafflvl = "0"                                                            // highest level affected: 0
SET casterx = "0"                                                                  // casterx: 0
SET castery = "0"                                                                  // castery: 0
SET targetx = "0"                                                                  // targetx: 0
SET targety = "0"                                                                  // targety: 0
SET casterlvl  = "0"                                                               // caster level: 0
SET sectype = "0"                                                                  // secondary type: 0
SPRINT ~resource~ ~~                                                               // resref: none
SPRINT ~resource2~ ~~                                                              // resref2: none
SPRINT ~resource3~ ~~                                                              // resref3: none
SPRINT ~vvcresource~ ~~                                                            // vvcresref: none
SPRINT ~effsource~ ~~                                                              // effsource: none
SPRINT ~effvar~ ~~                                                                 // effvar: none
LAUNCH_PATCH_MACRO ADD_CRE_EFFECT                                                // add new creature effect
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
WRITE_BYTE  0x2E "4"                                                               // major color (Auburn)
// =============================================================================== // the actual work ends here
END                                                                                // ends file validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block



// Sand Golem

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~GOLSAN01~                                                           // Sand Golem
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY END
PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_validity.tpp~                                    // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
PATCH_IF valid AND LONG_AT 0x28 = 32519 BEGIN // GOLEM_CLAY
  PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_reindex.tpp~                                   // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
// =============================================================================== // the actual work starts from here
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "51" END                                                // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "52" END                                                // mark opcode #52 (Colour: Very Bright by RGB) for deletion
SET opcode = "52"                                                                  // effect: #52 (Colour: Very Bright by RGB)
SET target = "1"                                                                   // target: 1 (self)
SET timing = "9"                                                                   // timing mode: 9 (permanent after death)
SET parameter1 = "67569408"                                                        // param1: (color designation)
SET parameter2 = "2"                                                               // param2: 2 (location - major color)
SET parameter3 = "0"                                                               // param3: 0
SET parameter4 = "0"                                                               // param4: 0
SET power = "0"                                                                    // power: 0
SET resist_dispel = "0"                                                            // dispel/resistance: 0 (non-magical)
SET duration = "0"                                                                 // duration: 0
SET probability1 = "100"                                                           // probability1: 100%
SET probability2 = "0"                                                             // probability2: 0%
SET dicenumber = "0"                                                               // dicenumber: 0
SET dicesize = "0"                                                                 // dicesize: 0
SET savingthrow = "0"                                                              // saving throw type: 0 (none)
SET savebonus = "0"                                                                // save bonus: 0
SET school = "0"                                                                   // school: 0 (schoolless)
SET lowestafflvl = "0"                                                             // lowest level affected: 0
SET highestafflvl = "0"                                                            // highest level affected: 0
SET casterx = "0"                                                                  // casterx: 0
SET castery = "0"                                                                  // castery: 0
SET targetx = "0"                                                                  // targetx: 0
SET targety = "0"                                                                  // targety: 0
SET casterlvl  = "0"                                                               // caster level: 0
SET sectype = "0"                                                                  // secondary type: 0
SPRINT ~resource~ ~~                                                               // resref: none
SPRINT ~resource2~ ~~                                                              // resref2: none
SPRINT ~resource3~ ~~                                                              // resref3: none
SPRINT ~vvcresource~ ~~                                                            // vvcresref: none
SPRINT ~effsource~ ~~                                                              // effsource: none
SPRINT ~effvar~ ~~                                                                 // effvar: none
LAUNCH_PATCH_MACRO ADD_CRE_EFFECT                                                // add new creature effect
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
WRITE_BYTE  0x2E "37"                                                              // major color (Dark Dirty Yellow)
// =============================================================================== // the actual work ends here
END                                                                                // ends file validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block



// Juggernaut Golem

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~GOLJUG01~                                                           // Juggernaut Golem
              ~JUGJUG01~                                                           // Juggernaut Golem (Jermien's quest, Umar Hills)
              ~JUGJUG02~                                                           // Juggernaut Golem (Jermien's quest, Umar Hills)
              ~TOMEGOL4~                                                           // Juggernaut Golem (Golem Manual)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY END
PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_validity.tpp~                                    // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
PATCH_IF valid AND LONG_AT 0x28 = 32519 BEGIN // GOLEM_CLAY
  PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_reindex.tpp~                                   // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
// =============================================================================== // the actual work starts from here
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "51" END                                                // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "52" END                                                // mark opcode #52 (Colour: Very Bright by RGB) for deletion
SET opcode = "52"                                                                  // effect: #52 (Colour: Very Bright by RGB)
SET target = "1"                                                                   // target: 1 (self)
SET timing = "9"                                                                   // timing mode: 9 (permanent after death)
SET parameter1 = "201984000"                                                       // param1: (color designation)
SET parameter2 = "2"                                                               // param2: 2 (location - major color)
SET parameter3 = "0"                                                               // param3: 0
SET parameter4 = "0"                                                               // param4: 0
SET power = "0"                                                                    // power: 0
SET resist_dispel = "0"                                                            // dispel/resistance: 0 (non-magical)
SET duration = "0"                                                                 // duration: 0
SET probability1 = "100"                                                           // probability1: 100%
SET probability2 = "0"                                                             // probability2: 0%
SET dicenumber = "0"                                                               // dicenumber: 0
SET dicesize = "0"                                                                 // dicesize: 0
SET savingthrow = "0"                                                              // saving throw type: 0 (none)
SET savebonus = "0"                                                                // save bonus: 0
SET school = "0"                                                                   // school: 0 (schoolless)
SET lowestafflvl = "0"                                                             // lowest level affected: 0
SET highestafflvl = "0"                                                            // highest level affected: 0
SET casterx = "0"                                                                  // casterx: 0
SET castery = "0"                                                                  // castery: 0
SET targetx = "0"                                                                  // targetx: 0
SET targety = "0"                                                                  // targety: 0
SET casterlvl  = "0"                                                               // caster level: 0
SET sectype = "0"                                                                  // secondary type: 0
SPRINT ~resource~ ~~                                                               // resref: none
SPRINT ~resource2~ ~~                                                              // resref2: none
SPRINT ~resource3~ ~~                                                              // resref3: none
SPRINT ~vvcresource~ ~~                                                            // vvcresref: none
SPRINT ~effsource~ ~~                                                              // effsource: none
SPRINT ~effvar~ ~~                                                                 // effvar: none
LAUNCH_PATCH_MACRO ADD_CRE_EFFECT                                                // add new creature effect
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
WRITE_BYTE  0x2E "10"                                                              // major color (Light Pure Gold)
// =============================================================================== // the actual work ends here
END                                                                                // ends file validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block



// Ice Mephit

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~MEPICE01~                                                           // Ice Mephit
              ~MEPICE02~                                                           // Ice Mephit
              ~OBSICE02~                                                           // Ice Mephit
               ~RR#MICE~                                                           // Ice Mephit (gated)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY END
PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_validity.tpp~                                    // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
PATCH_IF valid AND LONG_AT 0x28 = 32515 BEGIN // IMP
  PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_reindex.tpp~                                   // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
// =============================================================================== // the actual work starts from here
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "51" END                                                // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "52" END                                                // mark opcode #52 (Colour: Very Bright by RGB) for deletion
SET opcode = "52"                                                                  // effect: #52 (Colour: Very Bright by RGB)
SET target = "1"                                                                   // target: 1 (self)
SET timing = "9"                                                                   // timing mode: 9 (permanent after death)
SET parameter1 = "420087552"                                                       // param1: (color designation)
SET parameter2 = "2"                                                               // param2: 2 (location - major color)
SET parameter3 = "0"                                                               // param3: 0
SET parameter4 = "0"                                                               // param4: 0
SET power = "0"                                                                    // power: 0
SET resist_dispel = "0"                                                            // dispel/resistance: 0 (non-magical)
SET duration = "0"                                                                 // duration: 0
SET probability1 = "100"                                                           // probability1: 100%
SET probability2 = "0"                                                             // probability2: 0%
SET dicenumber = "0"                                                               // dicenumber: 0
SET dicesize = "0"                                                                 // dicesize: 0
SET savingthrow = "0"                                                              // saving throw type: 0 (none)
SET savebonus = "0"                                                                // save bonus: 0
SET school = "0"                                                                   // school: 0 (schoolless)
SET lowestafflvl = "0"                                                             // lowest level affected: 0
SET highestafflvl = "0"                                                            // highest level affected: 0
SET casterx = "0"                                                                  // casterx: 0
SET castery = "0"                                                                  // castery: 0
SET targetx = "0"                                                                  // targetx: 0
SET targety = "0"                                                                  // targety: 0
SET casterlvl  = "0"                                                               // caster level: 0
SET sectype = "0"                                                                  // secondary type: 0
SPRINT ~resource~ ~~                                                               // resref: none
SPRINT ~resource2~ ~~                                                              // resref2: none
SPRINT ~resource3~ ~~                                                              // resref3: none
SPRINT ~vvcresource~ ~~                                                            // vvcresref: none
SPRINT ~effsource~ ~~                                                              // effsource: none
SPRINT ~effvar~ ~~                                                                 // effvar: none
LAUNCH_PATCH_MACRO ADD_CRE_EFFECT                                                // add new creature effect
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
WRITE_BYTE  0x2E "71"                                                              // major color (Frost Blue)
// =============================================================================== // the actual work ends here
END                                                                                // ends file validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block



// Radiant Mephit

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~MEPRAD01~                                                           // Radiant Mephit
              ~MEPRAD02~                                                           // Radiant Mephit
               ~RR#MRAD~                                                           // Radiant Mephit (gated)
                ~FAMRAD~                                                             // Radiant Mephit - familiar
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY END
PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_validity.tpp~                                    // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
PATCH_IF valid AND LONG_AT 0x28 = 32515 BEGIN // IMP
  PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_reindex.tpp~                                   // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
// =============================================================================== // the actual work starts from here
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "51" END                                                // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "52" END                                                // mark opcode #52 (Colour: Very Bright by RGB) for deletion
SET opcode = "52"                                                                  // effect: #52 (Colour: Very Bright by RGB)
SET target = "1"                                                                   // target: 1 (self)
SET timing = "9"                                                                   // timing mode: 9 (permanent after death)
SET parameter1 = "168299008"                                                       // param1: (color designation)
SET parameter2 = "2"                                                               // param2: 2 (location - major color)
SET parameter3 = "0"                                                               // param3: 0
SET parameter4 = "0"                                                               // param4: 0
SET power = "0"                                                                    // power: 0
SET resist_dispel = "0"                                                            // dispel/resistance: 0 (non-magical)
SET duration = "0"                                                                 // duration: 0
SET probability1 = "100"                                                           // probability1: 100%
SET probability2 = "0"                                                             // probability2: 0%
SET dicenumber = "0"                                                               // dicenumber: 0
SET dicesize = "0"                                                                 // dicesize: 0
SET savingthrow = "0"                                                              // saving throw type: 0 (none)
SET savebonus = "0"                                                                // save bonus: 0
SET school = "0"                                                                   // school: 0 (schoolless)
SET lowestafflvl = "0"                                                             // lowest level affected: 0
SET highestafflvl = "0"                                                            // highest level affected: 0
SET casterx = "0"                                                                  // casterx: 0
SET castery = "0"                                                                  // castery: 0
SET targetx = "0"                                                                  // targetx: 0
SET targety = "0"                                                                  // targety: 0
SET casterlvl  = "0"                                                               // caster level: 0
SET sectype = "0"                                                                  // secondary type: 0
SPRINT ~resource~ ~~                                                               // resref: none
SPRINT ~resource2~ ~~                                                              // resref2: none
SPRINT ~resource3~ ~~                                                              // resref3: none
SPRINT ~vvcresource~ ~~                                                            // vvcresref: none
SPRINT ~effsource~ ~~                                                              // effsource: none
SPRINT ~effvar~ ~~                                                                 // effvar: none
LAUNCH_PATCH_MACRO ADD_CRE_EFFECT                                                // add new creature effect
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
WRITE_BYTE  0x2E "74"                                                              // major color (Solid White)
// =============================================================================== // the actual work ends here
END                                                                                // ends file validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block



// Fire Mephit

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~MEPFIR01~                                                           // Fire Mephit
              ~ELEMEP04~                                                           // Fire Mephit
              ~OBSFIR02~                                                           // Fire Mephit
               ~RR#MFIR~                                                           // Fire Mephit (gated)
			    ~A7Q5FM~                                                           // Fire Mephit (Afaaq)
			  ~O#brimP1~                                                           // Fire Mephit (Sellswords)
			  ~O#brimP2~                                                           // Fire Mephit (Sellswords)
               ~FAMFIRE~                                                            // Fire Mephit - familiar
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY END
PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_validity.tpp~                                    // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
PATCH_IF valid AND LONG_AT 0x28 = 32515 BEGIN // IMP
  PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_reindex.tpp~                                   // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
// =============================================================================== // the actual work starts from here
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "51" END                                                // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "52" END                                                // mark opcode #52 (Colour: Very Bright by RGB) for deletion
SET opcode = "52"                                                                  // effect: #52 (Colour: Very Bright by RGB)
SET target = "1"                                                                   // target: 1 (self)
SET timing = "9"                                                                   // timing mode: 9 (permanent after death)
SET parameter1 = "529408"                                                          // param1: (color designation)
SET parameter2 = "2"                                                               // param2: 2 (location - major color)
SET parameter3 = "0"                                                               // param3: 0
SET parameter4 = "0"                                                               // param4: 0
SET power = "0"                                                                    // power: 0
SET resist_dispel = "0"                                                            // dispel/resistance: 0 (non-magical)
SET duration = "0"                                                                 // duration: 0
SET probability1 = "100"                                                           // probability1: 100%
SET probability2 = "0"                                                             // probability2: 0%
SET dicenumber = "0"                                                               // dicenumber: 0
SET dicesize = "0"                                                                 // dicesize: 0
SET savingthrow = "0"                                                              // saving throw type: 0 (none)
SET savebonus = "0"                                                                // save bonus: 0
SET school = "0"                                                                   // school: 0 (schoolless)
SET lowestafflvl = "0"                                                             // lowest level affected: 0
SET highestafflvl = "0"                                                            // highest level affected: 0
SET casterx = "0"                                                                  // casterx: 0
SET castery = "0"                                                                  // castery: 0
SET targetx = "0"                                                                  // targetx: 0
SET targety = "0"                                                                  // targety: 0
SET casterlvl  = "0"                                                               // caster level: 0
SET sectype = "0"                                                                  // secondary type: 0
SPRINT ~resource~ ~~                                                               // resref: none
SPRINT ~resource2~ ~~                                                              // resref2: none
SPRINT ~resource3~ ~~                                                              // resref3: none
SPRINT ~vvcresource~ ~~                                                            // vvcresref: none
SPRINT ~effsource~ ~~                                                              // effsource: none
SPRINT ~effvar~ ~~                                                                 // effvar: none
LAUNCH_PATCH_MACRO ADD_CRE_EFFECT                                                // add new creature effect
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
WRITE_BYTE  0x2E "67"                                                              // major color (Shiny Gold)
// =============================================================================== // the actual work ends here
END                                                                                // ends file validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block



// Lightning Mephit

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~MEPLIG01~                                                           // Lightning Mephit
               ~RR#MLIG~                                                           // Lightning Mephit (gated)
              ~FAMLIGHT~                                                           // Lightning Mephit - familiar
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY END
PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_validity.tpp~                                    // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
PATCH_IF valid AND LONG_AT 0x28 = 32515 BEGIN // IMP
  PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_reindex.tpp~                                   // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
// =============================================================================== // the actual work starts from here
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "51" END                                                // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "52" END                                                // mark opcode #52 (Colour: Very Bright by RGB) for deletion
SET opcode = "52"                                                                  // effect: #52 (Colour: Very Bright by RGB)
SET target = "1"                                                                   // target: 1 (self)
SET timing = "9"                                                                   // timing mode: 9 (permanent after death)
SET parameter1 = "67174656"                                                        // param1: (color designation)
SET parameter2 = "2"                                                               // param2: 2 (location - major color)
SET parameter3 = "0"                                                               // param3: 0
SET parameter4 = "0"                                                               // param4: 0
SET power = "0"                                                                    // power: 0
SET resist_dispel = "0"                                                            // dispel/resistance: 0 (non-magical)
SET duration = "0"                                                                 // duration: 0
SET probability1 = "100"                                                           // probability1: 100%
SET probability2 = "0"                                                             // probability2: 0%
SET dicenumber = "0"                                                               // dicenumber: 0
SET dicesize = "0"                                                                 // dicesize: 0
SET savingthrow = "0"                                                              // saving throw type: 0 (none)
SET savebonus = "0"                                                                // save bonus: 0
SET school = "0"                                                                   // school: 0 (schoolless)
SET lowestafflvl = "0"                                                             // lowest level affected: 0
SET highestafflvl = "0"                                                            // highest level affected: 0
SET casterx = "0"                                                                  // casterx: 0
SET castery = "0"                                                                  // castery: 0
SET targetx = "0"                                                                  // targetx: 0
SET targety = "0"                                                                  // targety: 0
SET casterlvl  = "0"                                                               // caster level: 0
SET sectype = "0"                                                                  // secondary type: 0
SPRINT ~resource~ ~~                                                               // resref: none
SPRINT ~resource2~ ~~                                                              // resref2: none
SPRINT ~resource3~ ~~                                                              // resref3: none
SPRINT ~vvcresource~ ~~                                                            // vvcresref: none
SPRINT ~effsource~ ~~                                                              // effsource: none
SPRINT ~effvar~ ~~                                                                 // effvar: none
LAUNCH_PATCH_MACRO ADD_CRE_EFFECT                                                // add new creature effect
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
WRITE_BYTE  0x2E "60"                                                              // major color (Dark Purple)
// =============================================================================== // the actual work ends here
END                                                                                // ends file validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block



// Mineral Mephit

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~MEPMIN01~                                                           // Mineral Mephit
              ~ELEMEP07~                                                           // Mineral Mephit
               ~RR#MMIN~                                                           // Mineral Mephit (gated)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY END
PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_validity.tpp~                                    // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
PATCH_IF valid AND LONG_AT 0x28 = 32515 BEGIN // IMP
  PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_reindex.tpp~                                   // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
// =============================================================================== // the actual work starts from here
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "51" END                                                // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "52" END                                                // mark opcode #52 (Colour: Very Bright by RGB) for deletion
SET opcode = "52"                                                                  // effect: #52 (Colour: Very Bright by RGB)
SET target = "1"                                                                   // target: 1 (self)
SET timing = "9"                                                                   // timing mode: 9 (permanent after death)
SET parameter1 = "67305984"                                                        // param1: (color designation)
SET parameter2 = "2"                                                               // param2: 2 (location - major color)
SET parameter3 = "0"                                                               // param3: 0
SET parameter4 = "0"                                                               // param4: 0
SET power = "0"                                                                    // power: 0
SET resist_dispel = "0"                                                            // dispel/resistance: 0 (non-magical)
SET duration = "0"                                                                 // duration: 0
SET probability1 = "100"                                                           // probability1: 100%
SET probability2 = "0"                                                             // probability2: 0%
SET dicenumber = "0"                                                               // dicenumber: 0
SET dicesize = "0"                                                                 // dicesize: 0
SET savingthrow = "0"                                                              // saving throw type: 0 (none)
SET savebonus = "0"                                                                // save bonus: 0
SET school = "0"                                                                   // school: 0 (schoolless)
SET lowestafflvl = "0"                                                             // lowest level affected: 0
SET highestafflvl = "0"                                                            // highest level affected: 0
SET casterx = "0"                                                                  // casterx: 0
SET castery = "0"                                                                  // castery: 0
SET targetx = "0"                                                                  // targetx: 0
SET targety = "0"                                                                  // targety: 0
SET casterlvl  = "0"                                                               // caster level: 0
SET sectype = "0"                                                                  // secondary type: 0
SPRINT ~resource~ ~~                                                               // resref: none
SPRINT ~resource2~ ~~                                                              // resref2: none
SPRINT ~resource3~ ~~                                                              // resref3: none
SPRINT ~vvcresource~ ~~                                                            // vvcresref: none
SPRINT ~effsource~ ~~                                                              // effsource: none
SPRINT ~effvar~ ~~                                                                 // effvar: none
LAUNCH_PATCH_MACRO ADD_CRE_EFFECT                                                // add new creature effect
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
WRITE_BYTE  0x2E "27"                                                              // major color (Gray)
// =============================================================================== // the actual work ends here
END                                                                                // ends file validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block



// Magma Mephit

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~MEPMAG01~                                                           // Magma Mephit
              ~MEPMAG02~                                                           // Magma Mephit
              ~ELEMEP05~                                                           // Magma Mephit
              ~OBSFIR03~                                                           // Magma Mephit
               ~RR#MMAG~                                                           // Magma Mephit (gated)
			  ~O#brimP3~                                                           // Magma Mephit (Sellswords)
			    ~A7Q5MM~                                                           // Magma Mephit (afaaq)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY END
PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_validity.tpp~                                    // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
PATCH_IF valid AND LONG_AT 0x28 = 32515 BEGIN // IMP
  PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_reindex.tpp~                                   // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
// =============================================================================== // the actual work starts from here
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "51" END                                                // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "52" END                                                // mark opcode #52 (Colour: Very Bright by RGB) for deletion
SET opcode = "51"                                                                  // effect: #51 (Colour: Strong/Dark by RGB)
SET target = "1"                                                                   // target: 1 (self)
SET timing = "9"                                                                   // timing mode: 9 (permanent after death)
SET parameter1 = "577106432"                                                       // param1: (color designation)
SET parameter2 = "2"                                                               // param2: 2 (location - major color)
SET parameter3 = "0"                                                               // param3: 0
SET parameter4 = "0"                                                               // param4: 0
SET power = "0"                                                                    // power: 0
SET resist_dispel = "0"                                                            // dispel/resistance: 0 (non-magical)
SET duration = "0"                                                                 // duration: 0
SET probability1 = "100"                                                           // probability1: 100%
SET probability2 = "0"                                                             // probability2: 0%
SET dicenumber = "0"                                                               // dicenumber: 0
SET dicesize = "0"                                                                 // dicesize: 0
SET savingthrow = "0"                                                              // saving throw type: 0 (none)
SET savebonus = "0"                                                                // save bonus: 0
SET school = "0"                                                                   // school: 0 (schoolless)
SET lowestafflvl = "0"                                                             // lowest level affected: 0
SET highestafflvl = "0"                                                            // highest level affected: 0
SET casterx = "0"                                                                  // casterx: 0
SET castery = "0"                                                                  // castery: 0
SET targetx = "0"                                                                  // targetx: 0
SET targety = "0"                                                                  // targety: 0
SET casterlvl  = "0"                                                               // caster level: 0
SET sectype = "0"                                                                  // secondary type: 0
SPRINT ~resource~ ~~                                                               // resref: none
SPRINT ~resource2~ ~~                                                              // resref2: none
SPRINT ~resource3~ ~~                                                              // resref3: none
SPRINT ~vvcresource~ ~~                                                            // vvcresref: none
SPRINT ~effsource~ ~~                                                              // effsource: none
SPRINT ~effvar~ ~~                                                                 // effvar: none
LAUNCH_PATCH_MACRO ADD_CRE_EFFECT                                                // add new creature effect
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
WRITE_BYTE  0x2E "46"                                                              // major color (Red)
// =============================================================================== // the actual work ends here
END                                                                                // ends file validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block



// Mist Mephit

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~MEPMIS01~                                                           // Mist Mephit
               ~AR18FAM~                                                           // Mist Mephit
                ~GPFAM1~                                                           // Pitch
               ~RR#MMST~                                                           // Mist Mephit (gated)
               ~FAMMIST~                                                           // Mist Mephit - Familiar
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY END
PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_validity.tpp~                                    // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
PATCH_IF valid AND LONG_AT 0x28 = 32515 BEGIN // IMP
  PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_reindex.tpp~                                   // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
// =============================================================================== // the actual work starts from here
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "51" END                                                // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "52" END                                                // mark opcode #52 (Colour: Very Bright by RGB) for deletion
SET opcode = "52"                                                                  // effect: #52 (Colour: Very Bright by RGB)
SET target = "1"                                                                   // target: 1 (self)
SET timing = "9"                                                                   // timing mode: 9 (permanent after death)
SET parameter1 = "16973824"                                                        // param1: (color designation)
SET parameter2 = "2"                                                               // param2: 2 (location - major color)
SET parameter3 = "0"                                                               // param3: 0
SET parameter4 = "0"                                                               // param4: 0
SET power = "0"                                                                    // power: 0
SET resist_dispel = "0"                                                            // dispel/resistance: 0 (non-magical)
SET duration = "0"                                                                 // duration: 0
SET probability1 = "100"                                                           // probability1: 100%
SET probability2 = "0"                                                             // probability2: 0%
SET dicenumber = "0"                                                               // dicenumber: 0
SET dicesize = "0"                                                                 // dicesize: 0
SET savingthrow = "0"                                                              // saving throw type: 0 (none)
SET savebonus = "0"                                                                // save bonus: 0
SET school = "0"                                                                   // school: 0 (schoolless)
SET lowestafflvl = "0"                                                             // lowest level affected: 0
SET highestafflvl = "0"                                                            // highest level affected: 0
SET casterx = "0"                                                                  // casterx: 0
SET castery = "0"                                                                  // castery: 0
SET targetx = "0"                                                                  // targetx: 0
SET targety = "0"                                                                  // targety: 0
SET casterlvl  = "0"                                                               // caster level: 0
SET sectype = "0"                                                                  // secondary type: 0
SPRINT ~resource~ ~~                                                               // resref: none
SPRINT ~resource2~ ~~                                                              // resref2: none
SPRINT ~resource3~ ~~                                                              // resref3: none
SPRINT ~vvcresource~ ~~                                                            // vvcresref: none
SPRINT ~effsource~ ~~                                                              // effsource: none
SPRINT ~effvar~ ~~                                                                 // effvar: none
LAUNCH_PATCH_MACRO ADD_CRE_EFFECT                                                // add new creature effect
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
WRITE_BYTE  0x2E "32"                                                              // major color (Dark Sea Green)
// =============================================================================== // the actual work ends here
END                                                                                // ends file validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block



// Steam Mephit

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~MEPSTE01~                                                           // Steam Mephit
              ~ELEMEP02~                                                           // Steam Mephit
               ~RR#MSTE~                                                           // Steam Mephit (gated)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY END
PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_validity.tpp~                                    // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
PATCH_IF valid AND LONG_AT 0x28 = 32515 BEGIN // IMP
  PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_reindex.tpp~                                   // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
// =============================================================================== // the actual work starts from here
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "51" END                                                // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "52" END                                                // mark opcode #52 (Colour: Very Bright by RGB) for deletion
SET opcode = "52"                                                                  // effect: #52 (Colour: Very Bright by RGB)
SET target = "1"                                                                   // target: 1 (self)
SET timing = "9"                                                                   // timing mode: 9 (permanent after death)
SET parameter1 = "33555456"                                                        // param1: (color designation)
SET parameter2 = "2"                                                               // param2: 2 (location - major color)
SET parameter3 = "0"                                                               // param3: 0
SET parameter4 = "0"                                                               // param4: 0
SET power = "0"                                                                    // power: 0
SET resist_dispel = "0"                                                            // dispel/resistance: 0 (non-magical)
SET duration = "0"                                                                 // duration: 0
SET probability1 = "100"                                                           // probability1: 100%
SET probability2 = "0"                                                             // probability2: 0%
SET dicenumber = "0"                                                               // dicenumber: 0
SET dicesize = "0"                                                                 // dicesize: 0
SET savingthrow = "0"                                                              // saving throw type: 0 (none)
SET savebonus = "0"                                                                // save bonus: 0
SET school = "0"                                                                   // school: 0 (schoolless)
SET lowestafflvl = "0"                                                             // lowest level affected: 0
SET highestafflvl = "0"                                                            // highest level affected: 0
SET casterx = "0"                                                                  // casterx: 0
SET castery = "0"                                                                  // castery: 0
SET targetx = "0"                                                                  // targetx: 0
SET targety = "0"                                                                  // targety: 0
SET casterlvl  = "0"                                                               // caster level: 0
SET sectype = "0"                                                                  // secondary type: 0
SPRINT ~resource~ ~~                                                               // resref: none
SPRINT ~resource2~ ~~                                                              // resref2: none
SPRINT ~resource3~ ~~                                                              // resref3: none
SPRINT ~vvcresource~ ~~                                                            // vvcresref: none
SPRINT ~effsource~ ~~                                                              // effsource: none
SPRINT ~effvar~ ~~                                                                 // effvar: none
LAUNCH_PATCH_MACRO ADD_CRE_EFFECT                                                // add new creature effect
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
WRITE_BYTE  0x2E "61"                                                              // major color (Lavender)
// =============================================================================== // the actual work ends here
END                                                                                // ends file validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block



// Air Mephit

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~MEPAIR01~                                                           // Air Mephit
               ~RR#MAIR~                                                           // Air Mephit (gated)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY END
PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_validity.tpp~                                    // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
PATCH_IF valid AND LONG_AT 0x28 = 32515 BEGIN // IMP
  PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_reindex.tpp~                                   // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
// =============================================================================== // the actual work starts from here
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "51" END                                                // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "52" END                                                // mark opcode #52 (Colour: Very Bright by RGB) for deletion
SET opcode = "52"                                                                  // effect: #52 (Colour: Very Bright by RGB)
SET target = "1"                                                                   // target: 1 (self)
SET timing = "9"                                                                   // timing mode: 9 (permanent after death)
SET parameter1 = "84215040"                                                        // param1: (color designation)
SET parameter2 = "2"                                                               // param2: 2 (location - major color)
SET parameter3 = "0"                                                               // param3: 0
SET parameter4 = "0"                                                               // param4: 0
SET power = "0"                                                                    // power: 0
SET resist_dispel = "0"                                                            // dispel/resistance: 0 (non-magical)
SET duration = "0"                                                                 // duration: 0
SET probability1 = "100"                                                           // probability1: 100%
SET probability2 = "0"                                                             // probability2: 0%
SET dicenumber = "0"                                                               // dicenumber: 0
SET dicesize = "0"                                                                 // dicesize: 0
SET savingthrow = "0"                                                              // saving throw type: 0 (none)
SET savebonus = "0"                                                                // save bonus: 0
SET school = "0"                                                                   // school: 0 (schoolless)
SET lowestafflvl = "0"                                                             // lowest level affected: 0
SET highestafflvl = "0"                                                            // highest level affected: 0
SET casterx = "0"                                                                  // casterx: 0
SET castery = "0"                                                                  // castery: 0
SET targetx = "0"                                                                  // targetx: 0
SET targety = "0"                                                                  // targety: 0
SET casterlvl  = "0"                                                               // caster level: 0
SET sectype = "0"                                                                  // secondary type: 0
SPRINT ~resource~ ~~                                                               // resref: none
SPRINT ~resource2~ ~~                                                              // resref2: none
SPRINT ~resource3~ ~~                                                              // resref3: none
SPRINT ~vvcresource~ ~~                                                            // vvcresref: none
SPRINT ~effsource~ ~~                                                              // effsource: none
SPRINT ~effvar~ ~~                                                                 // effvar: none
LAUNCH_PATCH_MACRO ADD_CRE_EFFECT                                                // add new creature effect
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
WRITE_BYTE  0x2E "63"                                                              // major color (Light Gray)
// =============================================================================== // the actual work ends here
END                                                                                // ends file validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block



// Salt Mephit

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~MEPSAL01~                                                           // Salt Mephit
              ~ELEMEP03~                                                           // Salt Mephit
               ~RR#MSAL~                                                           // Salt Mephit (gated)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY END
PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_validity.tpp~                                    // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
PATCH_IF valid AND LONG_AT 0x28 = 32515 BEGIN // IMP
  PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_reindex.tpp~                                   // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
// =============================================================================== // the actual work starts from here
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "51" END                                                // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "52" END                                                // mark opcode #52 (Colour: Very Bright by RGB) for deletion
SET opcode = "52"                                                                  // effect: #52 (Colour: Very Bright by RGB)
SET target = "1"                                                                   // target: 1 (self)
SET timing = "9"                                                                   // timing mode: 9 (permanent after death)
SET parameter1 = "168232448"                                                       // param1: (color designation)
SET parameter2 = "2"                                                               // param2: 2 (location - major color)
SET parameter3 = "0"                                                               // param3: 0
SET parameter4 = "0"                                                               // param4: 0
SET power = "0"                                                                    // power: 0
SET resist_dispel = "0"                                                            // dispel/resistance: 0 (non-magical)
SET duration = "0"                                                                 // duration: 0
SET probability1 = "100"                                                           // probability1: 100%
SET probability2 = "0"                                                             // probability2: 0%
SET dicenumber = "0"                                                               // dicenumber: 0
SET dicesize = "0"                                                                 // dicesize: 0
SET savingthrow = "0"                                                              // saving throw type: 0 (none)
SET savebonus = "0"                                                                // save bonus: 0
SET school = "0"                                                                   // school: 0 (schoolless)
SET lowestafflvl = "0"                                                             // lowest level affected: 0
SET highestafflvl = "0"                                                            // highest level affected: 0
SET casterx = "0"                                                                  // casterx: 0
SET castery = "0"                                                                  // castery: 0
SET targetx = "0"                                                                  // targetx: 0
SET targety = "0"                                                                  // targety: 0
SET casterlvl  = "0"                                                               // caster level: 0
SET sectype = "0"                                                                  // secondary type: 0
SPRINT ~resource~ ~~                                                               // resref: none
SPRINT ~resource2~ ~~                                                              // resref2: none
SPRINT ~resource3~ ~~                                                              // resref3: none
SPRINT ~vvcresource~ ~~                                                            // vvcresref: none
SPRINT ~effsource~ ~~                                                              // effsource: none
SPRINT ~effvar~ ~~                                                                 // effvar: none
LAUNCH_PATCH_MACRO ADD_CRE_EFFECT                                                // add new creature effect
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
WRITE_BYTE  0x2E "79"                                                              // major color (Light Silver)
// =============================================================================== // the actual work ends here
END                                                                                // ends file validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block



// Dust Mephit

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~MEPDUS01~                                                           // Dust Mephit
              ~ELEMEP08~                                                           // Dust Mephit
                ~MDDUST~                                                           // Dust Mephit
               ~RR#MDUS~                                                           // Dust Mephit (gated)
              ~TCMMBKWM~                                                           // Book Mephit (Classic Adventures)
               ~FAMDUST~                                                           // Dust Mephit - familiar
              ~FAMDUS25~                                                           // Dust Mephit - familiar ToB
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY END
PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_validity.tpp~                                    // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
PATCH_IF valid AND LONG_AT 0x28 = 32515 BEGIN // IMP
  PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_reindex.tpp~                                   // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
// =============================================================================== // the actual work starts from here
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "51" END                                                // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "52" END                                                // mark opcode #52 (Colour: Very Bright by RGB) for deletion
SET opcode = "51"                                                                  // effect: #51 (Colour: Strong/Dark by RGB)
SET target = "1"                                                                   // target: 1 (self)
SET timing = "9"                                                                   // timing mode: 9 (permanent after death)
SET parameter1 = "1684300800"                                                      // param1: (color designation)
SET parameter2 = "2"                                                               // param2: 2 (location - major color)
SET parameter3 = "0"                                                               // param3: 0
SET parameter4 = "0"                                                               // param4: 0
SET power = "0"                                                                    // power: 0
SET resist_dispel = "0"                                                            // dispel/resistance: 0 (non-magical)
SET duration = "0"                                                                 // duration: 0
SET probability1 = "100"                                                           // probability1: 100%
SET probability2 = "0"                                                             // probability2: 0%
SET dicenumber = "0"                                                               // dicenumber: 0
SET dicesize = "0"                                                                 // dicesize: 0
SET savingthrow = "0"                                                              // saving throw type: 0 (none)
SET savebonus = "0"                                                                // save bonus: 0
SET school = "0"                                                                   // school: 0 (schoolless)
SET lowestafflvl = "0"                                                             // lowest level affected: 0
SET highestafflvl = "0"                                                            // highest level affected: 0
SET casterx = "0"                                                                  // casterx: 0
SET castery = "0"                                                                  // castery: 0
SET targetx = "0"                                                                  // targetx: 0
SET targety = "0"                                                                  // targety: 0
SET casterlvl  = "0"                                                               // caster level: 0
SET sectype = "0"                                                                  // secondary type: 0
SPRINT ~resource~ ~~                                                               // resref: none
SPRINT ~resource2~ ~~                                                              // resref2: none
SPRINT ~resource3~ ~~                                                              // resref3: none
SPRINT ~vvcresource~ ~~                                                            // vvcresref: none
SPRINT ~effsource~ ~~                                                              // effsource: none
SPRINT ~effvar~ ~~                                                                 // effvar: none
LAUNCH_PATCH_MACRO ADD_CRE_EFFECT                                                // add new creature effect
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
WRITE_BYTE  0x2E "66"                                                              // major color (Faded Black)
// =============================================================================== // the actual work ends here
END                                                                                // ends file validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block



// Ooze Mephit

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~MEPOOZ01~                                                           // Ooze Mephit
              ~ELEMEP01~                                                           // Ooze Mephit
               ~RR#MOOZ~                                                           // Ooze Mephit (gated)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY END
PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_validity.tpp~                                    // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
PATCH_IF valid AND LONG_AT 0x28 = 32515 BEGIN // IMP
  PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_reindex.tpp~                                   // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
// =============================================================================== // the actual work starts from here
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "51" END                                                // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "52" END                                                // mark opcode #52 (Colour: Very Bright by RGB) for deletion
SET opcode = "51"                                                                  // effect: #51 (Colour: Strong/Dark by RGB)
SET target = "1"                                                                   // target: 1 (self)
SET timing = "9"                                                                   // timing mode: 9 (permanent after death)
SET parameter1 = "16711680"                                                        // param1: (color designation)
SET parameter2 = "2"                                                               // param2: 2 (location - major color)
SET parameter3 = "0"                                                               // param3: 0
SET parameter4 = "0"                                                               // param4: 0
SET power = "0"                                                                    // power: 0
SET resist_dispel = "0"                                                            // dispel/resistance: 0 (non-magical)
SET duration = "0"                                                                 // duration: 0
SET probability1 = "100"                                                           // probability1: 100%
SET probability2 = "0"                                                             // probability2: 0%
SET dicenumber = "0"                                                               // dicenumber: 0
SET dicesize = "0"                                                                 // dicesize: 0
SET savingthrow = "0"                                                              // saving throw type: 0 (none)
SET savebonus = "0"                                                                // save bonus: 0
SET school = "0"                                                                   // school: 0 (schoolless)
SET lowestafflvl = "0"                                                             // lowest level affected: 0
SET highestafflvl = "0"                                                            // highest level affected: 0
SET casterx = "0"                                                                  // casterx: 0
SET castery = "0"                                                                  // castery: 0
SET targetx = "0"                                                                  // targetx: 0
SET targety = "0"                                                                  // targety: 0
SET casterlvl  = "0"                                                               // caster level: 0
SET sectype = "0"                                                                  // secondary type: 0
SPRINT ~resource~ ~~                                                               // resref: none
SPRINT ~resource2~ ~~                                                              // resref2: none
SPRINT ~resource3~ ~~                                                              // resref3: none
SPRINT ~vvcresource~ ~~                                                            // vvcresref: none
SPRINT ~effsource~ ~~                                                              // effsource: none
SPRINT ~effvar~ ~~                                                                 // effvar: none
LAUNCH_PATCH_MACRO ADD_CRE_EFFECT                                                // add new creature effect
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
WRITE_BYTE  0x2E "69"                                                              // major color (Shiny Green)
// =============================================================================== // the actual work ends here
END                                                                                // ends file validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block



// Earth Mephit

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~MEPEAR01~                                                           // Earth Mephit
              ~ELEMEP06~                                                           // Earth Mephit
               ~RR#MEAR~                                                           // Earth Mephit (gated)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY END
PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_validity.tpp~                                    // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
PATCH_IF valid AND LONG_AT 0x28 = 32515 BEGIN // IMP
  PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_reindex.tpp~                                   // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
// =============================================================================== // the actual work starts from here
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "51" END                                                // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "52" END                                                // mark opcode #52 (Colour: Very Bright by RGB) for deletion
SET opcode = "51"                                                                  // effect: #51 (Colour: Strong/Dark by RGB)
SET target = "1"                                                                   // target: 1 (self)
SET timing = "9"                                                                   // timing mode: 9 (permanent after death)
SET parameter1 = "322527232"                                                       // param1: (color designation)
SET parameter2 = "2"                                                               // param2: 2 (location - major color)
SET parameter3 = "0"                                                               // param3: 0
SET parameter4 = "0"                                                               // param4: 0
SET power = "0"                                                                    // power: 0
SET resist_dispel = "0"                                                            // dispel/resistance: 0 (non-magical)
SET duration = "0"                                                                 // duration: 0
SET probability1 = "100"                                                           // probability1: 100%
SET probability2 = "0"                                                             // probability2: 0%
SET dicenumber = "0"                                                               // dicenumber: 0
SET dicesize = "0"                                                                 // dicesize: 0
SET savingthrow = "0"                                                              // saving throw type: 0 (none)
SET savebonus = "0"                                                                // save bonus: 0
SET school = "0"                                                                   // school: 0 (schoolless)
SET lowestafflvl = "0"                                                             // lowest level affected: 0
SET highestafflvl = "0"                                                            // highest level affected: 0
SET casterx = "0"                                                                  // casterx: 0
SET castery = "0"                                                                  // castery: 0
SET targetx = "0"                                                                  // targetx: 0
SET targety = "0"                                                                  // targety: 0
SET casterlvl  = "0"                                                               // caster level: 0
SET sectype = "0"                                                                  // secondary type: 0
SPRINT ~resource~ ~~                                                               // resref: none
SPRINT ~resource2~ ~~                                                              // resref2: none
SPRINT ~resource3~ ~~                                                              // resref3: none
SPRINT ~vvcresource~ ~~                                                            // vvcresref: none
SPRINT ~effsource~ ~~                                                              // effsource: none
SPRINT ~effvar~ ~~                                                                 // effvar: none
LAUNCH_PATCH_MACRO ADD_CRE_EFFECT                                                // add new creature effect
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
WRITE_BYTE  0x2E "41"                                                              // major color (Dark Brown)
// =============================================================================== // the actual work ends here
END                                                                                // ends file validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block



// Quasit

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~FAMQUAS~                                                            // Quasit (familiar SoA)
             ~FAMQUA25~                                                            // Quasit (familiar ToB)
             ~DEADDEM2~                                                            // Quasit
              ~DQUAS01~                                                            // Quasit
              ~GORTAN5~                                                            // Quasit
             ~IMPQUA01~                                                            // Quasit
              ~TELQUA1~                                                            // Quasit
              ~TELQUA2~                                                            // Quasit
                ~TCJOT~                                                            // Jot the Quasit (Classic Adventures)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY END
PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_validity.tpp~                                    // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
PATCH_IF valid AND LONG_AT 0x28 = 32515 BEGIN // IMP
  PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_reindex.tpp~                                   // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
// =============================================================================== // the actual work starts from here
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "51" END                                                // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "52" END                                                // mark opcode #52 (Colour: Very Bright by RGB) for deletion
SET opcode = "52"                                                                  // effect: #52 (Colour: Very Bright by RGB
SET target = "1"                                                                   // target: 1 (self)
SET timing = "9"                                                                   // timing mode: 9 (permanent after death)
SET parameter1 = "459520"                                                          // param1: (color designation)
SET parameter2 = "2"                                                               // param2: 2 (location - major color)
SET parameter3 = "0"                                                               // param3: 0
SET parameter4 = "0"                                                               // param4: 0
SET power = "0"                                                                    // power: 0
SET resist_dispel = "0"                                                            // dispel/resistance: 0 (non-magical)
SET duration = "0"                                                                 // duration: 0
SET probability1 = "100"                                                           // probability1: 100%
SET probability2 = "0"                                                             // probability2: 0%
SET dicenumber = "0"                                                               // dicenumber: 0
SET dicesize = "0"                                                                 // dicesize: 0
SET savingthrow = "0"                                                              // saving throw type: 0 (none)
SET savebonus = "0"                                                                // save bonus: 0
SET school = "0"                                                                   // school: 0 (schoolless)
SET lowestafflvl = "0"                                                             // lowest level affected: 0
SET highestafflvl = "0"                                                            // highest level affected: 0
SET casterx = "0"                                                                  // casterx: 0
SET castery = "0"                                                                  // castery: 0
SET targetx = "0"                                                                  // targetx: 0
SET targety = "0"                                                                  // targety: 0
SET casterlvl  = "0"                                                               // caster level: 0
SET sectype = "0"                                                                  // secondary type: 0
SPRINT ~resource~ ~~                                                               // resref: none
SPRINT ~resource2~ ~~                                                              // resref2: none
SPRINT ~resource3~ ~~                                                              // resref3: none
SPRINT ~vvcresource~ ~~                                                            // vvcresref: none
SPRINT ~effsource~ ~~                                                              // effsource: none
SPRINT ~effvar~ ~~                                                                 // effvar: none
LAUNCH_PATCH_MACRO ADD_CRE_EFFECT                                                // add new creature effect
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
WRITE_BYTE  0x2E "52"                                                              // major color (light green)
// =============================================================================== // the actual work ends here
END                                                                                // ends file validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block



// Imp

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~FAMIMP~                                                             // Imp (familiar SoA)
            ~FAMIMP25~                                                             // Imp (familiar ToB)
              ~DIMP01~                                                             // Imp
              ~FSRIDD~                                                             // Imp
             ~GORBAT4~                                                             // Imp
            ~GORIMP01~                                                             // Imp
               ~IMP01~                                                             // Imp
            ~MEKIMP01~                                                             // Imp
             ~RUMAR03~                                                             // Imp
            ~SAHIMP01~                                                             // Imp
            ~SAHIMP02~                                                             // Imp
             ~TELIMP1~                                                             // Imp
               ~UDIMP~                                                             // Imp
            ~SEVPAT03~                                                             // Pooky
            ~x#dyqimp~                                                             // Ichthraa, the imp in Dynaheir's quest (BG1 NPCs)
             ~TCIMP01~                                                             // Imp (Classic Adventures)
			~FL#UDIMP~                                                             // Imp
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY END
PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_validity.tpp~                                    // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
PATCH_IF valid AND LONG_AT 0x28 = 32515 BEGIN // IMP
  PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_reindex.tpp~                                   // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
// =============================================================================== // the actual work starts from here
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "51" END                                                // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "52" END                                                // mark opcode #52 (Colour: Very Bright by RGB) for deletion
SET opcode = "51"                                                                  // effect: #51 (Colour: Strong/Dark by RGB)
SET target = "1"                                                                   // target: 1 (self)
SET timing = "9"                                                                   // timing mode: 9 (permanent after death)
SET parameter1 = "65280"                                                           // param1: (color designation)
SET parameter2 = "2"                                                               // param2: 2 (location - major color)
SET parameter3 = "0"                                                               // param3: 0
SET parameter4 = "0"                                                               // param4: 0
SET power = "0"                                                                    // power: 0
SET resist_dispel = "0"                                                            // dispel/resistance: 0 (non-magical)
SET duration = "0"                                                                 // duration: 0
SET probability1 = "100"                                                           // probability1: 100%
SET probability2 = "0"                                                             // probability2: 0%
SET dicenumber = "0"                                                               // dicenumber: 0
SET dicesize = "0"                                                                 // dicesize: 0
SET savingthrow = "0"                                                              // saving throw type: 0 (none)
SET savebonus = "0"                                                                // save bonus: 0
SET school = "0"                                                                   // school: 0 (schoolless)
SET lowestafflvl = "0"                                                             // lowest level affected: 0
SET highestafflvl = "0"                                                            // highest level affected: 0
SET casterx = "0"                                                                  // casterx: 0
SET castery = "0"                                                                  // castery: 0
SET targetx = "0"                                                                  // targetx: 0
SET targety = "0"                                                                  // targety: 0
SET casterlvl  = "0"                                                               // caster level: 0
SET sectype = "0"                                                                  // secondary type: 0
SPRINT ~resource~ ~~                                                               // resref: none
SPRINT ~resource2~ ~~                                                              // resref2: none
SPRINT ~resource3~ ~~                                                              // resref3: none
SPRINT ~vvcresource~ ~~                                                            // vvcresref: none
SPRINT ~effsource~ ~~                                                              // effsource: none
SPRINT ~effvar~ ~~                                                                 // effvar: none
LAUNCH_PATCH_MACRO ADD_CRE_EFFECT                                                // add new creature effect
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
WRITE_BYTE  0x2E "47"                                                              // major color (dark red)
// =============================================================================== // the actual work ends here
END                                                                                // ends file validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block



// Giant Troll

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~TROLGI01~                                                           // Giant Troll
              ~TROLGI02~                                                           // Giant Troll
              ~TROLLENS~                                                           // Giant Troll
              ~CHALTROL~                                                           // Giant Troll
              ~DW#MS6GT~                                                           // Giant Troll (IWDification ms6)
              ~O#LLTRO1~                                                           // Giant Troll (Sellswords)
              ~O#LLTRO2~                                                           // Giant Troll (Sellswords)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY END
PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_validity.tpp~                                    // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
PATCH_IF valid AND LONG_AT 0x28 = 32512 BEGIN // TROLL
  PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_reindex.tpp~                                   // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
// =============================================================================== // the actual work starts from here
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "51" END                                                // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "52" END                                                // mark opcode #52 (Colour: Very Bright by RGB) for deletion
  LPF ADD_CRE_EFFECT                                           // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "51"                                                                  // effect: #51 (Colour: Strong/Dark by RGB)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "7925760"                                                         // param1: (color designation)
  "parameter2" = "2"                                                               // param2: 2 (location - major color)
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
  END                                                                              // ends FUNCTION call
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
WRITE_BYTE  0x2E "40"                                                              // major color (Dark Dirty Copper)
// =============================================================================== // the actual work ends here
END                                                                                // ends file validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block


// Snow Troll

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~OBSICE01~                                                           // Snow Troll
              ~OBSICE11~                                                           // Snow Troll
              ~obsice11~                                                           // Snow Troll
              ~trolic03~                                                           // Snow Troll
              ~trolic04~                                                           // Snow Troll
              ~trolsn01~                                                           // Snow Troll
              ~trolsn02~                                                           // Snow Troll
              ~dw#trlbl~                                                           // Snow Troll (SCS)
              ~dw#trlsn~                                                           // Snow Troll (SCS)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY END
PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_validity.tpp~                                    // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
PATCH_IF valid AND LONG_AT 0x28 = 32512 BEGIN // TROLL
  PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_reindex.tpp~                                   // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
// =============================================================================== // the actual work starts from here
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "51" END                                                // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "52" END                                                // mark opcode #52 (Colour: Very Bright by RGB) for deletion
SET opcode = "52"                                                                  // effect: #52 (Colour: Very Bright by RGB
SET target = "1"                                                                   // target: 1 (self)
SET timing = "9"                                                                   // timing mode: 9 (permanent after death)
SET parameter1 = "285540352"                                                       // param1: (color designation)
SET parameter2 = "2"                                                               // param2: 2 (location - major color)
SET parameter3 = "0"                                                               // param3: 0
SET parameter4 = "0"                                                               // param4: 0
SET power = "0"                                                                    // power: 0
SET resist_dispel = "0"                                                            // dispel/resistance: 0 (non-magical)
SET duration = "0"                                                                 // duration: 0
SET probability1 = "100"                                                           // probability1: 100%
SET probability2 = "0"                                                             // probability2: 0%
SET dicenumber = "0"                                                               // dicenumber: 0
SET dicesize = "0"                                                                 // dicesize: 0
SET savingthrow = "0"                                                              // saving throw type: 0 (none)
SET savebonus = "0"                                                                // save bonus: 0
SET school = "0"                                                                   // school: 0 (schoolless)
SET lowestafflvl = "0"                                                             // lowest level affected: 0
SET highestafflvl = "0"                                                            // highest level affected: 0
SET casterx = "0"                                                                  // casterx: 0
SET castery = "0"                                                                  // castery: 0
SET targetx = "0"                                                                  // targetx: 0
SET targety = "0"                                                                  // targety: 0
SET casterlvl  = "0"                                                               // caster level: 0
SET sectype = "0"                                                                  // secondary type: 0
SPRINT ~resource~ ~~                                                               // resref: none
SPRINT ~resource2~ ~~                                                              // resref2: none
SPRINT ~resource3~ ~~                                                              // resref3: none
SPRINT ~vvcresource~ ~~                                                            // vvcresref: none
SPRINT ~effsource~ ~~                                                              // effsource: none
SPRINT ~effvar~ ~~                                                                 // effvar: none
LAUNCH_PATCH_MACRO ADD_CRE_EFFECT                                                // add new creature effect
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
WRITE_BYTE  0x2E "68"                                                              // major color (Shiny Blue)
// =============================================================================== // the actual work ends here
END                                                                                // ends file validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block

// Ice Troll

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~KPTROL06~                                                           // Ice Troll
              ~trolic01~                                                           // Ice Troll
              ~trolic02~                                                           // Ice Troll (BP)
              ~icetrlz2~                                                           // Ice Troll (BP)
              ~trolicd2~                                                           // Ice Troll (BP)
              ~dw#trlic~                                                           // Ice Troll (SCS)
              ~icetrolx~                                                           // Ice Troll (TDD)
              ~icetrolz~                                                           // Ice Troll (TDD)
              ~trolicdd~                                                           // Ice Troll (TDD)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
PATCH_IF (LONG_AT 0x28 = 32512 OR LONG_AT 0x28 = 32527) BEGIN 			           // TROLL or Small TROLL
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "51" END                                                // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "52" END                                                // mark opcode #52 (Colour: Very Bright by RGB) for deletion
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "66" END                                                // mark opcode #66 (transparency fade) for deletion
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "52"                                                                  // effect: #52 (Colour: Very Bright by RGB)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "419561472"                                                       // param1: (color designation)
  "parameter2" = "2"                                                               // param2: 2 (location - major color)
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
  END                                                                              // ends FUNCTION call
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "66"                                                                  // effect: #66 (transparency fade)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "50"                                                              // param1: (fade amount)
  "parameter2" = "0"                                                               // param2: 0
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends FUNCTION call
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
WRITE_BYTE  0x2E "58"                                                              // major color (Dark Blue)
// =============================================================================== // the actual work ends here
END                                                                                // ends animation validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block

// Desert Troll

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~trolde01~                                                           // Desert Troll
              ~trolde02~
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
PATCH_IF LONG_AT 0x28 = 32512 BEGIN 									           // TROLL
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "51" END                                                // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "52" END                                                // mark opcode #52 (Colour: Very Bright by RGB) for deletion
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "52"                                                                  // effect: #52 (Colour: Very Bright by RGB)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "16909824"                                                        // param1: (color designation)
  "parameter2" = "2"                                                               // param2: 2 (location - major color)
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
  END                                                                              // ends FUNCTION call
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "66"                                                                  // effect: #66 (transparency fade)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "50"                                                              // param1: (fade amount)
  "parameter2" = "0"                                                               // param2: 0
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends FUNCTION call
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
WRITE_BYTE  0x2E "67"                                                              // major color (Shiny Gold)
// =============================================================================== // the actual work ends here
END                                                                                // ends animation validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block


// Greater Mummy

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~MUMGRE01~                                                           // Greater Mummy
			  ~RIFTCR03~ 														   //  Greater Mummy		
			  ~MUMMYX1~ 														   //  Greater Mummy (TDD)		
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY END
PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_validity.tpp~                                    // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
PATCH_IF valid AND LONG_AT 0x28 = 57472 BEGIN // IC_MUMMY
  PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_reindex.tpp~                                   // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
// =============================================================================== // the actual work starts from here
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "51" END                                                // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "52" END                                                // mark opcode #52 (Colour: Very Bright by RGB) for deletion
SET opcode = "52"                                                                  // effect: #52 (Colour: Very Bright by RGB)
SET target = "1"                                                                   // target: 1 (self)
SET timing = "9"                                                                   // timing mode: 9 (permanent after death)
SET parameter1 = "16909568"                                                        // param1: (color designation)
SET parameter2 = "2"                                                               // param2: 2 (location - major color)
SET parameter3 = "0"                                                               // param3: 0
SET parameter4 = "0"                                                               // param4: 0
SET power = "0"                                                                    // power: 0
SET resist_dispel = "0"                                                            // dispel/resistance: 0 (non-magical)
SET duration = "0"                                                                 // duration: 0
SET probability1 = "100"                                                           // probability1: 100%
SET probability2 = "0"                                                             // probability2: 0%
SET dicenumber = "0"                                                               // dicenumber: 0
SET dicesize = "0"                                                                 // dicesize: 0
SET savingthrow = "0"                                                              // saving throw type: 0 (none)
SET savebonus = "0"                                                                // save bonus: 0
SET school = "0"                                                                   // school: 0 (schoolless)
SET lowestafflvl = "0"                                                             // lowest level affected: 0
SET highestafflvl = "0"                                                            // highest level affected: 0
SET casterx = "0"                                                                  // casterx: 0
SET castery = "0"                                                                  // castery: 0
SET targetx = "0"                                                                  // targetx: 0
SET targety = "0"                                                                  // targety: 0
SET casterlvl  = "0"                                                               // caster level: 0
SET sectype = "0"                                                                  // secondary type: 0
SPRINT ~resource~ ~~                                                               // resref: none
SPRINT ~resource2~ ~~                                                              // resref2: none
SPRINT ~resource3~ ~~                                                              // resref3: none
SPRINT ~vvcresource~ ~~                                                            // vvcresref: none
SPRINT ~effsource~ ~~                                                              // effsource: none
SPRINT ~effvar~ ~~                                                                 // effvar: none
LAUNCH_PATCH_MACRO ADD_CRE_EFFECT                                                // add new creature effect
WRITE_BYTE  0x2E "67"                                                              // major color (Shiny Gold)
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
// =============================================================================== // the actual work ends here
END                                                                                // ends file validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block


// Nishruu

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~NISHRUSU~                                                           // Nishruu
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY END
PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_validity.tpp~                                    // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
PATCH_IF valid AND LONG_AT 0x28 = 32565 BEGIN // MIST_CREATURE
  PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_reindex.tpp~                                   // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
// =============================================================================== // the actual work starts from here
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "51" END                                                // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
LPF DELETE_CRE_EFFECT                                          // delete the EFF with the designated opcode (remove any existent tint)
INT_VAR opcode_to_delete = "52" END                                                // mark opcode #52 (Colour: Very Bright by RGB) for deletion
SET opcode = "51"                                                                  // effect: #51 (Colour: Strong/Dark by RGB)
SET target = "1"                                                                   // target: 1 (self)
SET timing = "9"                                                                   // timing mode: 9 (permanent after death)
SET parameter1 = "64000"                                                           // param1: (color designation)
SET parameter2 = "2"                                                               // param2: 2 (location - major color)
SET parameter3 = "0"                                                               // param3: 0
SET parameter4 = "0"                                                               // param4: 0
SET power = "0"                                                                    // power: 0
SET resist_dispel = "0"                                                            // dispel/resistance: 0 (non-magical)
SET duration = "0"                                                                 // duration: 0
SET probability1 = "100"                                                           // probability1: 100%
SET probability2 = "0"                                                             // probability2: 0%
SET dicenumber = "0"                                                               // dicenumber: 0
SET dicesize = "0"                                                                 // dicesize: 0
SET savingthrow = "0"                                                              // saving throw type: 0 (none)
SET savebonus = "0"                                                                // save bonus: 0
SET school = "0"                                                                   // school: 0 (schoolless)
SET lowestafflvl = "0"                                                             // lowest level affected: 0
SET highestafflvl = "0"                                                            // highest level affected: 0
SET casterx = "0"                                                                  // casterx: 0
SET castery = "0"                                                                  // castery: 0
SET targetx = "0"                                                                  // targetx: 0
SET targety = "0"                                                                  // targety: 0
SET casterlvl  = "0"                                                               // caster level: 0
SET sectype = "0"                                                                  // secondary type: 0
SPRINT ~resource~ ~~                                                               // resref: none
SPRINT ~resource2~ ~~                                                              // resref2: none
SPRINT ~resource3~ ~~                                                              // resref3: none
SPRINT ~vvcresource~ ~~                                                            // vvcresref: none
SPRINT ~effsource~ ~~                                                              // effsource: none
SPRINT ~effvar~ ~~                                                                 // effvar: none
LAUNCH_PATCH_MACRO ADD_CRE_EFFECT                                                // add new creature effect
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
WRITE_BYTE  0x2E "46"                                                              // major color (red)
// =============================================================================== // the actual work ends here
END                                                                                // ends file validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block



// Nabassu

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~DEMNAB01~                                                           // Nabassu
              ~DEMNAB02~                                                           // Nabassu
              ~DEMNABSU~                                                           // Nabassu (summoned)
              ~ENDDEM04~                                                           // Nabassu
              ~ENDDEM05~                                                           // Nabassu
              ~OBSDEM05~                                                           // Nabassu
               ~PPNAB01~                                                           // Nabassu
               ~PPNAB02~                                                           // Nabassu
               ~PPNAB03~                                                           // Nabassu
               ~PMASTER~                                                           // Master of Thralls (named Nabassu within the Planar Prison)
               ~RUMAR02~                                                           // Nabassu
                ~UDNABA~                                                           // Nabassu
              ~TANARI01~                                                           // Tanar'ri (Nabassu within the Planar Sphere)
                 ~TANAR~                                                           // Aec'Letec (BGT)
                ~_TANAR~                                                           // Aec'Letec (Tutu)
              ~dw#nabsu~                                                           // SCSII Nabassu
              ~dw#drctz~                                                           // SCSII Nabassu
				~barbe2~                                                           // Nabassu (Kim NPC)
				~barbe3~                                                           // Nabassu (Kim NPC)
			  ~caddem13~                                                           // Nabassu (Rot)
			   ~caddem5~                                                           // Nabassu (Rot)
			  ~demnabr1~                                                           // Nabassu (TDD)
			  ~demnabr2~                                                           // Nabassu (TDD)
				 ~esp04~                                                           // Nabassu (Improved Volcano)
		      ~f_demdrg~                                                           // Gretaer Tanari (Drizzt Saga)
			   ~BSTANAR~                                                           // Nabassu (BST)
			  ~FINNABAS~                                                           // Nabassu (Ascension)
			   ~tg#dem2~                                                           // Nabassu (Refinement)
			  ~z#gnab01~                                                           // Nabassu (Spellhold Gauntlet)
			  ~z#gnabas~                                                           // Nabassu (Spellhold Gauntlet)
              ~fl#nabsu~                                                           //aTweaks fiend intended for SCSII
              ~fl#hsnab~                                                           //Fiendish Gating  
              ~rr#hsnab~                                                           //Fiendish Gating  
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY END
PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_validity.tpp~                                    // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
PATCH_IF valid AND LONG_AT 0x28 = 4352 BEGIN 									   // TANARRI
  PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_reindex.tpp~                                   // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
// =============================================================================== // the actual work starts from here
  // WRITE_LONG 0x28 "4352"                                                           // Sets avatar to TANARRI (winged demon)
  WRITE_BYTE  0x2E "34"                                                            // major color (Light Green/Dark Blue)
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "51" END                                              // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "52" END                                              // mark opcode #52 (Colour: Very Bright by RGB) for deletion
  LPF ADD_CRE_EFFECT                                           // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "51"                                                                  // effect: #51 (Colour: Strong/Dark by RGB)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "-168490496"                                                      // param1: (color designation)
  "parameter2" = "2"                                                               // param2: 2 (location - major color)
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
  END                                                                              // ends FUNCTION call
PATCH_FOR_EACH ~rr#color~ IN  ~50~ BEGIN                                           // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
// =============================================================================== // the actual work ends here
END                                                                                // ends file validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block


//  Special case for the SR/SCS Death Knight. We don't want to make him look like a Nabassu.

ACTION_IF FILE_EXISTS_IN_GAME ~dw#nabsu.cre~ BEGIN                                 // if the file exists
COPY_EXISTING ~dw#nabsu.cre~ ~override~
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
PATCH_IF NOT FILE_CONTAINS_EVALUATED (~%SOURCE_FILE%~ ~DVDEATHK~) BEGIN            // don't alter avatar or coloring if this is SR's Death Knight
// =============================================================================== // the actual work starts from here
  WRITE_LONG 0x28 "4352"                                                          // Sets avatar to TANARRI (winged demon)
  WRITE_BYTE  0x2E "34"                                                            // major color (Light Green/Dark Blue)
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "51" END                                              // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "52" END                                              // mark opcode #52 (Colour: Very Bright by RGB) for deletion
  LPF ADD_CRE_EFFECT                                           // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "51"                                                                  // effect: #51 (Colour: Strong/Dark by RGB)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "-168490496"                                                      // param1: (color designation)
  "parameter2" = "2"                                                               // param2: 2 (location - major color)
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
  END                                                                              // ends FUNCTION call
PATCH_FOR_EACH ~rr#color~ IN ~50~ BEGIN                                            // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
// =============================================================================== // the actual work ends here
END                                                                                // ends PATCH_IF block
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block




// Pit Fiend

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
                ~DEMPIT~                                                           // Pit Fiend
              ~DEMPIT01~                                                           // Pit Fiend
              ~DEMPITSU~                                                           // Pit Fiend (summoned)
               ~TELPIT1~                                                           // Pit Fiend
               ~TELPIT2~                                                           // Pit Fiend
               ~GORBAT1~                                                           // Ka'rashur (Watcher's Keep Baatezu leader)
			  ~caddem11~                                                           // Pit Fiend  (RoT)
			  ~caddem18~                                                           // Pit Fiend  (RoT)
			  ~caddem25~                                                           // Pit Fiend  (RoT)
			   ~caddem3~                                                           // Pit Fiend  (RoT)
			  ~dempitr1~                                                           // Pit Fiend  (TDD)
			  ~dempitr2~                                                           // Pit Fiend  (TDD)
               ~dubnd11~
              ~dw#bazpf~
              ~dw#pitsu~ 
			   ~heldem3~                                                           // Pit Fiend  (RoT)
			   ~heldem4~                                                           // Pit Fiend  (RoT)
			   ~heldem5~                                                           // Pit Fiend  (RoT)
               ~psbaatl~ 
              ~rempitsu~ 
               ~tg#dem1~ 
			  ~z#gpit01~                                                           // Pit Fiend  (Spellhold Gauntlet)
			  ~z#gpitfd~                                                           // Pit Fiend  (Spellhold Gauntlet)
			   ~z_whel1~                                                           // Pit Fiend  (ToA)
			   ~z_whel2~                                                           // Pit Fiend  (ToA)
			   ~z_whel3~                                                           // Pit Fiend  (ToA)
			   ~z_whel4~                                                           // Pit Fiend  (ToA)
              ~fl#pitsu~                                                           // aTweaks fiend intended for SCSII
              ~fl#hspit~                                                           // Fiendish Gating 
              ~rr#hspit~                                                           // Fiendish Gating 
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY END
PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_validity.tpp~                                    // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
PATCH_IF valid AND (LONG_AT 0x28 = 32558 OR LONG_AT 0x28 = 4352) BEGIN 			   // RAVER and TANARRI
  PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_reindex.tpp~                                   // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
// =============================================================================== // the actual work starts from here
  WRITE_LONG 0x28 "4352"                                                           // Sets avatar to TANARRI (winged demon)
  WRITE_BYTE  0x2E "47"                                                            // major color (dark red)
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "51" END                                              // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "52" END                                              // mark opcode #52 (Colour: Very Bright by RGB) for deletion
  LPF ADD_CRE_EFFECT                                           // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "51"                                                                  // effect: #51 (Colour: Strong/Dark by RGB)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "61440"                                                           // param1: (color designation)
  "parameter2" = "2"                                                               // param2: 2 (location - major color)
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
  END                                                                              // ends FUNCTION call
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
// =============================================================================== // the actual work ends here
END                                                                                // ends file validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block



// Balor

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
               ~BALOR01~                                                           // Balor
              ~DEMBAL01~                                                           // Balor
              ~DEMBAL02~                                                           // Balor
              ~DEMOSUM2~                                                           // Balor
              ~ENDDEM03~                                                           // Balor
                ~GORDEM~                                                           // Balor (mismatched animation fixed)
              ~GORDEMC1~                                                           // Balor
              ~JONDEM02~                                                           // Balor (mismatched animation fixed)
              ~JONDEM04~                                                           // Balor (mismatched animation fixed)
              ~M05DEMON~                                                           // Balor
              ~MELSUM04~                                                           // Balor
               ~SUDEMON~                                                           // Balor
              ~SUDEMON2~                                                           // Balor
              ~SUDEMDE1~                                                           // Balor
              ~SUDEMDE2~                                                           // Balor
               ~SUDEMW1~                                                           // Balor
               ~TELBAL1~                                                           // Balor
               ~TELBAL2~                                                           // Balor
               ~UDBALOR~                                                           // Balor
               ~GORTAN1~                                                           // Tahazzar (Watcher's Keep Tanar'ri leader)
               ~acq50002~ 
               ~actanar~ 
               ~asham~ 
               ~balorsu~ 
               ~bw05jere~ 
               ~caddem1~ 
			   ~CADDEM12~                                                           // Balor (RoT)			   
			   ~CADDEM16~                                                           // Balor (RoT)			   
			   ~CADDEM21~                                                           // Balor (RoT)			   
			   ~CADDEM4~                                                            // Balor (RoT)			   
               ~caddem17~                                                           // Balor (RoT)			   
               ~caddem18~                                                           // Balor (RoT)			   
			   ~CADDEM24~                                                           // Balor (RoT)			   
			   ~CADDEM25~                                                           // Balor (RoT)			   
			   ~CADDEM8~                                                            // Balor (RoT)			   
			   ~CADDEM9~                                                            // Balor (RoT)	
               ~cbmalrdm~ 
               ~cbtanasu~ 
               ~cratzyl~ 
               ~decre#09~ 
               ~delord~ 
               ~dembalr1~ 
               ~dembalsu~ 
               ~dpdem01~ 
               ~dsroach~ 
               ~dubnd10~ 
			   ~DW#DRCTX~                                                           // Balor (SCS)
			   ~DW#GRBAL~                                                           // Balor (SCS)
			   ~DW#SBAIM~                                                           // Balor (SCS)
			   ~eastdem2~                                                           // Glabrezu (TDD)
			   ~eastdem4~                                                           // Glabrezu (TDD)
			   ~eastdem7~                                                           // Glabrezu (TDD)
			   ~eastdem9~                                                           // Glabrezu (TDD)
               ~endragor~ 
               ~errtu~ 
               ~errtu01~ 
               ~errtu02~ 
               ~errtu03~ 
               ~f_demdrg~ 
               ~f_errtu~ 
               ~f_tanari~ 
               ~f_tansum~ 
			   ~FINBALOR~                                                           // Balor (Ascension)
               ~garg~ 
               ~glourkis~ 
               ~godmari4~                                                              // Balor (RoT)  
               ~gordemc1~                                                              // Balor (RoT) 
               ~heldem5~ 
               ~hellfear~ 
               ~hellgree~ 
               ~hellprid~ 
               ~hellself~ 
               ~holytana~ 
               ~jc_dem02~ 
               ~m#ydemon~ 
               ~ntdemon~ 
               ~orcus~ 
               ~ppdemon~ 
               ~psdem01~ 
               ~psdem02~ 
               ~psdem03~ 
               ~pstana01~ 
               ~pstanal~ 
			   ~R#DEMON~                                                            // Glabrezu (Improved Asylum)
			   ~RIATTAN1~                                                           // Glabrezu (TDD)
			   ~RIATTAN2~                                                           // Glabrezu (TDD)
			   ~RIATTAN3~                                                           // Glabrezu (TDD)
               ~rr#sbalr~ 
               ~sudemde1~ 
               ~sumtan01~ 
               ~sumtan02~ 
               ~tanarix1~                                                            // Balor (TDD)  
               ~tanarixa~                                                            // Balor (TDD)  
               ~tanarixb~                                                            // Balor (TDD)  
               ~tannar~                                                              // Balor (RoT)  
               ~tannar2~                                                             // Balor (RoT)  
               ~tannar3~                                                             // Balor (RoT)  
               ~tartar01~ 
               ~tartarus~ 
               ~tg#did3~ 
               ~tg#did4~ 
			   ~VA#BALOR~                                                           // Balor (Tower of Deception)
               ~w_rune~ 
               ~yoshimoa~                                                           // Balor (SoS) 
			   ~Z#GBALOR~                                                           // Balor (Spellhold Gauntlet)			   
			   ~Z_2BALOR~                                                           // Balor (Tales of Anegh)			   
               ~z_bered~ 
               ~z_torta~ 
               ~zy18bala~ 
               ~zy18balb~ 
               ~zy18balc~ 
               ~zy18bald~ 
               ~zy18bale~ 
               ~zy18balf~ 
               ~zy18balg~ 
               ~zy18balh~ 
               ~zy18bali~ 
               ~zy18balj~ 
               ~zy18balk~ 
               ~zy18ball~ 
               ~zy18balm~
               ~fl#balsu~                                                          //aTweaks fiend intended for SCSII
               ~fl#hsbal~                                                          //Fiendish Gating     
               ~rr#hsbal~                                                          //Fiendish Gating     
			   ~ACQ17003~                                                          // Balor (Ascalon's Quest Pack)			   
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY END
PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_validity.tpp~                                    // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
PATCH_IF valid AND LONG_AT 0x28 = 4352 BEGIN 									   // TANARRI
  PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_reindex.tpp~                                   // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
// =============================================================================== // the actual work starts from here
  // WRITE_LONG 0x28 "4352"                                                           // Sets avatar to TANARRI (winged demon)
  WRITE_BYTE  0x2E "35"                                                            // major color (orange)
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "51" END                                              // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "52" END                                              // mark opcode #52 (Colour: Very Bright by RGB) for deletion
  LPF ADD_CRE_EFFECT                                           // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "52"                                                                  // effect: #52 (Colour: Very Bright by RGB)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "16909824"                                                        // param1: (color designation)
  "parameter2" = "2"                                                               // param2: 2 (location - major color)
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
  END                                                                              // ends FUNCTION call
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
// =============================================================================== // the actual work ends here
END                                                                                // ends file validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block


// Maurezhi

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
             ~DEMMAU01~                                                            // Maurezhi
              ~GORTAN6~                                                            // Maurezhi
             ~OBSDEM04~                                                            // Maurezhi
             ~ntindfi1~                                                            // Maurezhi (NTotSC)
             ~ntindfi2~                                                            // Maurezhi (NTotSC)		 
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY END
PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_validity.tpp~                                    // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
PATCH_IF valid AND LONG_AT 0x28 = 30464 BEGIN
  PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_reindex.tpp~                                   // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
// =============================================================================== // the actual work starts from here
  WRITE_BYTE  0x2E "20"                                                            // major color (dark moldy green)
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "51" END                                              // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "52" END                                              // mark opcode #52 (Colour: Very Bright by RGB) for deletion
  LPF ADD_CRE_EFFECT                                           // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "51"                                                                  // effect: #51 (Colour: Strong/Dark by RGB)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "-1765239296"                                                     // param1: (color designation)
  "parameter2" = "2"                                                               // param2: 2 (location - major color)
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
  END                                                                              // ends FUNCTION call
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
// =============================================================================== // the actual work ends here
END                                                                                // ends file validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block


// Bone Fiend

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~DBONEF01~                                                           // Bone Fiend
              ~GORBAT5~                                                            // Bone Fiend
              ~MELSUM02~                                                           // Bone Fiend - Demon knight ??
			  ~DW#VIBON~                                                           // Bone Fiend (SCS & Wheels)
			  ~DW#BFSUM~                                                           // Bone Fiend (Stratagems)
              ~fl#hsbfn~                                                           // Fiendish Gating
              ~rr#hsbfn~                                                           // Fiendish Gating
			  ~cbgrbone~                                                           // Bone Fiend (SoS)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY END
PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_validity.tpp~                                    // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
PATCH_IF valid AND LONG_AT 0x28 = 60192 BEGIN 									   // IC_SKELETONB
  PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_reindex.tpp~                                   // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
// =============================================================================== // the actual work starts from here
  WRITE_BYTE  0x2E "36"                                                            // major color (light dirty yellow)
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "51" END                                              // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "52" END                                              // mark opcode #52 (Colour: Very Bright by RGB) for deletion
  LPF ADD_CRE_EFFECT                                           // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "51"                                                                  // effect: #51 (Colour: Strong/Dark by RGB)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "2112284160"                                                      // param1: (color designation)
  "parameter2" = "2"                                                               // param2: 2 (location - major color)
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
  END                                                                              // ends FUNCTION call
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
// =============================================================================== // the actual work ends here
END                                                                                // ends file validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block


// Abishai (Red)

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~ABISRED1~                                                           // Abishai RED
              ~DEMABI01~                                                           // Abishai RED
			  ~abishai~															   // Abishai RED (RoT)
			  ~abishai1~                                                           // Abishai RED (RoT)
			  ~godabis1~                                                           // Abishai RED (RoT)
			  ~godabis2~                                                           // Abishai RED (RoT)
			  ~remorle~                                                            // Abishai RED (RoT)
			  ~nsabish~                                                            // Abishai RED (Saerileth)
			  ~psbaat02~                                                           // Abishai RED (Planar Sphere)
			  ~psbaat2a~                                                           // Abishai RED (Planar Sphere)
			  ~rabi~                                                           	   // Abishai RED (BP)
			  ~redabi01~                                                           // Abishai RED (BP)
              ~fl#hsabi~                                                           // Fiendish Gating
              ~rr#hsabi~                                                           // Fiendish Gating
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY END
PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_validity.tpp~                                    // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
PATCH_IF valid AND LONG_AT 0x28 = 57568 BEGIN 									   // IC_CORNUGONSKI
  PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_reindex.tpp~                                   // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
// =============================================================================== // the actual work starts from here
  WRITE_BYTE  0x2E "46"                                                            // major color (red)
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "51" END                                              // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "52" END                                              // mark opcode #52 (Colour: Very Bright by RGB) for deletion
  LPF ADD_CRE_EFFECT                                           // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "51"                                                                  // effect: #51 (Colour: Strong/Dark by RGB)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "61440"                                                           // param1: (color designation)
  "parameter2" = "2"                                                               // param2: 2 (location - major color)
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
  END                                                                              // ends FUNCTION call
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
// =============================================================================== // the actual work ends here
END                                                                                // ends file validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block


// Hellcat

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~GORCAMB6~                                                           // Hellcat
              ~GORCAMB7~                                                           // Hellcat
               ~HGFEL01~                                                           // Hellcat
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY END
PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_validity.tpp~                                    // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
PATCH_IF valid BEGIN
  PATCH_INCLUDE ~%MOD_FOLDER%/lib/fj_cre_reindex.tpp~                                   // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
// =============================================================================== // the actual work starts from here
WRITE_BYTE  0x2E "5"                                                               // major color (light silver)
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "51" END                                              // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "52" END                                              // mark opcode #52 (Colour: Very Bright by RGB) for deletion
  LPF ADD_CRE_EFFECT                                           // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "52"                                                                  // effect: #52 (Colour: Very Bright by RGB)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "1684300800"                                                      // param1: (color designation)
  "parameter2" = "2"                                                               // param2: 2 (location - major color)
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
  END                                                                              // ends FUNCTION call
  LPF ADD_CRE_EFFECT                                           // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "65"                                                                  // effect: #65 (Blur)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "0"                                                               // param1: 0
  "parameter2" = "0"                                                               // param2: 0
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
  END                                                                              // ends FUNCTION call
  LPF ADD_CRE_EFFECT                                           // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "66"                                                                  // effect: #66 (Transparency Fade)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "240"                                                             // param1: (fade amount)
  "parameter2" = "0"                                                               // param2: 0
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
  END                                                                              // ends FUNCTION call
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
// =============================================================================== // the actual work ends here
END                                                                                // ends file validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block


// Special transparency and coloring effects for the Emphatic Manifestation in the Unseeing Eye quest

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~RIFTCR04~                                                           // Emphatic Manifestation
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "8" END                                               // mark opcode #8 (Colour: Change by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "9" END                                               // mark opcode #9 (Colour Glow Pulse) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "51" END                                              // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "52" END                                              // mark opcode #52 (Colour: Very Bright by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "66" END                                              // mark opcode #66 (transparency fade) for deletion
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "8"                                                                   // effect: #8 (Colour: Change by RGB)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "64000"                                                           // param1: (RGB colour)
  "parameter2" = "2"                                                               // param2: (location)
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
END
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "65"                                                                  // effect: #65 (blur)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "0"                                                               // param1: 0
  "parameter2" = "0"                                                               // param2: 0
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
END
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "66"                                                                  // effect: #66 (transparency fade)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "240"                                                             // param1: (fade amount)
  "parameter2" = "0"                                                               // param2: 0
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends FUNCTION call
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
WRITE_LONG 0x28 "4352"                                                            // Sets avatar to TANARRI (winged demon)
WRITE_BYTE  0x2E "47"                                                              // major color (dark red)
// =============================================================================== // the actual work ends here
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block


// Dryad

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~DRYAD~                                                              // Dryad of the Cloudpeaks (BGT)
              ~_DRYAD~                                                             // Dryad of the Cloudpeaks (Tutu)
              ~DRY01~                                                              // Dryad (unused?)
              ~DRYAD01~                                                            // Dryad (unused?)
              ~DRYAD02~                                                            // Dryad (unused?)
              ~DRYAD03~                                                            // Dryad (unused?)
              // ~IDRYAD02~                                                           // Cania (one of Irenicus captive Dryads)
              ~rr#sdrya~                                                           // aTweaks' summoned Dryad
              ~dr01mod~                                                            // PofQuestPack
              ~drmod~                                                              // PofQuestPack
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
PATCH_IF LONG_AT 0x28 = 8192 BEGIN 									    		   // Sirine
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
  WRITE_BYTE 0x2C 15                                                               // metal color (Pastel Green)
  WRITE_BYTE 0x2D 54                                                               // minor color (Dark Green)
  WRITE_BYTE 0x2E 69                                                               // major color (Shiny Green)
  WRITE_BYTE 0x2F 26                                                               // skin color (Wood)
  WRITE_BYTE 0x30 32                                                               // leather color (Dark Sea Green)
  WRITE_BYTE 0x31 20                                                               // armor color (Dark Moldy Green)
  WRITE_BYTE 0x32 67                                                               // hair color (Shiny Gold)
// =============================================================================== // the actual work ends here
END                                                                                // ends animation validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block


// Hamadryad

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              // ~VAELASA~                                                            // Vaelasa (Fairy Queen in Windsper Hills)
              ~DRYADHA~                                                            // Hamadryad (BGT)
              ~_DRYADHA~                                                           // Hamadryad (Tutu)
              ~HAMASU~                                                             // deault summoned Hamadryad (unused?)
              ~rr#shama~                                                           // aTweaks' summoned Hamadryad
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
PATCH_IF LONG_AT 0x28 = 8192 BEGIN 									   			   // Sirine
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
  WRITE_BYTE 0x2C 36                                                               // metal color (Light Dirty Yellow)
  WRITE_BYTE 0x2D 7                                                                // minor color (Light Metallic Green)
  WRITE_BYTE 0x2E 103                                                              // major color (Pine Green)
  WRITE_BYTE 0x2F 16                                                               // skin color (Silverish Gold)
  WRITE_BYTE 0x30 20                                                               // leather color (Dark Moldy Green)
  WRITE_BYTE 0x31 15                                                               // armor color (Pastel Green)
  WRITE_BYTE 0x32 53                                                               // hair color (Green)
// =============================================================================== // the actual work ends here
END                                                                                // ends animation validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block


// Nymph

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~HGNYMPH~                                                            // Nymph
              ~NYMPHSU~                                                            // default summoned Nymph
              ~ABELA~                                                              // Abela the Nymph (BGT)
              ~_ABELA~                                                             // Abela the Nymph (Tutu)
              ~rr#snymp~                                                           // aTweaks' summoned Nymph
              ~dvnymph~                                                            // Spell Revisions' summoned Nymph
             ~dw#nymsu~                                                            // SCSII summoned Nymph
              ~NYMPHSUM~                                                           // summoned Nymph
              ~WQXNYM~                                                             // White Queen Nymph

BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
PATCH_IF LONG_AT 0x28 = 8192 BEGIN 									   			   // Sirine
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
  WRITE_BYTE 0x2C 115                                                              // metal color (Sunkissed)
  WRITE_BYTE 0x2D 85                                                               // minor color (21 Carat Gold)
  WRITE_BYTE 0x2E 67                                                               // major color (Shiny Gold)
  WRITE_BYTE 0x2F 11                                                               // skin color (Light Rose Red)
  WRITE_BYTE 0x30 115                                                              // leather color (Sunkissed)
  WRITE_BYTE 0x31 115                                                              // armor color (Sunkissed)
  WRITE_BYTE 0x32 4                                                                // hair color (Auburn)
// =============================================================================== // the actual work ends here
END                                                                                // ends animation validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block


// Sirine

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
                ~SIRINE~                                                           // Sirine (BGT)
               ~_SIRINE~                                                           // Sirine (Tutu)
              ~SIRINE_A~                                                           // Sirine (BGT)
              ~_IRINE_A~                                                           // Sirine (Tutu)
              ~SIRINE_B~                                                           // Sirine (BGT)
              ~_IRINE_B~                                                           // Sirine (Tutu)
              ~SIRINE01~                                                           // Sirine
              ~SIRINE02~                                                           // Sirine (BGT)
              ~_IRINE02~                                                           // Sirine (Tutu)
                   ~SIL~                                                           // Sil (BGT)
                  ~_SIL~                                                           // Sil (Tutu)
			  ~J#SIRIN1~ 														   //Sirine (Jarl Adv)
			  ~J#SIRIN2~ 														   //Sirine (Jarl Adv)
			    ~L#NDC1~
			   ~NTSILUA~ 														   //Sirine (NTotSC)
			  ~NTSIRIN2~ 														   //Sirine (NTotSC)
			  ~NTSIRIN4~ 														   //Sirine (NTotSC)
			    ~ISLSIR~ 														   //Sirine Queen (BGT)
			    ~MEIALA~ 														   //Sirine (BGT)
			  ~QSEROMOD~ 														   //PofQuestPack
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
PATCH_IF LONG_AT 0x28 = 8192 BEGIN 									   			   // Sirine
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
  WRITE_BYTE 0x2C 25                                                               // metal color (Dark Pure Gold)
  WRITE_BYTE 0x2D 31                                                               // minor color (Light Sea Blue)
  WRITE_BYTE 0x2E 56                                                               // major color (Dark Turquoise)
  WRITE_BYTE 0x2F 15                                                               // skin color (Pastel Green)
  WRITE_BYTE 0x30 14                                                               // leather color (Dark Pure Silver)
  WRITE_BYTE 0x31 20                                                               // armor color (Dark Moldy Green)
  // WRITE_BYTE 0x32 5                                                             // hair color (Light Silver)
// =============================================================================== // the actual work ends here
END                                                                                // ends animation validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block


// Nereid

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~SHOAL~                                                              // Shoal the Nereid (BGT)
              ~_SHOAL~                                                             // Shoal the Nereid (Tutu)
            ~rr#enere~                                                             // aTweaks' Nereid
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
PATCH_IF LONG_AT 0x28 = 8192 BEGIN 									   			   // Sirine
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
  WRITE_BYTE 0x2C 25                                                               // metal color (Dark Pure Gold)
  WRITE_BYTE 0x2D 32                                                               // minor color (Dark Sea Green)
  WRITE_BYTE 0x2E 58                                                               // major color (Dark Blue)
  WRITE_BYTE 0x2F 97                                                               // skin color (Light Minty Blue)
  WRITE_BYTE 0x30 14                                                               // leather color (Dark Pure Silver)
  WRITE_BYTE 0x31 20                                                               // armor color (Dark Moldy Green)
  WRITE_BYTE 0x32 16                                                               // hair color (Silverish Gold)
// =============================================================================== // the actual work ends here
END                                                                                // ends animation validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block


// Succubus

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              // ~DEMSUC01~                                                        // Succubus - already have a different color
              ~GORSUC01~                                                           // Succubus
               // ~GORTAN2~                                                        // Succubus - already have a different color
              ~GORWOM01~                                                           // Nalmissra
                // ~KIRINH~                                                        // Kirinhale, the Succubus in Durlag's Tower (BGT) - already have a different color
               // ~_KIRINH~                                                        // Kirinhale, the Succubus in Durlag's Tower (Tutu) - already have a different color
              ~RR#HSSUC~                                                           // aTweaks Succubus (Fiendish Gating)
              // ~x#amelia~                                                        // Amelia, the Succubus added by BG1 NPCs during Coran's quest - already have a different color
			  ~yugsuc01~                                                           // Succubus (Longer Road)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
PATCH_IF LONG_AT 0x28 = 8192 BEGIN 									   			   // Sirine
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
  WRITE_BYTE 0x2C 47                                                               // metal color (Pure Dark Red)
  WRITE_BYTE 0x2D 47                                                               // minor color (Pure Dark Red)
  WRITE_BYTE 0x2E 101                                                              // major color (Light Metallic Red)
  WRITE_BYTE 0x2F 12                                                               // skin color (Light Carnation Pink)
  WRITE_BYTE 0x30 19                                                               // leather color (Dark Rose Red)
  WRITE_BYTE 0x31 19                                                               // armor color (Dark Rose Red)
  WRITE_BYTE 0x32 47                                                               // hair color (Pure Dark Red)
// =============================================================================== // the actual work ends here
END                                                                                // ends animation validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block

// Aerial Servant

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~SERVSU~                                                             // Aerial Servant
            ~rr#easer~                                                             // Aerial Servant (aTweaks)
			 ~gtt#ser~                                                             // Aerial Servant ?
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
PATCH_IF LONG_AT 0x28 = 29473 BEGIN 								  			   // Air elmental small
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "8" END                                               // mark opcode #8 (Colour: Change by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "9" END                                               // mark opcode #9 (Colour Glow Pulse) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "51" END                                              // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "52" END                                              // mark opcode #52 (Colour: Very Bright by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "66" END                                              // mark opcode #66 (transparency fade) for deletion
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "8"                                                                   // effect: #8 (Colour: Change by RGB)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "-1778384896"                                                     // param1: (RGB colour)
  "parameter2" = "2"                                                               // param2: (location)
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
END
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "66"                                                                  // effect: #66 (transparency fade)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "100"                                                             // param1: (fade amount)
  "parameter2" = "0"                                                               // param2: 0
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends FUNCTION call
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
  WRITE_BYTE 0x2E 17                                                               // major color (Light Blue)
// =============================================================================== // the actual work ends here
END                                                                                // ends animation validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block


// Lesser Air Elemental (8 HD)

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
            ~ELAIRL01~                                                             // Lesser Air Elemental (8 HD)
            ~ELAIRSUW~                                                             // Lesser Air Elemental (8 HD, summoned, wizard version)
			~ELAIRSU1~                                                             // Lesser Air Elemental (8 HD, summoned, priest version)
            ~ELARIL01~                                                             // Lesser Air Elemental (8 HD, Bioware's typo?)
            ~GORAIR01~                                                             // Lesser Air Elemental (8 HD, Watcher's Keep)
            ~SUMELAIR~                                                             // Lesser Air Elemental (8 HD, summoned, Staff of Air)
            ~DW#PRELA~                                                             // SCS - Prat's Lesser Air Elementals
            ~cdi8air~                                                              // Lesser Air Elemental (Iwidification)            ~_IRASPEC~                                                             // Air Aspect (Tutu)
            ~es8air~                                                               // Lesser Air Elemental (Iwidification - Stratagems)
            ~AR#ELEAI~                                                             // Lesser Air Elemental (Arena)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
PATCH_IF LONG_AT 0x28 = 29473 BEGIN 								  			   // Air elmental small
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
  WRITE_BYTE 0x2E 0                                                                // major color (Dark Silver)
// =============================================================================== // the actual work ends here
END                                                                                // ends animation validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END
                                                                                   // ends ACTION_FOR_EACH block
// Air Elemental (12 HD)

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
            ~_IRASPEC~                                                             // Air Aspect (Tutu)
            ~AIRASPEC~                                                             // Air Aspect (BGT)
             ~ELAIR01~                                                             // Air Elemental (12 HD)
            ~ELAIRSU2~                                                             // Air Elemental (12 HD, summoned, wizard version)
               ~MDAIR~                                                             // Air Elemental (12 HD, unused?)
              ~MDAIR2~                                                             // Air Elemental (12 HD, unused?)
            ~PAIREL01~                                                             // Air Elemental (12 HD, unused?)
			~DRAIRPR2~                                                             // Air Elemental (12 HD, Divine Remix)
			~ELAIRPR~                                                              // Air Elemental (12 HD, mih_sp)
            ~rr#eairr~                                                             // Air Elemental (12 HD, summoned, summoned by Chan and Yan-C-Bin in aTweaks)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
PATCH_IF LONG_AT 0x28 = 29472 BEGIN 								  			   // Air elmental
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
  WRITE_BYTE 0x2E 6                                                                // major color (Dark Silver)
// =============================================================================== // the actual work ends here
END                                                                                // ends animation validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END

// Greater Air Elemental (16 HD)

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
            ~ELAIRG01~                                                             // Greater Air Elemental (16 HD)
            ~GORAIR02~                                                             // Greater Air Elemental (16 HD, Watcher's Keep)
              ~MDAIRG~                                                             // Greater Air Elemental (16 HD, unused?)
             ~MDAIRG2~                                                             // Greater Air Elemental (16 HD, unused?)
              ~MDHSSS~                                                             // Greater Air Elemental (16 HD, unused?)
             ~_MDHSSS~                                                             // Greater Air Elemental (16 HD, unused?)
            ~SWAAIR01~                                                             // Air Elemental (16 HD, Elemental Summoning HLA)
               ~UDAIR~                                                             // Air Elemental (Underdark portal)
            ~ELAIRSU3~                                                             // Air Elemental (16 HD, wizard version)
			~DRAIRPR3~                                                             // Air Elemental (16 HD, Divine Remix)
			~ELAIRPR2~                                                             // Air Elemental (16 HD, mih_sp)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
PATCH_IF LONG_AT 0x28 = 29472 BEGIN 								  			   // Air elmental
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "8" END                                               // mark opcode #8 (Colour: Change by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "9" END                                               // mark opcode #9 (Colour Glow Pulse) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "51" END                                              // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "52" END                                              // mark opcode #52 (Colour: Very Bright by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "66" END                                              // mark opcode #66 (transparency fade) for deletion
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "52"                                                                  // effect: #52 (Colour: Very Bright by RGB)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "33686016"                                                        // param1: (RGB colour)
  "parameter2" = "2"                                                               // param2: (location)
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
END
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
  WRITE_BYTE 0x2E 5                                                                // major color (Light Silver)
// =============================================================================== // the actual work ends here
END                                                                                // ends animation validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block


// Elder Air Elemental (20+ HD)

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
               ~SUAIR~                                                             // Air Elemental (Suldanesselar, Tree of Life guardian)
            ~SWAAIR02~                                                             // Air Elemental (20+ HD, summoned, Elemental Summoning HLA)
              ~UDELDA~                                                             // Air Elemental (Underdark portal guardian)
            ~elemyanc~                                                             // Yan-C-Bin
            ~finsol02~                                                             // Yan-C-Bin in ToB
            ~elemchan~                                                             // Chan
            ~rr#eaire~                                                             // Elder Air Elemental (aTweaks)
            ~li#druai~                                                             // Elemental transformation air (Refinements)
			~MH#air20~                                                             // Elemental transformation air (mih_eq)
            ~ELAIRSU4~                                                             // Air Elemental (20+ HD, summoned, wizard version)
			~DRAIRPR4~                                                             // Air Elemental (20 HD, Divine Remix)
			~ELAIRPR3~                                                             // Air Elemental (20 HD, mih_sp)
            ~AR#ELAIK~                                                             // Air Elemental (Arena)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
PATCH_IF LONG_AT 0x28 = 29472 BEGIN 								  			   // Air elmental
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "8" END                                               // mark opcode #8 (Colour: Change by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "9" END                                               // mark opcode #9 (Colour Glow Pulse) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "51" END                                              // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "52" END                                              // mark opcode #52 (Colour: Very Bright by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "66" END                                              // mark opcode #66 (transparency fade) for deletion
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "52"                                                                  // effect: #52 (Colour: Very Bright by RGB)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "84215040"                                                        // param1: (RGB colour)
  "parameter2" = "2"                                                               // param2: (location)
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
END
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "66"                                                                  // effect: #66 (transparency fade)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "85"                                                              // param1: (fade amount)
  "parameter2" = "0"                                                               // param2: 0
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends FUNCTION call
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
  WRITE_BYTE 0x2E 74                                                               // major color (Solid White)
// =============================================================================== // the actual work ends here
END                                                                                // ends animation validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block

// Lesser Earth Elemental (8 HD)
ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
            ~ELEARL01~                                                             // Lesser Earth Elemental (8 HD)
            ~ELEARSU1~                                                             // Earth Elemental (8 HD, summoned, wizard version)
            ~ELEARSUW~                                                             // Lesser Earth Elemental (8 HD, summoned, wizard version)
            ~ELEEEL01~                                                             // Lesser Earth Elemental (8 HD)
            ~MEKEAR01~                                                             // Lesser Earth Elemental (8 HD, Mekrath's quest)
            ~SUMELEAR~                                                             // Lesser Earth Elemental (8 HD, summoned, Staff of Earth)
			~DW#viele~                                                             // Lesser Earth Elemental (8 HD, summoned, Staff of Earth)
			~cdi8erth~                                                             // Lesser Earth Elemental (8 HD, iwd)
			~es8erth~															   // Lesser Earth Elemental (IWDification - Stratagems)
            ~AR#ELEEA~                                                             // Lesser Earth Elemental (Arena)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
PATCH_IF LONG_AT 0x28 = 29441 BEGIN 								  			   // Small Earth elmental
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
  WRITE_BYTE 0x2E 8                                                                // major color (Dark Muddish Brown)
// =============================================================================== // the actual work ends here
END                                                                                // ends animation validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block

// Earth Elemental (12 HD)
ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
             ~ELEAR01~                                                             // Earth Elemental (12 HD)
             ~ELEARPR~                                                             // Earth Elemental (12 HD, summoned, priest version)
            ~ELEARSU2~                                                             // Earth Elemental (12 HD, summoned, wizard version)
              ~KEARTH~                                                             // Earth Elemental (12 HD, unused?)
             ~SHEARTH~                                                             // Earth Elemental (12 HD, Shapechange Spell)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
PATCH_IF LONG_AT 0x28 = 29440 BEGIN 								  			   // Earth elmental
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
  WRITE_BYTE 0x2E 8                                                                // major color (Dark Muddish Brown)
// =============================================================================== // the actual work ends here
END                                                                                // ends animation validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_FOR_EACH block
END																				   // ends ACTION_IF Infinity Animation Compatibility (IAv5b)

// Greater Earth Elemental (16 HD)

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
            ~ELEARG01~                                                             // Greater Earth Elemental (16 HD)
            ~ELEARPR2~                                                             // Earth Elemental (16 HD, summoned, priest version)
             ~ELEARSU~                                                             // Earth Elemental (16 HD, summoned, unused?)
            ~ELEARSU3~                                                             // Earth Elemental (16 HD, summoned, wizard version)
            ~SWAEAR01~                                                             // Earth Elemental (16 HD, summoned, Elemental Summoning HLA)
             ~UDEARTH~                                                             // Earth Elemental (Underdark portal spawn)
			~o#llgua1~                                                             // Earth Elemental
			~o#llgua2~                                                             // Earth Elemental
			~agearth1~                                                             // Earth Elemental
			~ELECALI1~                                                             // Earth Elemental (TDD)
			~ELECALI3~                                                             // Earth Elemental (TDD)
			~ELECALI5~                                                             // Earth Elemental (TDD)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
PATCH_IF LONG_AT 0x28 = 29440 BEGIN 								  			   // Earth elmental
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "8" END                                               // mark opcode #8 (Colour: Change by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "9" END                                               // mark opcode #9 (Colour Glow Pulse) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "51" END                                              // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "52" END                                              // mark opcode #52 (Colour: Very Bright by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "66" END                                              // mark opcode #66 (transparency fade) for deletion
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "52"                                                                  // effect: #52 (Colour: Very Bright by RGB)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "16909312"                                                        // param1: (RGB colour)
  "parameter2" = "2"                                                               // param2: (location)
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
END
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
  WRITE_BYTE 0x2E 9                                                                // major color (Light Muddish Brown)
// =============================================================================== // the actual work ends here
END                                                                                // ends animation validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block


// Elder Earth Elemental (20+ HD)

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
            ~DRUEAR01~                                                             // Earth Elemental (Druid Earth Elemental Transformation HLA)
            ~ELEARPR3~                                                             // Earth Elemental (20+ HD, priest version)
            ~ELEARSU4~                                                             // Earth Elemental (20+ HD, wizard version)
             ~MDEARTH~                                                             // Earth Elemental (20+ HD, unused?)
            ~MDEARTH2~                                                             // Earth Elemental (20+ HD, unused?)
             ~SUEARTH~                                                             // Earth Elemental (Suldanesselar, Tree of Life guardian)
            ~SWAEAR02~                                                             // Earth Elemental (20+ HD, Elemental Summoning HLA)
              ~UDELDE~                                                             // Earth Elemental (Underdark portal guardian)
            ~rr#eeare~                                                             // Elder Earth Elemental (aTweaks)
            ~dw#eldee~                                                             // SCSII "Improved Minor Encounters" greater earth elemental
			~mh#ear20~                                                             // mih_eq
            ~AR#ELEAK~                                                             // Earth Elemental (Arena)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
PATCH_IF LONG_AT 0x28 = 29440 BEGIN 								  			   // Earth elmental
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "8" END                                               // mark opcode #8 (Colour: Change by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "9" END                                               // mark opcode #9 (Colour Glow Pulse) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "51" END                                              // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "52" END                                              // mark opcode #52 (Colour: Very Bright by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "66" END                                              // mark opcode #66 (transparency fade) for deletion
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "52"                                                                  // effect: #52 (Colour: Very Bright by RGB)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "50726912"                                                        // param1: (RGB colour)
  "parameter2" = "2"                                                               // param2: (location)
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
END
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
  WRITE_BYTE 0x2E 49                                                               // major color (Dark Bronze)
// =============================================================================== // the actual work ends here
END                                                                                // ends animation validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block


// Sunnis

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
            ~elemsunn~                                                             // Sunnis
            ~dw#esunn~                                                             // SCSII Sunnis-alternative from "Smarter Priests"
            ~AR#ELEAK~                                                             // Earth Elemental GOD (Arena)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
PATCH_IF LONG_AT 0x28 = 29440 BEGIN 								  			   // Earth elmental
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "8" END                                               // mark opcode #8 (Colour: Change by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "9" END                                               // mark opcode #9 (Colour Glow Pulse) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "51" END                                              // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "52" END                                              // mark opcode #52 (Colour: Very Bright by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "66" END                                              // mark opcode #66 (transparency fade) for deletion
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "51"                                                                  // effect: #51 (Colour: Strong/Dark by RGB)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "65280"                                                           // param1: (RGB colour)
  "parameter2" = "2"                                                               // param2: (location)
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
END
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
  WRITE_BYTE 0x2E 49                                                               // major color (Dark Bronze)
// =============================================================================== // the actual work ends here
END                                                                                // ends animation validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block

// Ogremoch

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
            ~elemogre~                                                             // Ogremoch
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
PATCH_IF LONG_AT 0x28 = 29440 BEGIN 								  			   // Earth elmental
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "8" END                                               // mark opcode #8 (Colour: Change by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "9" END                                               // mark opcode #9 (Colour Glow Pulse) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "51" END                                              // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "52" END                                              // mark opcode #52 (Colour: Very Bright by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "66" END                                              // mark opcode #66 (transparency fade) for deletion
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "51"                                                                  // effect: #51 (Colour: Strong/Dark by RGB)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "-16720896"                                                       // param1: (RGB colour)
  "parameter2" = "2"                                                               // param2: (location)
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
END
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
  WRITE_BYTE 0x2E 94                                                               // major color (Rhubarb)
// =============================================================================== // the actual work ends here
END                                                                                // ends animation validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block


// Lesser Fire Elemental (8 HD)

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
            ~ELEFEL01~                                                             // Lesser Fire Elemental (8 HD)
            ~ELFIRL01~                                                             // Lesser Fire Elemental (8 HD)
            ~ELFIRSU1~                                                             // Fire Elemental (8 HD, summoned, wizard version)
            ~ELFIRSUW~                                                             // Lesser Fire Elemental (8 HD, summoned, wizard version)
            ~SUMELFIR~                                                             // Lesser Fire Elemental (8 HD, summoned, Staff of Fire)
			~BSFRELEM~                                                             // Lesser Fire Elemental (BST)
			~cdi8fire~                                                             // Lesser Fire Elemental (iwd)
			 ~es8fire~															   // Lesser Fire Elemental (IWDification - Stratagems)
            ~AR#ELEFI~                                                             // Lesser Fire Elemental (Arena)
            ~FIRLSMOD~                                                             // Lesser Fire Elemental (PofQuestPack)
            ~PXF5ELEM~                                                             // Lesser Fire Elemental (Devin)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
PATCH_IF LONG_AT 0x28 = 29457 BEGIN 								  			   // Fire Elemental Small
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "8" END                                               // mark opcode #8 (Colour: Change by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "9" END                                               // mark opcode #9 (Colour Glow Pulse) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "51" END                                              // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "52" END                                              // mark opcode #52 (Colour: Very Bright by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "66" END                                              // mark opcode #66 (transparency fade) for deletion
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "51"                                                                  // effect: #51 (Colour: Strong/Dark by RGB)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "9566720"                                                         // param1: (RGB colour)
  "parameter2" = "2"                                                               // param2: (location)
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
END
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
  WRITE_BYTE 0x2E 4                                                                // major color (Auburn)
// =============================================================================== // the actual work ends here
END                                                                                // ends animation validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block


// Fire Elemental (12 HD)

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
            ~C6DROWGO~                                                             // Fire Elemental (12 HD, Underdark Exit)
            ~DDGUARD7~                                                             // Guardian (Tomb of King Strohm III)
               ~ELFIR~                                                             // Fire Elemental (12 HD)
             ~ELFIR01~                                                             // Fire Elemental (12 HD)
             ~ELFIRPR~                                                             // Fire Elemental (12 HD, summoned, priest version)
            ~ELFIRSU2~                                                             // Fire Elemental (12 HD, summoned, wizard version)
              ~SHFIRE~                                                             // Fire Elemental (12 HD, Shapechange Spell)
                 ~AMX~                                                             // Fire Elemental (12 HD, TDD)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
PATCH_IF LONG_AT 0x28 = 29456 BEGIN 								  			   // Fire Elemental
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
  WRITE_BYTE 0x2E 67                                                               // major color (Shiny Gold)
// =============================================================================== // the actual work ends here
END                                                                                // ends animation validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block

// Greater Fire Elemental (16 HD)

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
            ~DECKFELE~                                                             // Fire Elemental (Deck of Many Things)
            ~ELFIRG01~                                                             // Fire Elemental (16 HD)
            ~ELFIRPR2~                                                             // Fire Elemental (16 HD, summoned, priest version)
            ~ELFIRSU~                                                              // Fire Elemental (16 HD, summoned, unused?)
            ~ELFIRSU3~                                                             // Fire Elemental (16 HD, summoned, wizard version)
            ~GORFIR01~                                                             // Greater Fire Elemental (16 HD, Watcher's Keep)
            ~GORFIR02~                                                             // Greater Fire Elemental (16 HD, Watcher's Keep)
            ~GORFIR03~                                                             // Greater Fire Elemental (16 HD, Watcher's Keep)
            ~GORFIR04~                                                             // Greater Fire Elemental (16 HD, Watcher's Keep)
            ~OBSFIR06~                                                             // Greater Fire Elemental (16 HD, Planar Sphere)
            ~SUELEW1~                                                              // Greater Fire Elemental (16 HD, summoned, unused?)
            ~SUELEW2~                                                              // Greater Fire Elemental (16 HD, summoned, unused?)
            ~SWAFIR01~                                                             // Fire Elemental (16 HD, summoned, Elemental Summoning HLA)
            ~TELELFIR~                                                             // Greater Fire Elemental (16 HD, Watcher's Keep)
            ~YSCARA04~                                                             // Greater Fire Elemental (16 HD, unused?)
            ~UDFIRE~                                                               // Fire Elemental (Underdark portal spawn)
            ~tg#did5~                                                              // Greater Fire Elemental (Refinements; special)
			~O#BRELE1~                                                             // Greater Fire Elemental (16 HD)
			~O#BRELE2~                                                             // Greater Fire Elemental (16 HD)
			~O#BRELE3~                                                             // Greater Fire Elemental (16 HD)
			~O#BRELE4~                                                             // Greater Fire Elemental (16 HD)
			~a7q5fe01~                                                             // Greater Fire Elemental (16 HD) (afaaq)
			~a7q5fe02~                                                             // Greater Fire Elemental (16 HD) (afaaq)
			~a7q5fe03~                                                             // Greater Fire Elemental (16 HD) (afaaq)
			~a7q5fe04~                                                             // Greater Fire Elemental (16 HD) (afaaq)
			~a7q5fe05~                                                             // Greater Fire Elemental (16 HD) (afaaq)
			~a7q5fe06~                                                             // Greater Fire Elemental (16 HD) (afaaq)
			~a7q5fe07~                                                             // Greater Fire Elemental (16 HD) (afaaq)
			~a7q5fe08~                                                             // Greater Fire Elemental (16 HD) (afaaq)
			~a7q5fe09~                                                             // Greater Fire Elemental (16 HD) (afaaq)
			~a7q5fe10~                                                             // Greater Fire Elemental (16 HD) (afaaq)
			~a7q5fe11~                                                             // Greater Fire Elemental (16 HD) (afaaq)
			~a7q5fe12~                                                             // Greater Fire Elemental (16 HD) (afaaq)
			~a7q5fes~                                                              // Greater Fire Elemental (16 HD) (afaaq)
			~ELECALI2~                                                             // Greater Fire Elemental (TDD)
			~ELECALI4~                                                             // Greater Fire Elemental (TDD)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
PATCH_IF LONG_AT 0x28 = 29456 BEGIN 								  			   // Fire Elemental
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "8" END                                               // mark opcode #8 (Colour: Change by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "9" END                                               // mark opcode #9 (Colour Glow Pulse) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "51" END                                              // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "52" END                                              // mark opcode #52 (Colour: Very Bright by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "66" END                                              // mark opcode #66 (transparency fade) for deletion
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "52"                                                                  // effect: #52 (Colour: Very Bright by RGB)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "197376"                                                          // param1: (RGB colour)
  "parameter2" = "2"                                                               // param2: (location)
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
END
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
  WRITE_BYTE 0x2E 24                                                               // major color (Dark Gold)
// =============================================================================== // the actual work ends here
END                                                                                // ends animation validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block


// Elder Fire Elemental (20+ HD)

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
            ~DRUFIR01~                                                             // Fire Elemental (Druid Fire Elemental Transformation HLA)
            ~ELFIRPR3~                                                             // Fire Elemental (20+ HD, summoned, priest version)
            ~ELFIRSU4~                                                             // Fire Elemental (20+ HD, summoned, wizard version)
             ~SUFIRE~                                                              // Fire Elemental (Suldanesselar, Tree of Life guardian)
            ~SWAFIR02~                                                             // Fire Elemental (20+ HD, summoned, Elemental Summoning HLA)
              ~UDELDF~                                                             // Fire Elemental (Underdark, portal guardian)
            ~rr#efire~                                                             // Elder Fire Elemental (aTweaks)
			~MH#fir20~                                                             // Fire Elemental (mih_eq)
            ~AR#ELFIK~                                                             // Fire Elemental (Arena)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
PATCH_IF LONG_AT 0x28 = 29456 BEGIN 								  			   // Fire Elemental
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "8" END                                               // mark opcode #8 (Colour: Change by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "9" END                                               // mark opcode #9 (Colour Glow Pulse) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "51" END                                              // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "52" END                                              // mark opcode #52 (Colour: Very Bright by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "66" END                                              // mark opcode #66 (transparency fade) for deletion
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "52"                                                                  // effect: #52 (Colour: Very Bright by RGB)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "394752"                                                          // param1: (RGB colour)
  "parameter2" = "2"                                                               // param2: (location)
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
END
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
  WRITE_BYTE 0x2E 50                                                               // major color (Dark Yellow)
// =============================================================================== // the actual work ends here
END                                                                                // ends animation validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block

// Fire Elemental Princes (Imix and Zaaman Rul)

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
            ~elemimix~                                                             // Imix
            ~elemzaam~                                                             // Zaaman Rul
            ~dw#ezaam~                                                             // SCSII alternative from "Smarter Priests"
            ~AR#FIRGD~                                                             // Fire Elemental GOD (Arena)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
PATCH_IF LONG_AT 0x28 = 29456 BEGIN 								  			   // Fire Elemental
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
  WRITE_LONG 0x28 "29460"                                                          // Sets avatar to BURNING_MAN
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "8" END                                               // mark opcode #8 (Colour: Change by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "9" END                                               // mark opcode #9 (Colour Glow Pulse) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "51" END                                              // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "52" END                                              // mark opcode #52 (Colour: Very Bright by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "66" END                                              // mark opcode #66 (transparency fade) for deletion
  WRITE_BYTE 0x2E 25                                                               // major color (Dark Pure Gold)
// =============================================================================== // the actual work ends here
END                                                                                // ends animation validity check
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block

// Water Weird

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
              ~rr#ewwei~                                                           // aTweaks' Water Weird
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "8" END                                               // mark opcode #8 (Colour: Change by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "9" END                                               // mark opcode #9 (Colour Glow Pulse) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "51" END                                              // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "52" END                                              // mark opcode #52 (Colour: Very Bright by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "66" END                                              // mark opcode #66 (transparency fade) for deletion
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "66"                                                                  // effect: #66 (transparency fade)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "125"                                                             // param1: (fade amount)
  "parameter2" = "0"                                                               // param2: 0
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends FUNCTION call
  WRITE_BYTE 0x2E 31                                                               // major color (Light Sea Blue)
// =============================================================================== // the actual work ends here
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block

// Water Elemental

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
            ~rr#ewatr~                                                             // Water Elemental (aTweaks)
            ~tg#wel2~                                                              // Water Elemental (Refinements)
			~DW#WATE2~                                                             // Water Elemental (SCS)
			~ELWATPR~                                                              // Water Elemental (mih_sp)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "8" END                                               // mark opcode #8 (Colour: Change by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "9" END                                               // mark opcode #9 (Colour Glow Pulse) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "51" END                                              // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "52" END                                              // mark opcode #52 (Colour: Very Bright by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "66" END                                              // mark opcode #66 (transparency fade) for deletion
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "66"                                                                  // effect: #66 (transparency fade)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "125"                                                             // param1: (fade amount)
  "parameter2" = "0"                                                               // param2: 0
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends FUNCTION call
  WRITE_BYTE 0x2E 68                                                               // major color (Light Sea Blue)
// =============================================================================== // the actual work ends here
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END

// Greater Water Elemental

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
            ~ELWATG01~                                                             // Greater Water Elemental
            ~tg#wel3~                                                              // Greater Water Elemental (Refinements)
			~DW#WATE3~                                                             // Greater Water Elemental (SCS)
			~ELEMWAG~                                                              // Greater Water Elemental (TS)
			~WATERELT~                                                             // Greater Water Elemental (TS)
			~ELWATPR2~                                                             // Greater Water Elemental (mih_sp)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "8" END                                               // mark opcode #8 (Colour: Change by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "9" END                                               // mark opcode #9 (Colour Glow Pulse) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "51" END                                              // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "52" END                                              // mark opcode #52 (Colour: Very Bright by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "66" END                                              // mark opcode #66 (transparency fade) for deletion
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "52"                                                                  // effect: #52 (Colour: Very Bright by RGB)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "50397184"                                                        // param1: (RGB colour)
  "parameter2" = "2"                                                               // param2: (location)
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
END
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "66"                                                                  // effect: #66 (transparency fade)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "75"                                                              // param1: (fade amount)
  "parameter2" = "0"                                                               // param2: 0
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends FUNCTION call
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
  WRITE_BYTE 0x2E 57                                                               // major color (Light Blue)
// =============================================================================== // the actual work ends here
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block

// Elder Water Elemental

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
            ~rr#ewate~                                                             // Elder Water Elemental (aTweaks)
            ~li#druwa~                                                             // Elemental transformation water (Refinements)
		    ~DW#wate4~                                                             // Water Elemental (SCS)
			~MH#wat20~                                                             // Water Elemental (mih_eq)
			~ELWATPR3~                                                             // Elder Water Elemental (mih_sp)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "8" END                                               // mark opcode #8 (Colour: Change by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "9" END                                               // mark opcode #9 (Colour Glow Pulse) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "51" END                                              // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "52" END                                              // mark opcode #52 (Colour: Very Bright by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "66" END                                              // mark opcode #66 (transparency fade) for deletion
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "52"                                                                  // effect: #52 (Colour: Very Bright by RGB)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "218300416"                                                       // param1: (RGB colour)
  "parameter2" = "2"                                                               // param2: (location)
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
END
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "66"                                                                  // effect: #66 (transparency fade)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "75"                                                              // param1: (fade amount)
  "parameter2" = "0"                                                               // param2: 0
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends FUNCTION call
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
  WRITE_BYTE 0x2E 58                                                               // major color (Light Blue)
// =============================================================================== // the actual work ends here
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END

// Fire Salamander

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
             ~hgsal01~                                                             // Fire Salamander
            ~icsalfir~                                                             // Fire Salamander (Planar Sphere)
             ~plysala~                                                             // Fire Salamander (Avenger kit shapechange)
			~wrmons01~                                                             // Fire Salamander (Hell Wrath, possibly unused?)
            ~a7q5fs02~                                                             // Fire Salamander (afaaq)
			~a7q5fs03~                                                             // Fire Salamander (afaaq)
			~a7q5fs04~                                                             // Fire Salamander (afaaq)
			~a7q5fs05~                                                             // Fire Salamander (afaaq)
			~a7q5fs06~                                                             // Fire Salamander (afaaq)
			~firesal1~                                                             // Fire Salamander (RoT)
			~cdi6salf~                                                             // Fire Salamander (IWDification)
			~ms6salf~                                                              // Fire Salamander (IWDification - Stratagems)
			~nthells1~                                                             // Fire Salamander (NTotSC)
			~nthells3~                                                             // Fire Salamander (NTotSC)
			~o#brsal1~                                                             // Fire Salamander
			~o#brsal2~                                                             // Fire Salamander
			~pxf5sala~                                                             // Fire Salamander (DEVIN)
			~va#fsala~                                                             // Fire Salamander (Tower of Deception)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "8" END                                               // mark opcode #8 (Colour: Change by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "9" END                                               // mark opcode #9 (Colour Glow Pulse) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "51" END                                              // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "52" END                                              // mark opcode #52 (Colour: Very Bright by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "66" END                                              // mark opcode #66 (transparency fade) for deletion
  WRITE_BYTE 0x2E 49                                                               // major color (Dark Bronze)
// =============================================================================== // the actual work ends here
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block


// Frost/Ice Salamander

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
            ~salgrice~                                                             // Frost Salamander (Abazigal's Lair)
            ~icsalcol~                                                             // Ice Salamander (Planar Sphere)
            ~telicesa~                                                             // Ice Salamander (unused?)
			~cdi6salc~                                                             // Ice Salamander (IWDification)
			~ms6salc~                                                              // Ice Salamander (IWDification - Stratagems)
			~dw#visal~                                                             // Ice Salamander (SCS)
			~ntsalmi3~                                                             // Ice Salamander (NTotSC)
			~ntsalmic~                                                             // Ice Salamander (NTotSC)
		    ~va#isala~                                                             // Ice Salamander (Tower of Deception)
			~icesal~                                                               // Ice Salamander (RoT)
			~icesal2~                                                              // Ice Salamander (RoT)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "8" END                                               // mark opcode #8 (Colour: Change by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "9" END                                               // mark opcode #9 (Colour Glow Pulse) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "51" END                                              // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "52" END                                              // mark opcode #52 (Colour: Very Bright by RGB) for deletion
  WRITE_BYTE 0x2E 58                                                               // major color (Dark Blue)
// =============================================================================== // the actual work ends here
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block


// Salamander Noble

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
            ~SALGRFIR~                                                             // Salamander Noble
			~a7q5fs01~                                                             // Salamander Noble (afaaq)
			~salking~                                                              // Fire Salamander King (RoT)
			~firesal2~                                                             // Fire Salamander (RoT)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "8" END                                               // mark opcode #8 (Colour: Change by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "9" END                                               // mark opcode #9 (Colour Glow Pulse) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "51" END                                              // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "52" END                                              // mark opcode #52 (Colour: Very Bright by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "66" END                                              // mark opcode #66 (transparency fade) for deletion
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "52"                                                                  // effect: #52 (Colour: Very Bright by RGB)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "394752"                                                          // param1: (RGB colour)
  "parameter2" = "2"                                                               // param2: (location)
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
END
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
  WRITE_BYTE 0x2E 80                                                               // major color (Saturated Bronze)
// =============================================================================== // the actual work ends here
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block


// Ice Paraelemental

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
            ~rr#eicer~                                                             // Ice Paraelemental (aTweaks)
			~mh#icepe~                                                             // Ice Paraelemental (mih_eq)
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "8" END                                               // mark opcode #8 (Colour: Change by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "9" END                                               // mark opcode #9 (Colour Glow Pulse) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "51" END                                              // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "52" END                                              // mark opcode #52 (Colour: Very Bright by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "66" END                                              // mark opcode #66 (transparency fade) for deletion
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "52"                                                                  // effect: #52 (Colour: Very Bright by RGB)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "50529024"                                                        // param1: (RGB colour)
  "parameter2" = "2"                                                               // param2: (location)
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends FUNCTION call
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "66"                                                                  // effect: #66 (transparency fade)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "55"                                                              // param1: (fade amount)
  "parameter2" = "0"                                                               // param2: 0
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends FUNCTION call
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
  WRITE_BYTE 0x2E 71                                                               // major color (Frost Blue)
// =============================================================================== // the actual work ends here
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block


// Cryonax

ACTION_FOR_EACH ~file~ IN                                                          // for each of the following files
            ~elemcryo~                                                             // Cryonax
            ~finsol03~                                                             // Cryonax in ToB
BEGIN                                                                              // execute the following
ACTION_IF FILE_EXISTS_IN_GAME ~%file%.cre~ BEGIN                                   // if the file exists
COPY_EXISTING ~%file%.cre~ ~override~
LPF FJ_CRE_VALIDITY
 INT_VAR do_message = 1
END
// =============================================================================== // the actual work starts from here
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "8" END                                               // mark opcode #8 (Colour: Change by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "9" END                                               // mark opcode #9 (Colour Glow Pulse) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "51" END                                              // mark opcode #51 (Colour: Strong/Dark by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "52" END                                              // mark opcode #52 (Colour: Very Bright by RGB) for deletion
  LPF DELETE_CRE_EFFECT                                        // delete the EFF with the designated opcode (remove any existent tint)
  INT_VAR opcode_to_delete = "66" END                                              // mark opcode #66 (transparency fade) for deletion
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "52"                                                                  // effect: #52 (Colour: Very Bright by RGB)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "67108864"                                                        // param1: (RGB colour)
  "parameter2" = "2"                                                               // param2: (location)
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends FUNCTION call
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call (add new creature effect built-in function)
  INT_VAR                                                                          // initialize numeric variables
  "opcode" = "66"                                                                  // effect: #66 (transparency fade)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "sectype" = "0"                                                                  // secondary type: none
  "parameter1" = "50"                                                              // param1: (fade amount)
  "parameter2" = "0"                                                               // param2: 0
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize string variables
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends FUNCTION call
PATCH_FOR_EACH ~rr#color~ IN ~9~ ~50~ BEGIN                                        // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
LPF ADD_CRE_EFFECT                                             // Starts FUNCTION call
  INT_VAR                                                                          // initialize variables
  "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
  "target" = "1"                                                                   // target: 1 (self)
  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
  "duration" = "0"                                                                 // duration: 0
  "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
  "sectype" = "0"                                                                  // secondary type: none
  "probability1" = "100"                                                           // probability1: 100%
  STR_VAR                                                                          // initialize strings
  "resource"  = ""                                                                 // resref: none
  "effsource" = ""                                                                 // effsource: none
END                                                                                // ends LPF
END                                                                                // ends PATCH_FOR_EACH
  WRITE_BYTE 0x2E 18                                                               // major color (Dark Blue)
// =============================================================================== // the actual work ends here
BUT_ONLY_IF_IT_CHANGES
END                                                                                // ends ACTION_IF FILE_EXISTS_IN_GAME block
END                                                                                // ends ACTION_FOR_EACH block

