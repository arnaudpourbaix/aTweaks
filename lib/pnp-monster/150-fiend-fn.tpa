
///////////////////////////////////////////////////////////////
// This file contains definitions for aTweaks-adapting fiends
///////////////////////////////////////////////////////////////


DEFINE_PATCH_FUNCTION make_imp BEGIN
  PATCH_INCLUDE ~aTweaks/lib/fj_cre_validity.tpp~                                      // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
  PATCH_IF valid BEGIN
    PATCH_INCLUDE ~aTweaks/lib/fj_cre_reindex.tpp~                                     // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
    // =============================================================================== // the actual work starts from here
    REMOVE_KNOWN_SPELLS                                                                // Remove all known spells from the current creature
    REMOVE_MEMORIZED_SPELLS                                                            // Remove all memorized spells from the current creature
	ADD_MEMORIZED_SPELL ~RR#IMRAT~ #0 ~innate~ ( 1 )                                   // adds 1x Polymorph self rat
	ADD_MEMORIZED_SPELL ~RR#IMSPD~ #0 ~innate~ ( 1 )                                   // adds 1x Polymorph self spider
	ADD_MEMORIZED_SPELL ~RR#DSUGG~ #0 ~innate~ ( 1 )                                   // adds 1x Suggestion
	ADD_MEMORIZED_SPELL ~RR#WR206~ #0 ~innate~ ( 1 )                                   // adds Invisibility at will
    REMOVE_CRE_ITEM ~DW#SUMFI~                                                         // removes DW#SUMFI.ITM (SCSII's fiend immunities, prevents conflict)
    REMOVE_CRE_ITEM ~REGHP1~                                                           // removes REGHP1.ITM (regeneration now handled via equipped weapon)
    REPLACE_CRE_ITEM ~RR#DIMP~ #0 #0 #0 ~UNDROPPABLE~ ~WEAPON1~ EQUIP                  // replace default weapon with a more PnP accurate weapon
	REPLACE_CRE_ITEM ~RR#DIMP2~ #0 #0 #0 ~UNDROPPABLE~ ~RRING~                  	   // PnP IMP immunities
    REPLACE_CRE_ITEM ~IMMUNE1~ #0 #0 #0 ~UNSTEALABLE&UNDROPPABLE~ ~LRING~              // add Normal weapons
    newxpv = 1400
	PATCH_IF ("%SOURCE_RES%" STRING_EQUAL_CASE ~FAMIMP25~) OR ("%SOURCE_RES%" STRING_EQUAL_CASE ~FAMIMP~) BEGIN
	  newxpv = 0
      LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~                                        // delete the EFF with the designated opcode
        INT_VAR opcode_to_delete = "-1" END                                            // all
	  REPLACE_CRE_ITEM ~FAMMY~ #0 #0 #0 ~UNDROPPABLE~ ~AMULET~					   	   // Add Remove fog of war item
	END
    LPM update_fiend_xp
    PATCH_IF FiendsScripts = 0 BEGIN                                                   // Only do this if we're not just adding aTweaks scripting                                                   
      LAUNCH_PATCH_FUNCTION ~RR#MDCRE~                                                 // Starts FUNCTION call (aTweaks' Creature Modification function)
        INT_VAR                                                                        // Initialize variables
           newxpv
          "newmove"  = "14"                                                            // new movement rate
          "newhp"    = "18"                                                            // new hit point value
          "newac"    = "2"                                                             // new Armor Class value
          "newth"    = "19"                                                            // new THAC0 value
          "newapr"   = "1"                                                             // new number of attacks per round
          "newsvd"   = "10"                                                            // new Save vs. Death
          "newsvw"   = "12"                                                            // new Save vs. Wand
          "newsvp"   = "11"                                                            // new Save vs. Polymorph
          "newsvb"   = "12"                                                            // new Save vs. Breath
          "newsvs"   = "13"                                                            // new Save vs. Spell
          "newmr"    = "25"                                                            // new Magic Resistance value
          "newfr"    = "100"                                                           // new Resist Fire value
          "newcr"    = "100"                                                           // new Resist Cold value
          "newer"    = "100"                                                           // new Resist Electricity value
          "newlvl1"  = "2"                                                             // new level (first class)
          "newstr"   = "10"                                                            // new Strength value
          "newint"   = "10"                                                            // new Intelligence value
          "newwis"   = "12"                                                            // new Wisdom value
          "newdex"   = "17"                                                            // new Dexterity value
          "newcon"   = "10"                                                            // new Constitution value
          "newchr"   = "14"                                                            // new Charisma value
          "newmor"   = "10"                                                            // new morale value
          "newmorb"  = "5"                                                             // new morale break value
          "newmorr"  = "60"                                                            // new morale recovery value
          "newrace"  = "141"                                                           // new race (Imp)
          "newclass" = "179"                                                           // new class (Imp)
          "newalign" = "19"                                                            // new alignment (Lawful Evil)
        STR_VAR                                                                        // initialize strings
          "enfc01"   = "DIMP01"                                                        // enforced creature 1 (uses strict PnP values)
          "enfc02"   = "GORBAT4"                                                       // enforced creature 2 (uses strict PnP values)
          "enfc03"   = "IMP01"                                                         // enforced creature 3 (uses strict PnP values)
          "enfc04"   = "TELIMP1"                                                       // enforced creature 4 (uses strict PnP values)
          "enfc05"   = "TCIMP01"                                                       // enforced creature 5 (uses strict PnP values)
          "enfc06"   = "FAMIMP"                                                       // enforced creature 5 (uses strict PnP values)
      END                                                                              // ends FUNCTION call
    END
    LAUNCH_PATCH_FUNCTION ~RR#MDCSC~                                                   // Starts FUNCTION call (aTweaks' Creature Script Modification function)
      STR_VAR                                                                          // Initialize strings
        "newscript"  = "RR#HIMP"                                                       // new AI script
        "script01"   = ""                                                              // first AI script name
        "script02"   = "None"                                                          // second AI script name
        "script03"   = "WTASIGHT"                                                      // third AI script name
        "script04"   = "DEMIMP"                                                        // fourth AI script name
        "script05"   = "BPWDASGT"                                                      // Big Picture script
        "script06"   = "BPDEMON"                                                       // Big Picture Demon script
        "script07"   = "GENSHT01"                                                      // generic shout script
        "script08"   = "DW2MP0GE"                                                      // Stratagems melee script
        "script09"   = "DW2RP0MO"                                                      // Stratagems melee script
		"script10"   = "DW2MS0MO"                                                      // Stratagems melee script
		"script11"   = "DW#MG647"                                                      // Stratagems melee script
		"script12"   = "DW#MG458"                                                      // Stratagems melee script
        "skipfile01" = "RUMAR03"                                                       // skip script patching for a designated file
        "skipfile02" = "MEKIMP01"                                                      // skip script patching for a designated file
        "skipfile03" = "FAMIMP25"                                                      // skip script patching for a designated file
        "skipfile04" = "FAMIMP"                                                        // skip script patching for a designated file
        "skipfile05" = "lrimp1"                                                        // skip script patching for a designated file
        "skipfile06" = "lrimp2"                                                        // skip script patching for a designated file
    END                                                                                // ends FUNCTION call
    PATCH_IF FiendsScripts = 0 BEGIN                                                   // Only do this if we're not just adding aTweaks scripting
	// LAUNCH_PATCH_FUNCTION fire_spell_immunities END                                    // grant immunities to fire-based area effect spells
	// LAUNCH_PATCH_FUNCTION cold_spell_immunities END                                    // grant immunities to cold-based area effect spells
	// LAUNCH_PATCH_FUNCTION electrical_spell_immunities END                              // grant immunities to electricity-based area effect spells
	// LAUNCH_PATCH_FUNCTION extraplanar_traits END                                       // grant extraplanar traits
	// LAUNCH_PATCH_FUNCTION hover_immunities END                                         // grant immunities to ground-based spells
      LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~                                        // delete the EFF with the designated opcode
        INT_VAR opcode_to_delete = "193" END                                           // mark opcode #193 (Invisible Detection by Script) for deletion
      LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~                                        // delete the EFF with the designated opcode
        INT_VAR opcode_to_delete = "16" END                                            // mark opcode #16 (Haste) for deletion
      LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~                                        // delete the EFF with the designated opcode
        INT_VAR opcode_to_delete = "98" END                                            // mark opcode #98 (Regeneration) for deletion
    END
    PATCH_IF ("%SOURCE_RES%" STRING_EQUAL_CASE ~RUMAR03~) BEGIN                        // special case, the Imp in the Ranger Stronghold quest
      WRITE_BYTE  0x270 "255"                                                          // set initial allegiance to ENEMY
    END
  // ===============================================================================   // the actual work ends here
  END                                                                                  // ends file validity check
END



DEFINE_PATCH_FUNCTION make_hellcat BEGIN
  PATCH_INCLUDE ~aTweaks/lib/fj_cre_validity.tpp~                                      // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
  PATCH_IF valid BEGIN
    PATCH_INCLUDE ~aTweaks/lib/fj_cre_reindex.tpp~                                     // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
    // =============================================================================== // the actual work starts from here
    SAY NAME1 @732 SAY NAME2 @732                                                      // Hellcat
    REMOVE_KNOWN_SPELLS                                                                // Remove all known spells from the current creature
    REMOVE_MEMORIZED_SPELLS                                                            // Remove all memorized spells from the current creature
    REMOVE_CRE_ITEM ~DW#SUMFI~                                                         // removes DW#SUMFI.ITM (SCSII's fiend immunities, prevents conflict)
    REPLACE_CRE_ITEM ~IMMUNE1~ #0 #0 #0 ~UNSTEALABLE&UNDROPPABLE~ ~LRING~              // add Normal weapons
    REPLACE_CRE_ITEM ~RR#DBAAT~ #0 #0 #0 ~UNDROPPABLE~ ~RRING~                         // PnP Baatezu immunities 
    REPLACE_CRE_ITEM ~RR#DFCAT~ #0 #0 #0 ~UNDROPPABLE~ ~WEAPON1~ EQUIP                 // replace default weapon with a less powerful weapon (closer to PnP damage output)
    ADD_CRE_ITEM ~IPSION~ #0 #0 #0 ~UNDROPPABLE~ ~AMULET~                              // add protection from all mind-affecting spells
    newxpv = 5000
    LPM update_fiend_xp
    PATCH_IF FiendsScripts = 0 BEGIN                                                   // Only do this if we're not just adding aTweaks scripting
      LAUNCH_PATCH_FUNCTION ~RR#MDCRE~                                                 // Starts FUNCTION call (aTweaks' Creature Modification function)
        INT_VAR                                                                        // Initialize variables
           newxpv
          "newmove"  = "11"                                                            // new movement rate
          "newhp"    = "58"                                                            // new hit point value
          "newac"    = "6"                                                             // new Armor Class value
          "newth"    = "13"                                                            // new THAC0 value
          "newapr"   = "3"                                                             // new number of attacks per round
          "newsvd"   = "10"                                                            // new Save vs. Death
          "newsvw"   = "12"                                                            // new Save vs. Wand
          "newsvp"   = "11"                                                            // new Save vs. Polymorph
          "newsvb"   = "12"                                                            // new Save vs. Breath
          "newsvs"   = "13"                                                            // new Save vs. Spell
          "newmr"    = "20"                                                            // new Magic Resistance value
          "newfr"    = "100"                                                           // new Resist Fire value
          "newcr"    = "50"                                                            // new Resist Cold value
          "newer"    = "0"                                                             // new Resist Electricity value
          "newlvl1"  = "7"                                                             // new level (first class)
          "newstr"   = "17"                                                            // new Strength value
          "newint"   = "10"                                                            // new Intelligence value
          "newwis"   = "10"                                                            // new Wisdom value
          "newdex"   = "18"                                                            // new Dexterity value
          "newcon"   = "14"                                                            // new Constitution value
          "newchr"   = "16"                                                            // new Charisma value
          "newmor"   = "14"                                                            // new morale value
          "newmorb"  = "5"                                                             // new morale break value
          "newmorr"  = "15"                                                            // new morale recovery value
          "newrace"  = "121"                                                           // new race (Demonic)
          "newclass" = "179"                                                           // new class (Imp)
          "newalign" = "19"                                                            // new alignment (Lawful Evil)
        STR_VAR                                                                        // initialize strings
          "enfc01"   = "GORCAMB6"                                                      // enforced creature 1 (uses strict PnP values)
          "enfc02"   = "GORCAMB7"                                                      // enforced creature 2 (uses strict PnP values)
          "enfc03"   = "HGFEL01"                                                       // enforced creature 3 (uses strict PnP values)
      END                                                                              // ends FUNCTION call
    END
    LAUNCH_PATCH_FUNCTION ~RR#MDCSC~                                                   // Starts FUNCTION call (aTweaks' Creature Script Modification function)
      STR_VAR                                                                          // Initialize strings
        "newscript"  = "RR#HFCAT"                                                      // new AI script
        "script01"   = ""                                                              // first AI script name
        "script02"   = "None"                                                          // second AI script name
        "script03"   = "WTASIGHT"                                                      // third AI script name
        "script04"   = "BPDEMON"                                                       // Big Picture Demon AI
        "script05"   = "DW2MP4MO"                                                      // Stratagems melee script
        "skipfile01" = "GORCAMB6"                                                      // skip script patching for a designated file
        "skipfile02" = "GORCAMB7"                                                      // skip script patching for a designated file
    END                                                                                // ends FUNCTION call
    PATCH_IF FiendsScripts = 0 BEGIN                                                   // Only do this if we're not just adding aTweaks scripting
    // LAUNCH_PATCH_FUNCTION extraplanar_traits END                                       // grant extraplanar traits
    // LAUNCH_PATCH_FUNCTION fire_spell_immunities END                                    // grant immunities to fire-based area effect spells
      LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~                                        // delete the EFF with the designated opcode
        INT_VAR opcode_to_delete = "193" END                                           // mark opcode #193 (Invisible Detection by Script) for deletion
      LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~                                        // delete the EFF with the designated opcode
        INT_VAR opcode_to_delete = "292" END                                           // mark opcode #292 (Protection from Backstab) for deletion
      LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~                                        // delete the EFF with the designated opcode
        INT_VAR opcode_to_delete = "16" END                                            // mark opcode #16 (Haste) for deletion
      LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~                                        // delete the EFF with the designated opcode
        INT_VAR opcode_to_delete = "120" END                                           // mark opcode #120 (Protection from Melee Weapons) for deletion
    END
    // =============================================================================== // the actual work ends here
  END                                                                                  // ends file validity check
END


DEFINE_PATCH_FUNCTION make_erinyes BEGIN
  PATCH_INCLUDE ~aTweaks/lib/fj_cre_validity.tpp~                                      // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
  PATCH_IF valid BEGIN
    PATCH_INCLUDE ~aTweaks/lib/fj_cre_reindex.tpp~                                     // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
    // =============================================================================== // the actual work starts from here
    REMOVE_CRE_ITEM ~DW#SUMFI~                                                         // removes DW#SUMFI.ITM (SCSII's fiend immunities, prevents conflict)
    REMOVE_CRE_ITEM ~HELMNOAN~                                                         // removes HELMNOAN.ITM (no critical hit immunity in PnP)
    REPLACE_CRE_ITEM ~RR#DBAAT~ #0 #0 #0 ~UNDROPPABLE~ ~RRING~                         // PnP Baatezu immunities 
    REPLACE_CRE_ITEM ~IMMUNE1~ #0 #0 #0 ~UNSTEALABLE&UNDROPPABLE~ ~LRING~              // add Normal weapons
	PATCH_IF FILE_EXISTS_IN_GAME "RR#WING1.ITM" BEGIN
	  ADD_CRE_ITEM ~RR#WING1~ #0 #0 #0 ~UNSTEALABLE&UNDROPPABLE~ ~HELMET~              // add wings
      WRITE_LONG 0x28 "24849"                                                          // Sets avatar to FIGHTER_FEMALE_ELF	  
	END
    REMOVE_KNOWN_SPELLS                                                                // Remove all known spells from the current creature
    REMOVE_MEMORIZED_SPELLS                                                            // Remove all memorized spells from the current creature
    newxpv = 7000
    LPM update_fiend_xp
    PATCH_IF FiendsScripts = 0 BEGIN                                                   // Only do this if we're not just adding aTweaks scripting
      LAUNCH_PATCH_FUNCTION ~RR#MDCRE~                                                 // Starts FUNCTION call (aTweaks' Creature Modification function)
        INT_VAR                                                                        // Initialize variables
           newxpv
          "rr#sinv"  = "1"                                                             // See invisible creatures (1 = enable)
          "newhp"    = "48"                                                            // new hit point value
          "newac"    = "2"                                                             // new Armor Class value
          "newth"    = "13"                                                            // new THAC0 value
          "newapr"   = "1"                                                             // new number of attacks per round
          "newsvd"   = "10"                                                            // new Save vs. Death
          "newsvw"   = "12"                                                            // new Save vs. Wand
          "newsvp"   = "11"                                                            // new Save vs. Polymorph
          "newsvb"   = "12"                                                            // new Save vs. Breath
          "newsvs"   = "13"                                                            // new Save vs. Spell
          "newmr"    = "30"                                                            // new Magic Resistance value
          "newfr"    = "100"                                                           // new Resist Fire value
          "newcr"    = "50"                                                            // new Resist Cold value
          "newer"    = "0"                                                             // new Resist Electricity value
          "newlvl1"  = "6"                                                             // new level (first class)
          "newstr"   = "17"                                                            // new Strength value
          "newint"   = "14"                                                            // new Intelligence value
          "newwis"   = "16"                                                            // new Wisdom value
          "newdex"   = "18"                                                            // new Dexterity value
          "newcon"   = "14"                                                            // new Constitution value
          "newchr"   = "18"                                                            // new Charisma value
          "newmor"   = "12"                                                            // new morale value
          "newmorb"  = "5"                                                             // new morale break value
          "newmorr"  = "15"                                                            // new morale recovery value
          "newrace"  = "121"                                                           // new race (Demonic)
          "newclass" = "179"                                                           // new class (Imp)
          "newalign" = "19"                                                            // new alignment (Lawful Evil)
        STR_VAR                                                                        // initialize strings
          "enfc01"   = "DERINY01"                                                      // enforced creature 1 (uses strict PnP values)
          "enfc02"   = "GORBAT2"                                                       // enforced creature 2 (uses strict PnP values)
      END                                                                              // ends FUNCTION call
    END
    LAUNCH_PATCH_FUNCTION ~RR#MDCSC~                                                   // Starts FUNCTION call (aTweaks' Creature Script Modification function)
      STR_VAR                                                                          // Initialize strings
        "newscript"  = "RR#HERIN"                                                      // new AI script
        "script01"   = ""                                                              // first AI script name
        "script02"   = "None"                                                          // second AI script name
        "script03"   = "WTASIGHT"                                                      // third AI script name
        "script04"   = "ERINYES"                                                       // fourth AI script name
        "script05"   = "BPDEMON"                                                       // Big Picture Demon AI
		"skipfile01" = "jumjum"                                                        // skip script patching for a designated file
    END                                                                                // ends FUNCTION call
    PATCH_IF FiendsScripts = 0 BEGIN                                                   // Only do this if we're not just adding aTweaks scripting
    // LAUNCH_PATCH_FUNCTION fire_spell_immunities END                                    // grant immunities to fire-based area effect spells
      LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~                                        // delete the EFF with the designated opcode
        INT_VAR opcode_to_delete = "292" END                                           // mark opcode #292 (Protection from Backstab) for deletion
      LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~                                        // delete the EFF with the designated opcode
        INT_VAR opcode_to_delete = "98" END                                            // mark opcode #98 (Regeneration) for deletion
    END
    // =============================================================================== // the actual work ends here
  END                                                                                  // ends file validity check
END


DEFINE_PATCH_FUNCTION make_bone_fiend BEGIN
  PATCH_INCLUDE ~aTweaks/lib/fj_cre_validity.tpp~                                      // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
  PATCH_IF valid BEGIN
    PATCH_INCLUDE ~aTweaks/lib/fj_cre_reindex.tpp~                                     // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
    // =============================================================================== // the actual work starts from here
    REMOVE_CRE_ITEM ~DW#SUMFI~                                                         // removes DW#SUMFI.ITM (SCSII's fiend immunities, prevents conflict)
    REMOVE_CRE_ITEM ~IMMUNE2~                                                          // removes IMMUNE2.ITM (no immunity to +1 weapons in PnP)
    REMOVE_CRE_ITEM ~REGHP2R~                                                          // removes REGHP2R.ITM (no regeneration in PnP)
    REMOVE_KNOWN_SPELLS                                                                // Remove all known spells from the current creature
    REMOVE_MEMORIZED_SPELLS                                                            // Remove all memorized spells from the current creature
    REPLACE_CRE_ITEM ~RR#DBAAT~ #0 #0 #0 ~UNDROPPABLE~ ~RRING~                         // PnP Baatezu immunities 
    REPLACE_CRE_ITEM ~IMMUNE1~ #0 #0 #0 ~UNSTEALABLE&UNDROPPABLE~ ~LRING~              // add Normal weapons
    REPLACE_CRE_ITEM ~RR#DBFND~ #0 #0 #0 ~UNDROPPABLE~ ~WEAPON1~ EQUIP                 // replace default weapon with a less powerful weapon (closer to PnP damage output)
    newxpv = 7000
    LPM update_fiend_xp
    PATCH_IF FiendsScripts = 0 BEGIN                                                   // Only do this if we're not just adding aTweaks scripting
      LAUNCH_PATCH_FUNCTION ~RR#MDCRE~                                                 // Starts FUNCTION call (aTweaks' Creature Modification function)
        INT_VAR                                                                        // Initialize variables
           newxpv
          "newmove"  = "9"                                                             // new movement rate
          "rr#bump"  = "1"                                                             // NPC bump (1 = enable)
          "newhp"    = "40"                                                            // new hit point value
          "newac"    = "3"                                                             // new Armor Class value
          "newth"    = "15"                                                            // new THAC0 value
          "newapr"   = "4"                                                             // new number of attacks per round
          "newsvd"   = "11"                                                            // new Save vs. Death
          "newsvw"   = "13"                                                            // new Save vs. Wand
          "newsvp"   = "12"                                                            // new Save vs. Polymorph
          "newsvb"   = "13"                                                            // new Save vs. Breath
          "newsvs"   = "14"                                                            // new Save vs. Spell
          "newmr"    = "30"                                                            // new Magic Resistance value
          "newfr"    = "100"                                                           // new Resist Fire value
          "newcr"    = "50"                                                            // new Resist Cold value
          "newer"    = "0"                                                             // new Resist Electricity value
          "newlvl1"  = "5"                                                             // new level (first class)
          "newstr"   = "16"                                                            // new Strength value
          "newstrx"  = "0"                                                             // new Exceptional Strength value
          "newint"   = "12"                                                            // new Intelligence value
          "newwis"   = "12"                                                            // new Wisdom value
          "newdex"   = "14"                                                            // new Dexterity value
          "newcon"   = "15"                                                            // new Constitution value
          "newchr"   = "10"                                                            // new Charisma value
          "newmor"   = "12"                                                            // new morale value
          "newmorb"  = "4"                                                             // new morale break value
          "newmorr"  = "15"                                                            // new morale recovery value
          "newrace"  = "121"                                                           // new race (Demonic)
          "newclass" = "179"                                                           // new class (Imp)
          "newalign" = "19"                                                            // new alignment (Lawful Evil)
        STR_VAR                                                                        // initialize strings
          "enfc01"   = "DBONEF01"                                                      // enforced creature 1 (uses strict PnP values)
          "enfc02"   = "GORBAT5"                                                       // enforced creature 2 (uses strict PnP values)
      END                                                                              // ends FUNCTION call
    END
    LAUNCH_PATCH_FUNCTION ~RR#MDCSC~                                                   // Starts FUNCTION call (aTweaks' Creature Script Modification function)
      STR_VAR                                                                          // Initialize strings
        "newscript"  = "RR#HBFND"                                                      // new AI script
        "script01"   = ""                                                              // first AI script name
        "script02"   = "None"                                                          // second AI script name
        "script03"   = "WTASIGHT"                                                      // third AI script name
        "script04"   = "BPDEMON"                                                       // Big Picture Demon AI
        "script05"   = "DEMBAL01"                                                      // Big Picture script (misassigned?)
        "script06"   = "DW2MC4GE"                                                      // Stratagems melee script
        "script07"   = "DW#BONEF"                                                      // Stratagems Bone Fiend script
        "skipfile01" = "DW#BFSUM"                                                      // Stratagems Bone Fiend script
    END                                                                                // ends FUNCTION call
    PATCH_IF FiendsScripts = 0 BEGIN                                                   // Only do this if we're not just adding aTweaks scripting
    // LAUNCH_PATCH_FUNCTION fire_spell_immunities END                                    // grant immunities to fire-based area effect spells
      LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~                                        // delete the EFF with the designated opcode
        INT_VAR opcode_to_delete = "193" END                                           // mark opcode #193 (Invisible Detection by Script) for deletion
      LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~                                        // delete the EFF with the designated opcode
        INT_VAR opcode_to_delete = "292" END                                           // mark opcode #292 (Protection from Backstab) for deletion
      LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~                                        // delete the EFF with the designated opcode
        INT_VAR opcode_to_delete = "16" END                                            // mark opcode #16 (Haste) for deletion
    END
    PATCH_IF ((IDS_OF_SYMBOL (~animate~ ~OSYLUTH_NWN~)) > 0) BEGIN 					   // Infinity Animation Compatibility (IAv5b)
      WRITE_LONG 0x28 (IDS_OF_SYMBOL (~animate~ ~OSYLUTH_NWN~))	              		   // Use IA OSYLUTH_NWN apperance
	  WRITE_BYTE 0x2d 83      														   // Minor color (DARK_BLUISH_GRAY)
	  WRITE_BYTE 0x2e 28      														   // Major color (BLUISH_SILVER)
	  WRITE_BYTE 0x2f 28      														   // Skin color
	  LPF DELETE_CRE_EFFECT
	    INT_VAR opcode_to_delete = 51 												   // Strong-dark by RGB
	  END
	END	
    // =============================================================================== // the actual work ends here
  END                                                                                  // ends file validity check
END


DEFINE_PATCH_FUNCTION make_abishai BEGIN
  PATCH_INCLUDE ~aTweaks/lib/fj_cre_validity.tpp~                                      // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
  PATCH_IF valid BEGIN
    PATCH_INCLUDE ~aTweaks/lib/fj_cre_reindex.tpp~                                     // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
    // =============================================================================== // the actual work starts from here
    REMOVE_KNOWN_SPELLS                                                                // Remove all known spells from the current creature
    REMOVE_MEMORIZED_SPELLS                                                            // Remove all memorized spells from the current creature
    REMOVE_CRE_ITEM ~DW#SUMFI~                                                         // removes DW#SUMFI.ITM (SCSII's fiend immunities, prevents conflict)
    REMOVE_CRE_ITEM ~HELMNOAN~                                                         // removes HELMNOAN.ITM (no critical hit immunity in PnP)
    REPLACE_CRE_ITEM ~RR#DBAAT~ #0 #0 #0 ~UNDROPPABLE~ ~RRING~                         // PnP Baatezu immunities 
    REPLACE_CRE_ITEM ~IMMUNE1~ #0 #0 #0 ~UNSTEALABLE&UNDROPPABLE~ ~LRING~              // add Normal weapons
	REPLACE_CRE_ITEM ~REGHP2R~ #0 #0 #0 ~UNDROPPABLE~ ~AMULET~
    REPLACE_CRE_ITEM ~RR#DABIS~ #0 #0 #0 ~UNDROPPABLE~ ~WEAPON1~ EQUIP                 // replace default weapon with a less powerful weapon (closer to PnP damage output)
    newxpv = 9000
    LPM update_fiend_xp
    PATCH_IF FiendsScripts = 0 BEGIN                                                   // Only do this if we're not just adding aTweaks scripting
      LAUNCH_PATCH_FUNCTION ~RR#MDCRE~                                                 // Starts FUNCTION call (aTweaks' Creature Modification function)
        INT_VAR                                                                        // Initialize variables
           newxpv
          "newmove"  = "9"                                                             // new movement rate
          "rr#bump"  = "1"                                                             // NPC bump (1 = enable)
          "newhp"    = "64"                                                            // new hit point value
          "newac"    = "1"                                                             // new Armor Class value
          "newth"    = "13"                                                            // new THAC0 value
          "newapr"   = "3"                                                             // new number of attacks per round
          "newsvd"   = "10"                                                            // new Save vs. Death
          "newsvw"   = "12"                                                            // new Save vs. Wand
          "newsvp"   = "11"                                                            // new Save vs. Polymorph
          "newsvb"   = "12"                                                            // new Save vs. Breath
          "newsvs"   = "13"                                                            // new Save vs. Spell
          "newmr"    = "40"                                                            // new Magic Resistance value
          "newfr"    = "100"                                                           // new Resist Fire value
          "newcr"    = "50"                                                            // new Resist Cold value
          "newer"    = "0"                                                             // new Resist Electricity value
          "newlvl1"  = "6"                                                             // new level (first class)
          "newstr"   = "15"                                                            // new Strength value
          "newint"   = "10"                                                            // new Intelligence value
          "newwis"   = "12"                                                            // new Wisdom value
          "newdex"   = "17"                                                            // new Dexterity value
          "newcon"   = "15"                                                            // new Constitution value
          "newchr"   = "16"                                                            // new Charisma value
          "newmor"   = "12"                                                            // new morale value
          "newmorb"  = "6"                                                             // new morale break value
          "newmorr"  = "15"                                                            // new morale recovery value
          "newrace"  = "121"                                                           // new race (Demonic)
          "newclass" = "179"                                                           // new class (Imp)
          "newalign" = "19"                                                            // new alignment (Lawful Evil)
        STR_VAR                                                                        // initialize strings
          "enfc01"   = "DEMABI01"                                                      // enforced creature 1 (uses strict PnP values)
          "enfc02"   = "abisred1"                                                      // enforced creature 2 (uses strict PnP values)
      END                                                                              // ends FUNCTION call
    END
    LAUNCH_PATCH_FUNCTION ~RR#MDCSC~                                                   // Starts FUNCTION call (aTweaks' Creature Script Modification function)
      STR_VAR                                                                          // Initialize strings
        "newscript"  = "RR#HABIS"                                                      // new AI script
        "script01"   = ""                                                              // first AI script name
        "script02"   = "None"                                                          // second AI script name
        "script03"   = "WTASIGHT"                                                      // third AI script name
        "script04"   = "BPDEMON"                                                       // Big Picture Demon AI
        "script05"   = "DW2MP4GE"                                                      // Stratagems melee script
        "script06"   = "DW2MS3GE"                                                      // Stratagems melee script
        "script07"   = "DW2MS4GE"                                                      // Stratagems melee script
		"script08"   = "DW2MC6GE"                                                      // Stratagems melee script
		"script09"   = "DW2MC4GE"                                                      // Stratagems melee script
		"script10"   = "DUEGABIS"                                                      // TDD Demon AI
		"script11"   = "ABISHAI"                                                       // RoT Demon AI
		"script12"   = "PSBAAT01"                                                      // Planar Sphere Demon AI
		"script13"   = "GNTEAM2M"                                                      // AI
		"script14"   = "NSABISH"                                                      // aggro AI Saerileth
		"skipfile01" = "duegabis"                                                      // skip script patching for a designated file
    END                                                                                // ends FUNCTION call
    PATCH_IF FiendsScripts = 0 BEGIN                                                   // Only do this if we're not just adding aTweaks scripting
    // LAUNCH_PATCH_FUNCTION fire_spell_immunities END                                    // grant immunities to fire-based area effect spells
      LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~                                        // delete the EFF with the designated opcode
        INT_VAR opcode_to_delete = "193" END                                           // mark opcode #193 (Invisible Detection by Script) for deletion
    END
    // =============================================================================== // the actual work ends here
  END                                                                                  // ends file validity check
END


DEFINE_PATCH_FUNCTION make_cornugon BEGIN
  PATCH_INCLUDE ~aTweaks/lib/fj_cre_validity.tpp~                                      // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
  PATCH_IF valid BEGIN
    PATCH_INCLUDE ~aTweaks/lib/fj_cre_reindex.tpp~                                     // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
    // =============================================================================== // the actual work starts from here
    REMOVE_CRE_ITEM ~DW#SUMFI~                                                         // removes DW#SUMFI.ITM (SCSII's fiend immunities, prevents conflict)
    REMOVE_CRE_ITEM ~HELMNOAN~                                                         // removes HELMNOAN.ITM (no critical hit immunity in PnP)
    REMOVE_KNOWN_SPELLS                                                                // Remove all known spells from the current creature
    REMOVE_MEMORIZED_SPELLS                                                            // Remove all memorized spells from the current creature
    REPLACE_CRE_ITEM ~RR#DBAAT~ #0 #0 #0 ~UNDROPPABLE~ ~RRING~                         // PnP Baatezu immunities 
	REPLACE_CRE_ITEM ~IMMUNE2~ #0 #0 #0 ~UNDROPPABLE~ ~LRING~
 	REPLACE_CRE_ITEM ~REGHP2R~ #0 #0 #0 ~UNDROPPABLE~ ~AMULET~
    REPLACE_CRE_ITEM ~RR#DCORN~ #0 #0 #0 ~UNDROPPABLE~ ~WEAPON1~ EQUIP                 // replace default weapon with a less powerful weapon (closer to PnP damage output)
   newxpv = 10000
    LPM update_fiend_xp
    PATCH_IF FiendsScripts = 0 BEGIN                                                   // Only do this if we're not just adding aTweaks scripting
      LAUNCH_PATCH_FUNCTION ~RR#MDCRE~                                                 // Starts FUNCTION call (aTweaks' Creature Modification function)
        INT_VAR                                                                        // Initialize variables
           newxpv
          "newmove"  = "7"                                                             // new movement rate
          "rr#bump"  = "1"                                                             // NPC bump (1 = enable)
          "newhp"    = "80"                                                            // new hit point value
          "newac"    = "-2"                                                            // new Armor Class value
          "newth"    = "11"                                                            // new THAC0 value
          "newapr"   = "2"                                                             // new number of attacks per round
          "newsvd"   = "8"                                                             // new Save vs. Death
          "newsvw"   = "10"                                                            // new Save vs. Wand
          "newsvp"   = "9"                                                             // new Save vs. Polymorph
          "newsvb"   = "9"                                                             // new Save vs. Breath
          "newsvs"   = "11"                                                            // new Save vs. Spell
          "newmr"    = "50"                                                            // new Magic Resistance value
          "newfr"    = "100"                                                           // new Resist Fire value
          "newcr"    = "50"                                                            // new Resist Cold value
          "newer"    = "0"                                                             // new Resist Electricity value
          "newlvl1"  = "10"                                                            // new level (first class)
          "newstr"   = "18"                                                            // new Strength value
          "newstrx"  = "100"                                                           // new Exceptional Strength value
          "newint"   = "16"                                                            // new Intelligence value
          "newwis"   = "14"                                                            // new Wisdom value
          "newdex"   = "17"                                                            // new Dexterity value
          "newcon"   = "17"                                                            // new Constitution value
          "newchr"   = "16"                                                            // new Charisma value
          "newmor"   = "14"                                                            // new morale value
          "newmorb"  = "5"                                                             // new morale break value
          "newmorr"  = "15"                                                            // new morale recovery value
          "newrace"  = "121"                                                           // new race (Demonic)
          "newclass" = "179"                                                           // new class (Imp)
          "newalign" = "19"                                                            // new alignment (Lawful Evil)
        STR_VAR                                                                        // initialize strings
          "enfc01"   = "DEMCOR01"                                                      // enforced creature 1 (uses strict PnP values)
          "enfc02"   = "DEADDEM1"                                                      // enforced creature 2 (uses strict PnP values)
          "enfc03"   = "GORBAT3"                                                       // enforced creature 3 (uses strict PnP values)
          "enfc04"   = "TELCOR1"                                                       // enforced creature 4 (uses strict PnP values)
          "enfc05"   = "F_corn"                                                        // enforced creature 5 (uses strict PnP values)
          "enfc06"   = "F_corn02"                                                      // enforced creature 6 (uses strict PnP values)
      END                                                                              // ends FUNCTION call
    END
    LAUNCH_PATCH_FUNCTION ~RR#MDCSC~                                                   // Starts FUNCTION call (aTweaks' Creature Script Modification function)
      STR_VAR                                                                          // Initialize strings
        "newscript"  = "RR#HCORN"                                                      // new AI script
        "script01"   = ""                                                              // first AI script name
        "script02"   = "None"                                                          // second AI script name
        "script03"   = "WTASIGHT"                                                      // third AI script name
        "script04"   = "CORNUGON"                                                      // fourth AI script name
        "script05"   = "BPDEMON"                                                       // Big Picture Demon AI
        "script06"   = "DW2MS3GE"                                                      // Stratagems melee script
        "script07"   = "DW2MS4GE"                                                      // Stratagems melee script
        "script08"   = "DW2MC4GE"                                                      // Stratagems melee script
        "script09"   = "DW2MC0GE"                                                      // Stratagems melee script
		"script10"   = "nscornug"
		"script11"   = "WTASI2"                                                        // Drizzt Saga Demon script
		"skipfile01" = "CULTMO2"                                                     // RoT Demon
    END                                                                                // ends FUNCTION call
    PATCH_IF FiendsScripts = 0 BEGIN                                                   // Only do this if we're not just adding aTweaks scripting
    // LAUNCH_PATCH_FUNCTION fire_spell_immunities END                                    // grant immunities to fire-based area effect spells
      LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~                                        // delete the EFF with the designated opcode
        INT_VAR opcode_to_delete = "193" END                                           // mark opcode #193 (Invisible Detection by Script) for deletion
      LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~                                        // delete the EFF with the designated opcode
        INT_VAR opcode_to_delete = "292" END                                           // mark opcode #292 (Protection from Backstab) for deletion
    END
    LAUNCH_PATCH_FUNCTION ~ADD_CRE_EFFECT~                                             // Starts FUNCTION call (add new creature effect built-in function)
      INT_VAR
        opcode = "206"                                                                 // effect: #206 (Protection from Spell)
        target = "1"                                                                   // target: 1 (self)
        timing = "9"                                                                   // timing mode: 9 (permanent after death)
        "duration" = "0"                                                               // duration: 0
        "sectype" = "0"                                                                // secondary type: none
        probability1 = "100"                                                           // probability1: 100%
      STR_VAR
        "resource"  = "RR#WI308"                                                       // resref: RR#WI308.SPL (note: special case - Cornugon's own Lightning Bolt)
        "effsource" = ""                                                               // effsource: none
    END
    WRITE_BYTE  0x2E "49"                                                              // major color (brown)
    // =============================================================================== // the actual work ends here
  END                                                                                  // ends file validity check
END


DEFINE_PATCH_FUNCTION make_gelugon BEGIN
  
  PATCH_INCLUDE ~aTweaks/lib/fj_cre_validity.tpp~                                    // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
  PATCH_IF valid BEGIN
    // =============================================================================== // the actual work starts from here
    SAY NAME1 @670 SAY NAME2 @670
    REPLACE_CRE_ITEM ~RR#DGELU~ #0 #0 #0 ~UNDROPPABLE~ ~weapon1~ EQUIP
    REPLACE_CRE_ITEM ~RR#DGEL2~ #0 #0 #0 ~UNDROPPABLE~ ~shield~
    REPLACE_CRE_ITEM ~RR#DGELR~ #0 #0 #0 ~UNDROPPABLE~ ~RRING~                         // PnP Baatezu immunities 
	REPLACE_CRE_ITEM ~IMMUNE2~ #0 #0 #0 ~UNDROPPABLE~ ~LRING~
	REPLACE_CRE_ITEM ~REGHP2R~ #0 #0 #0 ~UNDROPPABLE~ ~AMULET~
    newxpv = 19000
    LPM update_fiend_xp
    PATCH_IF FiendsScripts = 0 BEGIN                                                   // Only do this if we're not just adding aTweaks scripting
	LAUNCH_PATCH_FUNCTION ~RR#MDCRE~
      INT_VAR
        newxpv
          "rr#ptwf"  = "1"                                                             // perfect two weapon fighting
          "newmove"  = "11"                                                            // new movement rate
          "newhp"    = "88"                                                            // new hit point value
          "newac"    = "-3"                                                            // new Armor Class value
          "newth"    = "9"                                                             // new THAC0 value
          "newapr"   = "3"                                                             // new number of attacks per round
          "newsvd"   = "7"                                                             // new Save vs. Death
          "newsvw"   = "9"                                                             // new Save vs. Wand
          "newsvp"   = "8"                                                             // new Save vs. Polymorph
          "newsvb"   = "8"                                                             // new Save vs. Breath
          "newsvs"   = "10"                                                            // new Save vs. Spell
          "newmr"    = "50"                                                            // new Magic Resistance value
          "newfr"    = "50"                                                            // new Resist Fire value
          "newcr"    = "100"                                                           // new Resist Cold value
          "newer"    = "0"                                                             // new Resist Electricity value
          "newrm"    = "50"                                                            // new Resist Missiles
          "newlvl1"  = "11"                                                            // new level (first class)
          "newstr"   = "18"                                                            // new Strength value
          "newstrx"  = "76"                                                            // new Exceptional Strength value
          "newint"   = "18"                                                            // new Intelligence value
          "newwis"   = "18"                                                            // new Wisdom value
          "newdex"   = "17"                                                            // new Dexterity value
          "newcon"   = "18"                                                            // new Constitution value
          "newchr"   = "16"                                                            // new Charisma value
          "newmor"   = "16"                                                            // new morale value
          "newmorb"  = "4"                                                             // new morale break value
          "newmorr"  = "15"                                                            // new morale recovery value
          "newrace"  = "121"                                                           // new race (Demonic)
          "newclass" = "179"                                                           // new class (Imp)
          "newalign" = "19"                                                            // new alignment (Lawful Evil)
     END
   LAUNCH_PATCH_FUNCTION ~RR#MDCSC~                                                   // Starts FUNCTION call (aTweaks' Creature Script Modification function)
      STR_VAR                                                                          // Initialize strings
        "newscript"  = "RR#HGELU"                                                      // new AI script
        "script01"   = ""                                                              // first AI script name
        "script02"   = "None"                                                          // second AI script name
        "script03"   = "WTASIGHT"                                                      // third AI script name
        "script04"   = "BPWDASGT"                                                      // Big Picture script
        "script05"   = "DW2MC4GE"                                                      // Stratagems melee script
        "script06"   = "GENSHT01"                                                      // generic shout script
      END 
	// LAUNCH_PATCH_FUNCTION cold_spell_immunities END
	// LAUNCH_PATCH_FUNCTION poison_spell_immunities END                                  // grant immunities to poison-based area effect spells
    LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~                                        // delete the EFF with the designated opcode
      INT_VAR opcode_to_delete = "193" END                                           // mark opcode #193 (Invisible Detection by Script) for deletion
    WRITE_LONG  0x10 0                                                               // clear flags
    WRITE_BYTE  0x273 179															 // IMP
    WRITE_BYTE  0x270 "255"                                                          // set initial allegiance to ENEMY
    WRITE_BYTE  0x275 1                                                              // gender: male
    WRITE_ASCII 0x280 ~RR#HGELU~ #32                                                 // assign new death variable
    WRITE_LONG  0x28 "59664"                                                         // special case, Gelugon should use IC_SALAMANDER2 animation
	WRITE_BYTE  0x2f 57     														 // Skin color (LIGHT_BLUE)
	PATCH_IF MOD_IS_INSTALLED ~setup-infinityanimations.tp2~ ~100~ BEGIN			 // Infinity Animation Compatibility (IAv5b)
	  SAY BATTLE_CRY1 ~~ [T-GEL01A]
      SAY BATTLE_CRY2 ~~ [T-GEL01B]
      SAY BATTLE_CRY3 ~~ [T-GEL01C]
      SAY ATTACK1 ~~ [T-GEL03]
      SAY DAMAGE ~~ [T-GEL07]
      SAY DYING ~~ [T-GEL09]
      SAY SELECT_COMMON1 ~~ [T-GEL02A]
      SAY SELECT_COMMON2 ~~ [T-GEL02B]
      SAY SELECT_COMMON3 ~~ [T-GEL02C]
	END																				// Compatibility with IAv5b ends
    END
  END
END

DEFINE_PATCH_FUNCTION make_pit_fiend INT_VAR enforce = 0 BEGIN
  PATCH_INCLUDE ~aTweaks/lib/fj_cre_validity.tpp~                                      // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
  PATCH_IF valid BEGIN
    PATCH_INCLUDE ~aTweaks/lib/fj_cre_reindex.tpp~                                     // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
    // =============================================================================== // the actual work starts from here
    REMOVE_CRE_ITEM ~DW#SUMFI~                                                         // removes DW#SUMFI.ITM (SCSII's fiend immunities, prevents conflict)
    REMOVE_CRE_ITEM ~HELMNOAN~                                                         // removes HELMNOAN.ITM (no critical hit immunity in PnP)
    REMOVE_KNOWN_SPELLS                                                                // Remove all known spells from the current creature
    REMOVE_MEMORIZED_SPELLS                                                            // Remove all memorized spells from the current creature
    REPLACE_CRE_ITEM ~RR#DBAAT~ #0 #0 #0 ~UNDROPPABLE~ ~RRING~                         // PnP Baatezu immunities 
	REPLACE_CRE_ITEM ~IMMUNE3~ #0 #0 #0 ~UNDROPPABLE~ ~LRING~
 	REPLACE_CRE_ITEM ~REGHP2R~ #0 #0 #0 ~UNDROPPABLE~ ~AMULET~
    REPLACE_CRE_ITEM ~RR#DPITF~ #0 #0 #0 ~UNDROPPABLE~ ~WEAPON1~ EQUIP                 // replace generic attack with a Pit Fiend specific attack
    newxpv = 21000
    LPM update_fiend_xp
    PATCH_IF FiendsScripts = 0 BEGIN                                                   // Only do this if we're not just adding aTweaks scripting
      LAUNCH_PATCH_FUNCTION ~RR#MDCRE~                                                 // Starts FUNCTION call (aTweaks' Creature Modification function)
        INT_VAR                                                                        // Initialize variables
           newxpv
          "newmove"  = "11"                                                            // new movement rate
          "rr#bump"  = "1"                                                             // NPC bump (1 = enable)
          "rr#sinv"  = "1"                                                             // See invisible creatures (1 = enable)
          "newhp"    = "104"                                                           // new hit point value
          "newac"    = "-5"                                                            // new Armor Class value
          "newth"    = "7"                                                             // new THAC0 value
          "newapr"   = "5"                                                             // new number of attacks per round
          "newsvd"   = "5"                                                             // new Save vs. Death
          "newsvw"   = "7"                                                             // new Save vs. Wand
          "newsvp"   = "6"                                                             // new Save vs. Polymorph
          "newsvb"   = "5"                                                             // new Save vs. Breath
          "newsvs"   = "8"                                                             // new Save vs. Spell
          "newmr"    = "50"                                                            // new Magic Resistance value
          "newfr"    = "100"                                                           // new Resist Fire value
          "newcr"    = "50"                                                            // new Resist Cold value
          "newer"    = "0"                                                             // new Resist Electricity value
          "newlvl1"  = "13"                                                            // new level (first class)
          "newstr"   = "18"                                                            // new Strength value
          "newstrx"  = "100"                                                           // new Exceptional Strength value
          "newint"   = "18"                                                            // new Intelligence value
          "newwis"   = "19"                                                            // new Wisdom value
          "newdex"   = "19"                                                            // new Dexterity value
          "newcon"   = "19"                                                            // new Constitution value
          "newchr"   = "25"                                                            // new Charisma value
          "newmor"   = "20"                                                            // new morale value
          "newmorb"  = "0"                                                             // new morale break value
          "newmorr"  = "1"                                                             // new morale recovery value
          "newrace"  = "121"                                                           // new race (Demonic)
          "newclass" = "179"                                                           // new class (Imp)
          "newalign" = "19"                                                            // new alignment (Lawful Evil)
        STR_VAR                                                                        // initialize strings
          "enfc01"   = "DEMPIT"                                                        // enforced creature 1 (uses strict PnP values)
          "enfc02"   = "DEMPIT01"                                                      // enforced creature 2 (uses strict PnP values)
          "enfc03"   = "TELPIT1"                                                       // enforced creature 3 (uses strict PnP values)
          "enfc04"   = "TELPIT2"                                                       // enforced creature 4 (uses strict PnP values)
          "enfc05"   = "dempitsu"                                                      // enforced creature 5 (uses strict PnP values)
          "enfc06"   = "dw#bazpf"                                                      // enforced creature 6 (uses strict PnP values)
          "enfc07"   = "dw#pitsu"                                                      // enforced creature 7 (uses strict PnP values)
          "enfc08"   = "tg#dem1"                                                      // enforced creature 8 (uses strict PnP values)
          "enfc09"   = "caddem11"                                                      // enforced creature 9 (uses strict PnP values)
          "enfc10"   = "caddem3"                                                      // enforced creature 10 (uses strict PnP values)
          "enfc11"   = "dempitr1"                                                      // enforced creature 11 (uses strict PnP values)
          "enfc12"   = "dempitr2"                                                      // enforced creature 12 (uses strict PnP values)
          "enfc13"   = "heldem3"                                                      // enforced creature 13 (uses strict PnP values)
          "enfc14"   = "heldem4"                                                      // enforced creature 14 (uses strict PnP values)
          "enfc15"   = "z#gpit01"                                                      // enforced creature 15 (uses strict PnP values)
          "enfc16"   = "z#gpitfd"                                                      // enforced creature 16 (uses strict PnP values)
      END                                                                              // ends FUNCTION call
    END
    PATCH_IF "%file%" STRING_COMPARE_CASE dempitsu BEGIN
      LAUNCH_PATCH_FUNCTION ~RR#MDCSC~                                                 // Starts FUNCTION call (aTweaks' Creature Script Modification function)
        STR_VAR                                                                        // Initialize strings
          "newscript"  = "rr#hpitf"                                                    // new AI script
          "script01"   = ""                                                            // first AI script name
          "script02"   = "None"                                                        // second AI script name
          "script03"   = "WTASIGHT"                                                    // third AI script name
          "script04"   = "DEMPIT"                                                      // fourth AI script name
          "script05"   = "DEMPIT01"                                                    // fifth AI script name
          "script06"   = "TELPIT1"                                                     // sixth AI script name
          "script07"   = "DEMPTJ"                                                      // sixth AI script name
          "script08"   = "BPDEMON"                                                     // Big Picture Demon AI
          "script09"   = "BPDEMPIT"                                                    // Big Picture Pit Fiend AI
          "script10"   = "DW2MP4GE"                                                    // Stratagems melee script
		  "script11"   = "DEMBAL01"                                                    // TDD Demon AI
		  "script12"   = "z#gpitfd"                                                    // Spellhold Gauntlet Demon AI
		  "script13"   = "DEMPIT3"                                                     // RoT Demon AI
		  "script14"   = "DEMPIT2"                                                     // RoT Demon AI
		  "script15"   = "WTASI2"                                                      // RoT Demon AI
		  "script16"   = "esxcd01"                                                     // Elistraee mod Demon AI
		  "script17"   = "wqxdem"                                                      // White queen mod Demon AI
          "skipfile01" = "GORBAT1"                                                     // skip script patching for a designated file
          "skipfile02" = "tg#dem1"                                                     // skip script patching for a designated file 
          "skipfile03" = "CADDEM18"                                                    // skip script patching for a designated file 
 END                                                                              // ends FUNCTION call
    END 
    PATCH_IF FiendsScripts = 0 BEGIN                                                   // Only do this if we're not just adding aTweaks scripting
    // LAUNCH_PATCH_FUNCTION fire_spell_immunities END                                    // grant immunities to fire-based area effect spells
      LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~                                        // delete the EFF with the designated opcode
        INT_VAR opcode_to_delete = "16" END                                            // mark opcode #16 (Haste) for deletion
      LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~                                        // delete the EFF with the designated opcode
        INT_VAR opcode_to_delete = "292" END                                           // mark opcode #292 (Protection from Backstab) for deletion
    END
    PATCH_IF LONG_AT 0x28 = 32558 BEGIN 				   	   						   // Animation Compatibility
      WRITE_LONG 0x28 "4352"                                                           // special case, Pit Fiends should use the TANARRI (winged demon) avatar
	END																				   // Animation Compatibility
    END
    // =============================================================================== // the actual work ends here
END                                                                                  // ends file validity check


DEFINE_PATCH_FUNCTION make_quasit BEGIN
  PATCH_INCLUDE ~aTweaks/lib/fj_cre_validity.tpp~                                      // Nythrun's CRE re-indexer macros (needed for corrupt and v1 CREs)
  PATCH_IF valid BEGIN
    PATCH_INCLUDE ~aTweaks/lib/fj_cre_reindex.tpp~
    // =============================================================================== // the actual work starts from here
	REMOVE_KNOWN_SPELLS                                                                // Remove all known spells from the current creature
	REMOVE_MEMORIZED_SPELLS                                                            // Remove all memorized spells from the current creature
	ADD_MEMORIZED_SPELL ~RR#QUBAT~ #0 ~innate~ ( 1 )                                   // adds 1x Polymorph self: Bat
	ADD_MEMORIZED_SPELL ~RR#QUWLF~ #0 ~innate~ ( 1 )                                   // adds 1x Polymorph self: Wolf
	ADD_MEMORIZED_SPELL ~RR#DMFEA~ #0 ~innate~ ( 1 )                                   // adds 1x Blast of fear
	ADD_MEMORIZED_SPELL ~RR#WR206~ #0 ~innate~ ( 1 )                                   // adds Invisibility at will
    REMOVE_CRE_ITEM ~DW#SUMFI~                                                         // removes DW#SUMFI.ITM (SCSII's fiend immunities, prevents conflict)
    REMOVE_CRE_ITEM ~REGHP1~                                                           // removes REGHP1.ITM (regeneration now handled via equipped weapon)
    REMOVE_KNOWN_SPELLS                                                                // Remove all known spells from the current creature
    REMOVE_MEMORIZED_SPELLS                                                            // Remove all memorized spells from the current creature
    REPLACE_CRE_ITEM ~RR#DQUAS~ #0 #0 #0 ~UNDROPPABLE~ ~WEAPON1~ EQUIP                 // replace default weapon with a more PnP accurate weapon
	REPLACE_CRE_ITEM ~RR#DIMP2~ #0 #0 #0 ~UNDROPPABLE~ ~RRING~                  	   // PnP IMP immunities
	REPLACE_CRE_ITEM ~IMMUNE1~ #0 #0 #0 ~UNDROPPABLE~ ~LRING~						   // Immunity to non-magical weapons
    newxpv = 2000
	PATCH_IF ("%SOURCE_RES%" STRING_EQUAL_CASE ~FAMQUA25~) OR ("%SOURCE_RES%" STRING_EQUAL_CASE ~FAMQUAS~) BEGIN
	  newxpv = 0
      LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~                                        // delete the EFF with the designated opcode
        INT_VAR opcode_to_delete = "-1" END                                            // all
	  REPLACE_CRE_ITEM ~FAMMY~ #0 #0 #0 ~UNDROPPABLE~ ~AMULET~					   	   // Add Remove fog of war item
	END
    LPM update_fiend_xp
    PATCH_IF FiendsScripts = 0 BEGIN                                                   // Only do this if we're not just adding aTweaks scripting
      LAUNCH_PATCH_FUNCTION ~RR#MDCRE~                                                 // Starts FUNCTION call (aTweaks' Creature Modification function)
        INT_VAR                                                                        // Initialize variables
           newxpv
          "newmove"  = "11"                                                            // new movement rate
          "newhp"    = "24"                                                            // new hit point value
          "newac"    = "2"                                                             // new Armor Class value
          "newth"    = "17"                                                            // new THAC0 value
          "newapr"   = "3"                                                             // new number of attacks per round
          "newsvd"   = "10"                                                            // new Save vs. Death
          "newsvw"   = "12"                                                            // new Save vs. Wand
          "newsvp"   = "11"                                                            // new Save vs. Polymorph
          "newsvb"   = "12"                                                            // new Save vs. Breath
          "newsvs"   = "13"                                                            // new Save vs. Spell
          "newmr"    = "25"                                                            // new Magic Resistance value
          "newfr"    = "100"                                                           // new Resist Fire value
          "newcr"    = "100"                                                           // new Resist Cold value
          "newer"    = "100"                                                           // new Resist Electricity value
          "newlvl1"  = "3"                                                             // new level (first class)
          "newstr"   = "8"                                                             // new Strength value
          "newint"   = "7"                                                             // new Intelligence value
          "newwis"   = "9"                                                             // new Wisdom value
          "newdex"   = "17"                                                            // new Dexterity value
          "newcon"   = "10"                                                            // new Constitution value
          "newchr"   = "7"                                                             // new Charisma value
          "newmor"   = "10"                                                            // new morale value
          "newmorb"  = "5"                                                             // new morale break value
          "newmorr"  = "60"                                                            // new morale recovery value
          "newrace"  = "141"                                                           // new race (Imp)
          "newclass" = "160"                                                           // new class (Tanari)
          "newalign" = "51"                                                            // new alignment (Chaotic Evil)
        STR_VAR                                                                        // initialize strings
          "enfc01"   = "DEADDEM2"                                                      // enforced creature 1 (uses strict PnP values)
          "enfc02"   = "DQUAS01"                                                       // enforced creature 2 (uses strict PnP values)
          "enfc03"   = "GORTAN5"                                                       // enforced creature 3 (uses strict PnP values)
          "enfc04"   = "IMPQUA01"                                                      // enforced creature 4 (uses strict PnP values)
          "enfc05"   = "TELQUA1"                                                       // enforced creature 5 (uses strict PnP values)
          "enfc06"   = "TELQUA2"                                                       // enforced creature 6 (uses strict PnP values)
      END                                                                              // ends FUNCTION call
    END
    LAUNCH_PATCH_FUNCTION ~RR#MDCSC~                                                   // Starts FUNCTION call (aTweaks' Creature Script Modification function)
      STR_VAR                                                                          // Initialize strings
        "newscript"  = "RR#HQUAS"                                                      // new AI script
        "script01"   = ""                                                              // first AI script name
        "script02"   = "None"                                                          // second AI script name
        "script03"   = "WTASIGHT"                                                      // third AI script name
        "script04"   = "QUASIT"                                                        // fourth AI script name
        "script05"   = "QUASIT01"                                                      // 5th AI script name
        "script06"   = "BPWDASGT"                                                      // Big Picture script
        "script07"   = "DW2MP0GE"                                                      // Stratagems melee script
        "skipfile01" = "TELQUA1"                                                       // skip script patching for a designated file
        "skipfile02" = "TELQUA2"                                                       // skip script patching for a designated file
        "skipfile03" = "FAMQUAS"                                                       // skip script patching for a designated file
        "skipfile04" = "FAMQUA25"                                                       // skip script patching for a designated file
    END                                                                                // ends FUNCTION call
	PATCH_IF FiendsScripts = 0 BEGIN                                                   // Only do this if we're not just adding aTweaks scripting
    // LAUNCH_PATCH_FUNCTION fire_spell_immunities END                                    // grant immunities to fire-based area effect spells
    // LAUNCH_PATCH_FUNCTION cold_spell_immunities END                                    // grant immunities to cold-based area effect spells
    // LAUNCH_PATCH_FUNCTION electrical_spell_immunities END                              // grant immunities to electricity-based area effect spells
    // LAUNCH_PATCH_FUNCTION extraplanar_traits END                                       // grant extraplanar traits
    // LAUNCH_PATCH_FUNCTION hover_immunities END                                         // grant immunities to ground-based spells
      LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~                                        // delete the EFF with the designated opcode
        INT_VAR opcode_to_delete = "193" END                                           // mark opcode #193 (Invisible Detection by Script) for deletion
      LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~                                        // delete the EFF with the designated opcode
        INT_VAR opcode_to_delete = "16" END                                            // mark opcode #16 (Haste) for deletion
      LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~                                        // delete the EFF with the designated opcode
        INT_VAR opcode_to_delete = "98" END                                            // mark opcode #98 (Regeneration) for deletion
    END
    // =============================================================================== // the actual work ends here
  END                                                                                  // ends file validity check
END


DEFINE_PATCH_FUNCTION make_cambion BEGIN
  PATCH_INCLUDE ~aTweaks/lib/fj_cre_validity.tpp~                                      // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
  PATCH_IF valid BEGIN
    PATCH_INCLUDE ~aTweaks/lib/fj_cre_reindex.tpp~                                     // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
    // =============================================================================== // the actual work starts from here
    REMOVE_CRE_ITEM ~DW#SUMFI~                                                         // removes DW#SUMFI.ITM (SCSII's fiend immunities, prevents conflict)
    REMOVE_CRE_ITEM ~SEEINVIS~                                                         // removes SEEINVIS.ITM (no detect invisibility in PnP)
    REMOVE_CRE_ITEM ~HELMNOAN~                                                         // removes HELMNOAN.ITM (no critical hit immunity in PnP)
	REPLACE_CRE_ITEM ~RR#DTANA~ #0 #0 #0 ~UNDROPPABLE~ ~RRING~						   // PnP TANARI immunities
    PATCH_IF !(LONG_AT 0x28 = 21058) BEGIN 											   // Infinity Animation Compatibility (IAv5b)
      WRITE_LONG 0x28 "24832"                                                          // Sets avatar to FIGHTER_MALE_HUMAN
	  WRITE_BYTE 0x2F 83                                                               // skin color (Dark Adamantite Grey)
	  WRITE_BYTE 0x32 105                                                              // Hair color (White)
      WRITE_BYTE 0x2c 0                                                                // Metal Color (Red Tinted Black)
      WRITE_BYTE 0x2d 34                                                               // Minor color (Ghostly Green)
      WRITE_BYTE 0x2e 46                                                               // Major color (Light Red)
      WRITE_BYTE 0x30 97                                                               // Leather color (Light Minty Blue)
      WRITE_BYTE 0x31 18                                                               // Armor color (Light Sea Blue)
	  ADD_CRE_ITEM ~RR#HELM1~ #0 #0 #0 ~UNSTEALABLE&UNDROPPABLE~ ~HELMET~              // add horns 
	END
	PATCH_IF FILE_CONTAINS_EVALUATED (~%SOURCE_FILE%~ ~CHAN01~) BEGIN
	  ADD_CRE_ITEM ~RR#PLAT2~ #0 #0 #0 ~UNSTEALABLE&UNDROPPABLE~ ~ARMOR~               // replace armor with a plate +2 that enable arcane spellcasting
	  ADD_CRE_ITEM ~dwdust~ #0 #0 #0 ~UNSTEALABLE~ ~inv10~
    END
	PATCH_IF FILE_CONTAINS_EVALUATED (~%SOURCE_FILE%~ ~CHAN07~) BEGIN
	  ADD_CRE_ITEM ~RR#PLAT2~ #0 #0 #0 ~UNSTEALABLE&UNDROPPABLE~ ~ARMOR~               // replace armor with a plate +2 that enable arcane spellcasting
	  ADD_CRE_ITEM ~CHAN07~ #0 #0 #0 ~UNSTEALABLE~ ~inv10~
    END
    READ_BYTE 0x6e bg1lswrd                                                            // BG1 Proficiency slot (Large Sword)
    PATCH_IF (%bg1lswrd% < 1) BEGIN                                                    // if the creature has no Large Sword proficiency
      WRITE_BYTE 0x6e 1                                                                // add 1 proficiency point
    END
    PATCH_IF ("%SOURCE_RES%" STRING_EQUAL_CASE ~IDEMON01~) BEGIN                       // special case, the trapped Cambion in Irenicus' dungeon
      ADD_CRE_ITEM ~INVULNER~ #0 #0 #0 ~UNSTEALABLE&UNDROPPABLE~ ~LRING~               // make the Cambion invulnerable while under the protective sphere
    END
    newxpv = 6000
    LPM update_fiend_xp
    PATCH_IF FiendsScripts = 0 BEGIN                                                   // Only do this if we're not just adding aTweaks scripting
      LAUNCH_PATCH_FUNCTION ~RR#MDCRE~                                                 // Starts FUNCTION call (aTweaks' Creature Modification function)
        INT_VAR                                                                        // Initialize variables
         "rr#bsimm"  = "1"                                                             // Backstab immunity (1 = enable)
           newxpv
          "newmove"  = "11"                                                            // new movement rate
          "newhp"    = "48"                                                            // new hit point value
          "newac"    = "2"                                                             // new Armor Class value
          "newth"    = "15"                                                            // new THAC0 value
          "newapr"   = "2"                                                             // new number of attacks per round
          "newsvd"   = "11"                                                            // new Save vs. Death
          "newsvw"   = "9"                                                             // new Save vs. Wand
          "newsvp"   = "11"                                                            // new Save vs. Polymorph
          "newsvb"   = "13"                                                            // new Save vs. Breath
          "newsvs"   = "10"                                                            // new Save vs. Spell
          "newmr"    = "30"                                                            // new Magic Resistance value
          "newfr"    = "100"                                                           // new Resist Fire value
          "newcr"    = "50"                                                            // new Resist Cold value
          "newer"    = "100"                                                           // new Resist Electricity value
          "newlvl1"  = "6"                                                             // new level (first class)
          "newlvl2"  = "6"                                                             // new level (second class)
          "newstr"   = "18"                                                            // new Strength value
          "newstrx"  = "100"                                                           // new Exceptional Strength value
          "newint"   = "16"                                                            // new Intelligence value
          "newwis"   = "13"                                                             // new Wisdom value
          "newdex"   = "18"                                                            // new Dexterity value
          "newcon"   = "16"                                                            // new Constitution value
          "newchr"   = "19"                                                            // new Charisma value
          "newmor"   = "14"                                                            // new morale value
          "newmorb"  = "5"                                                             // new morale break value
          "newmorr"  = "15"                                                            // new morale recovery value
          "newrace"  = "121"                                                           // new race (Demonic)
          "newclass" = "13"                                                            // new class (MAGE_THIEF)
          "newalign" = "51"                                                            // new alignment (Chaotic Evil)
          "newhide"  = "80"                                                            // new Hide in Shadows value
          "newmsil"  = "80"                                                            // new Move Silently value
        STR_VAR                                                                        // initialize strings
          "enfc01"   = "CAMBION1"                                                      // enforced creature 1 (uses strict PnP values)
          "enfc02"   = "CAMBION2"                                                      // enforced creature 2 (uses strict PnP values)
          "enfc03"   = "IDEMON01"                                                      // enforced creature 3 (uses strict PnP values)
          "enfc04"   = "IDEMON02"                                                      // enforced creature 4 (uses strict PnP values)
          "enfc05"   = "TELCAM1"                                                       // enforced creature 5 (uses strict PnP values)
          "enfc06"   = "illcamb"                                                       // enforced creature 6 (uses strict PnP values)
          "enfc07"   = "illcamb2"                                                      // enforced creature 7 (uses strict PnP values)
          "enfc08"   = "kdemon01"                                                      // enforced creature 8 (uses strict PnP values)
          "enfc09"   = "TCCAMBI1"                                                      // enforced creature 9 (uses strict PnP values)
          "enfc10"   = "TCCAMBI2"                                                      // enforced creature 10 (uses strict PnP values)
      END                                                                              // ends FUNCTION call
    END
    LAUNCH_PATCH_FUNCTION ~RR#MDCSC~                                                   // Starts FUNCTION call (aTweaks' Creature Script Modification function)
      STR_VAR                                                                          // Initialize strings
        "newscript"  = "RR#HCAMB"                                                      // new AI script
        "script01"   = ""                                                              // first AI script name
        "script02"   = "None"                                                          // second AI script name
        "script03"   = "WTASIGHT"                                                      // third AI script name
        "script04"   = "CTHIE20B"                                                      // fourth AI script name
		"script05"   = "TANARI"                                                        // fifth AI script name
        "script06"   = "BPDEMTHF"                                                      // Big Picture script
        "script07"   = "BPWTRSGT"                                                      // Big Picture script
        "script08"   = "BPDEMON"                                                       // Big Picture Demon script
		"script09"   = "AESGAR"
		"script10"   = "ERRTU"		
        "script11"   = "DW2MS2TH"                                                      // Stratagems melee script
 		"script12"   = "DW2MS1GE"                                                      // Stratagems melee script
        "script13"   = "DW2MC5GE"                                                      // Stratagems melee script
		"script14"   = "DW2MM4TH"                                                      // Stratagems melee script
		"script15"   = "DW2MM4GE"                                                      // Stratagems melee script
        "script16"   = "DW2MS1TH"                                                      // Stratagems melee script
 		"script17"   = "DW#MG162"                                                      // Stratagems Mage script
		"script18"   = "DW#MG205"                                                      // Stratagems Mage script		
		"script19"   = "DW_0008"		
		"script20"   = "DW#MG590"                                                      // Stratagems Mage script		
		"script21"   = "DW#MG199"                                                      // Stratagems Mage script		
		"script22"   = "DW#MG598"                                                      // Stratagems Mage script		
        "skipfile01" = "IDEMON01"                                                      // skip script patching for a designated file
        "skipfile02" = "KDEMON01"                                                      // skip script patching for a designated file
        "skipfile03" = "GORCAMB"                                                       // skip script patching for a designated file
        "skipfile04" = "ILLCAMB"                                                       // skip script patching for a designated file
        "skipfile05" = "ILLCAMB2"                                                      // skip script patching for a designated file
        "skipfile06" = "PWARDEN"                                                       // skip script patching for a designated file
        "skipfile07" = "FINCAMB2"                                                      // skip script patching for a designated file
        "skipfile08" = "AGCAMB01"                                                      // skip script patching for a designated file
        "skipfile09" = "AGCAMB02"                                                      // skip script patching for a designated file
        "skipfile10" = "nscamb03"                                                      // skip script patching for a designated file
    END                                                                                // ends FUNCTION call
    PATCH_IF FiendsScripts = 0 BEGIN                                                   // Only do this if we're not just adding aTweaks scripting
		// LAUNCH_PATCH_FUNCTION fire_spell_immunities END                                // grant immunities to fire-based area effect spells
		// LAUNCH_PATCH_FUNCTION electrical_spell_immunities END                          // grant immunities to electricity-based area effect spells
		LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~                                      // delete the EFF with the designated opcode
			INT_VAR opcode_to_delete = "193" END                                       // mark opcode #193 (Invisible Detection by Script) for deletion
    END
    PATCH_IF NOT (("%SOURCE_RES%" STRING_EQUAL_CASE ~GORCAMB~) OR ("%SOURCE_RES%" STRING_EQUAL_CASE ~PWARDEN~) OR ("%SOURCE_RES%" STRING_EQUAL_CASE ~AGCAMB01~) OR ("%SOURCE_RES%" STRING_EQUAL_CASE ~AGCAMB02~)) BEGIN  // special case, don't alter the Warden's, Aesgareth's spell selection and Aurora Demon's spells
		WRITE_LONG 0x244 0x4000000												   	   // Add a Mage Kit: Illusionist
		REMOVE_KNOWN_SPELLS                                                            // Remove all known spells from the current creature
		REMOVE_MEMORIZED_SPELLS                                                        // Remove all memorized spells from the current creature
		ADD_MEMORIZED_SPELL ~SPWI106~ #0 ~wizard~ ( 3 )                                // adds 3x Blindness
		ADD_MEMORIZED_SPELL ~SPWI112~ #0 ~wizard~ ( 2 )                                // adds 2x Magic Missile
		ADD_MEMORIZED_SPELL ~SPWI206~ #1 ~wizard~ ( 2 )                                // adds 2x Invisibility
		ADD_MEMORIZED_SPELL ~SPWI212~ #1 ~wizard~                                      // adds 1x Mirror Image
		ADD_MEMORIZED_SPELL ~SPWI305~ #2 ~wizard~                                      // adds 1x Haste
		ADD_MEMORIZED_SPELL ~SPWI312~ #2 ~wizard~                                      // adds 1x Slow
		ADD_MEMORIZED_SPELL ~SPWI322~ #2 ~wizard~                                      // adds 1x Detect Illusion
    END
    // =============================================================================== // the actual work ends here
  END                                                                                  // ends file validity check
END


DEFINE_PATCH_FUNCTION make_alu-fiend BEGIN
  PATCH_INCLUDE ~aTweaks/lib/fj_cre_validity.tpp~                                      // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
  PATCH_IF valid BEGIN
    PATCH_INCLUDE ~aTweaks/lib/fj_cre_reindex.tpp~                                     // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
    // =============================================================================== // the actual work starts from here
    PATCH_IF !(LONG_AT 0x28 = 21059) BEGIN 											   // Infinity Animation Compatibility (IAv5b)
      WRITE_LONG 0x28 "25105"                                                          // Sets avatar to MAGE_FEMALE_ELF
	END
    REMOVE_CRE_ITEM ~DW#SUMFI~                                                         // removes DW#SUMFI.ITM (SCSII's fiend immunities, prevents conflict)
    REMOVE_CRE_ITEM ~HELMNOAN~                                                         // removes HELMNOAN.ITM (no critical hit immunity in PnP)
	REPLACE_CRE_ITEM ~RR#DTANA~ #0 #0 #0 ~UNDROPPABLE~ ~RRING~						   // PnP TANARI immunities
    REPLACE_CRE_ITEM ~IMMUNE1~ #0 #0 #0 ~UNSTEALABLE&UNDROPPABLE~ ~LRING~              // add immunity to +1 weapons and below
    PATCH_IF FILE_CONTAINS_EVALUATED (~%SOURCE_FILE%~ ~CHAN08~) BEGIN                  // if the creature does possess chain armor
	  ADD_CRE_ITEM ~RR#CLCK2~ #0 #0 #0 ~UNSTEALABLE&UNDROPPABLE~ ~ARMOR~               // replace armor with a robe +4 to enable arcane spellcasting
	END ELSE PATCH_IF FILE_CONTAINS_EVALUATED (~%SOURCE_FILE%~ ~LEAT07~) BEGIN		   // if the creature does possess leather armor
	  ADD_CRE_ITEM ~RR#CLCK1~ #0 #0 #0 ~UNSTEALABLE&UNDROPPABLE~ ~ARMOR~               // replace armor with a robe +2 to enable arcane spellcasting	  
	END
	PATCH_IF FILE_EXISTS_IN_GAME "RR#WING2.ITM" BEGIN
	  ADD_CRE_ITEM ~RR#WING2~ #0 #0 #0 ~UNSTEALABLE&UNDROPPABLE~ ~HELMET~             // add wings
	END
    newxpv = 6000
    LPM update_fiend_xp
    PATCH_IF FiendsScripts = 0 BEGIN                                                   // Only do this if we're not just adding aTweaks scripting
      LAUNCH_PATCH_FUNCTION ~RR#MDCRE~                                                 // Starts FUNCTION call (aTweaks' Creature Modification function)
        INT_VAR                                                                        // Initialize variables
         "rr#bsimm"  = "1"                                                             // Backstab immunity (1 = enable)
           newxpv
          "newhp"    = "48"                                                            // new hit point value
          "newac"    = "2"                                                             // new Armor Class value
          "newth"    = "17"                                                            // new THAC0 value
          "newapr"   = "1"                                                             // new number of attacks per round
          "newsvd"   = "11"                                                            // new Save vs. Death
          "newsvw"   = "7"                                                             // new Save vs. Wand
          "newsvp"   = "9"                                                             // new Save vs. Polymorph
          "newsvb"   = "11"                                                            // new Save vs. Breath
          "newsvs"   = "8"                                                             // new Save vs. Spell
          "newmr"    = "30"                                                            // new Magic Resistance value
          "newfr"    = "100"                                                           // new Resist Fire value
          "newcr"    = "50"                                                            // new Resist Cold value
          "newer"    = "100"                                                           // new Resist Electricity value
          "newlvl1"  = "12"                                                            // new level (first class)
          "newstr"   = "15"                                                            // new Strength value
          "newint"   = "18"                                                            // new Intelligence value
          "newwis"   = "12"                                                            // new Wisdom value
          "newdex"   = "17"                                                            // new Dexterity value
          "newcon"   = "15"                                                            // new Constitution value
          "newchr"   = "16"                                                            // new Charisma value
          "newmor"   = "12"                                                            // new morale value
          "newmorb"  = "5"                                                             // new morale break value
          "newmorr"  = "15"                                                            // new morale recovery value
          "newrace"  = "121"                                                           // new race (Demonic)
          "newclass" = "1"                                                             // new class (Mage)
          "newgendr" = "2"                                                             // new gender (Female)
          "newsex"   = "2"                                                             // new sex (Female)
          "newalign" = "51"                                                            // new alignment (Chaotic Evil)
        STR_VAR                                                                        // initialize strings
          "enfc01"   = "ALUFIE01"                                                      // enforced creature 1 (uses strict PnP values)
          "enfc02"   = "ALUFIE02"                                                      // enforced creature 2 (uses strict PnP values)
          "enfc03"   = "GORALU01"                                                      // enforced creature 3 (uses strict PnP values)
          "enfc04"   = "TELALU1"                                                       // enforced creature 4 (uses strict PnP values)
          "enfc05"   = "TELSUC1"                                                       // enforced creature 5 (uses strict PnP values)
          "enfc06"   = "nsaluf01"                                                      // enforced creature 8 (uses strict PnP values)
     END                                                                               // ends FUNCTION call
    END
    LAUNCH_PATCH_FUNCTION ~RR#MDCSC~                                                   // Starts FUNCTION call (aTweaks' Creature Script Modification function)
      STR_VAR                                                                          // Initialize strings
        "newscript"  = "RR#HALUF"                                                      // new AI script
        "script01"   = ""                                                              // first AI script name
        "script02"   = "None"                                                          // second AI script name
        "script03"   = "WTASIGHT"                                                      // third AI script name
        "script04"   = "CFIGH20B"                                                      // fourth AI script name
        "script05"   = "CARCH20B"                                                      // fifth AI script name
        "script06"   = "DEMALU01"                                                      // sixth AI script name
        "script07"   = "BPCFIG2B"                                                      // Big Picture script
        "script08"   = "BPCARC2B"                                                      // Big Picture script
        "script09"   = "BPDEMON"                                                       // Big Picture demon script
		"script10"   = "DW2MC3GE"                                                      // Stratagems melee script
		"script11"   = "DW2RS1GE"                                                      // Stratagems melee script
		"script12"   = "DW2RS3GE"                                                      // Stratagems melee script
        "script13"   = "DW3MS3BE"                                                      // Stratagems melee script
		"script14"   = "DW2MS0GE"                                                      // Stratagems melee script
		"script15"   = "FINALUF"                                                       // Ascension Demon script
		"script16"   = "NTINDFI1"                                                      // NTotSC Demon script		
		"script17"   = "NTINDFI2"                                                      // NTotSC 
		"script18"   = "NTINDFIG"                                                      // NTotSC 
		"script19"   = "NTINDFIF"                                                      // NTotSC Alu-fiend script
		"script20"   = "GRPSHT01"                                                      // NTotSC Alu-fiend script
        "skipfile01" = "AGALUF01"                                                      // skip script patching for a designated file
        "skipfile02" = "AGALUF02"                                                      // skip script patching for a designated file
    END                                                                                // ends FUNCTION call
    PATCH_IF FiendsScripts = 0 BEGIN                                                   // Only do this if we're not just adding aTweaks scripting
		// LAUNCH_PATCH_FUNCTION fire_spell_immunities END                                // grant immunities to fire-based area effect spells
		// LAUNCH_PATCH_FUNCTION electrical_spell_immunities END                          // grant immunities to electricity-based area effect spells
		LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~                                      // delete the EFF with the designated opcode
			INT_VAR opcode_to_delete = "193" END                                       // mark opcode #193 (Invisible Detection by Script) for deletion
    END
    PATCH_IF NOT (("%SOURCE_RES%" STRING_EQUAL_CASE ~AGALUF01~) OR ("%SOURCE_RES%" STRING_EQUAL_CASE ~AGALUF02~)) BEGIN  // special case, don't alter Aurora Demon's spells
		REMOVE_KNOWN_SPELLS                                                            // Remove all known spells from the current creature
		REMOVE_MEMORIZED_SPELLS                                                        // Remove all memorized spells from the current creature
		ADD_KNOWN_SPELL     ~SPWI201~ #1 ~wizard~                                      // add Blur as known
		ADD_KNOWN_SPELL     ~SPWI403~ #3 ~wizard~                                      // add Fire Shield (Blue) as known
		ADD_KNOWN_SPELL     ~SPWI420~ #3 ~wizard~                                      // add Minor Sequencer as known
		ADD_KNOWN_SPELL     ~SPWI522~ #4 ~wizard~                                      // add Minor Spell Turning as known
		ADD_KNOWN_SPELL     ~SPWI617~ #5 ~wizard~                                      // add Contingency as known
		ADD_MEMORIZED_SPELL ~SPWI106~ #0 ~wizard~ (2)                                  // adds 2x Blindness
		ADD_MEMORIZED_SPELL ~SPWI112~ #0 ~wizard~ (2)                                  // adds 2x Magic Missile
		ADD_MEMORIZED_SPELL ~SPWI212~ #1 ~wizard~ (3)                                  // adds 3x Mirror Image
		ADD_MEMORIZED_SPELL ~SPWI219~ #1 ~wizard~                                      // adds 1x Vocalize
		ADD_MEMORIZED_SPELL ~SPWI312~ #2 ~wizard~ (2)                                  // adds 2x Slow
		ADD_MEMORIZED_SPELL ~SPWI314~ #2 ~wizard~ (2)                                  // adds 2x Vampiric Touch
		ADD_MEMORIZED_SPELL ~SPWI405~ #3 ~wizard~ (2)                                  // adds 2x Improved Invisibility
		ADD_MEMORIZED_SPELL ~SPWI408~ #3 ~wizard~ (2)                                  // adds 2x Stoneskin
		ADD_MEMORIZED_SPELL ~SPWI507~ #4 ~wizard~ (2)                                  // adds 2x Hold Monster
		ADD_MEMORIZED_SPELL ~SPWI508~ #4 ~wizard~ (2)                                  // adds 2x Chaos
		ADD_MEMORIZED_SPELL ~SPWI611~ #5 ~wizard~                                      // adds 1x Protection From Magical Weapons
	END
    // =============================================================================== // the actual work ends here
  END                                                                                  // ends file validity check
END


DEFINE_PATCH_FUNCTION make_maurezhi BEGIN
  PATCH_INCLUDE ~aTweaks/lib/fj_cre_validity.tpp~                                      // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
  PATCH_IF valid BEGIN
    PATCH_INCLUDE ~aTweaks/lib/fj_cre_reindex.tpp~                                     // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
    // =============================================================================== // the actual work starts from here
    REMOVE_CRE_ITEM ~DW#SUMFI~                                                         // removes DW#SUMFI.ITM (SCSII's fiend immunities, prevents conflict)
    REMOVE_CRE_ITEM ~SEEINVIS~                                                         // removes SEEINVIS.ITM (no detect invisibility in PnP)
    REMOVE_CRE_ITEM ~HELMNOAN~                                                         // removes HELMNOAN.ITM (no critical hit immunity in PnP)
    REMOVE_KNOWN_SPELLS                                                                // Remove all known spells from the current creature
    REMOVE_MEMORIZED_SPELLS                                                            // Remove all memorized spells from the current creature
	REPLACE_CRE_ITEM ~RR#DTANA~ #0 #0 #0 ~UNDROPPABLE~ ~RRING~						   // PnP TANARI immunities
    REPLACE_CRE_ITEM ~IMMUNE1~ #0 #0 #0 ~UNSTEALABLE&UNDROPPABLE~ ~LRING~                // add immunity to +1 weapons and below
    REPLACE_CRE_ITEM ~RR#DMAUR~ #0 #0 #0 ~UNDROPPABLE~ ~WEAPON1~ EQUIP                 // replace default weapon with a less powerful weapon (closer to PnP damage output)
    newxpv = 6000
    LPM update_fiend_xp
    PATCH_IF FiendsScripts = 0 BEGIN                                                   // Only do this if we're not just adding aTweaks scripting
      LAUNCH_PATCH_FUNCTION ~RR#MDCRE~                                                 // Starts FUNCTION call (aTweaks' Creature Modification function)
        INT_VAR                                                                        // Initialize variables
           newxpv
          "newmove"  = "9"                                                             // new movement rate
          "newhp"    = "45"                                                            // new hit point value
          "newac"    = "0"                                                             // new Armor Class value
          "newth"    = "15"                                                            // new THAC0 value
          "newapr"   = "3"                                                             // new number of attacks per round
          "newsvd"   = "8"                                                             // new Save vs. Death
          "newsvw"   = "10"                                                            // new Save vs. Wand
          "newsvp"   = "9"                                                             // new Save vs. Polymorph
          "newsvb"   = "9"                                                             // new Save vs. Breath
          "newsvs"   = "11"                                                            // new Save vs. Spell
          "newmr"    = "34"                                                            // new Magic Resistance value
          "newfr"    = "100"                                                           // new Resist Fire value
          "newcr"    = "50"                                                            // new Resist Cold value
          "newer"    = "100"                                                           // new Resist Electricity value
          "newlvl1"  = "5"                                                             // new level (first class)
          "newstr"   = "14"                                                            // new Strength value
          "newint"   = "16"                                                            // new Intelligence value
          "newwis"   = "8"                                                             // new Wisdom value
          "newdex"   = "15"                                                            // new Dexterity value
          "newcon"   = "12"                                                            // new Constitution value
          "newchr"   = "9"                                                             // new Charisma value
          "newmor"   = "12"                                                            // new morale value
          "newmorb"  = "4"                                                             // new morale break value
          "newmorr"  = "15"                                                            // new morale recovery value
          "newrace"  = "121"                                                           // new race (Demonic)
          "newclass" = "160"                                                           // new class (Tanari)
          "newalign" = "51"                                                            // new alignment (Chaotic Evil)
        STR_VAR                                                                        // initialize strings
          "enfc01"   = "DEMMAU01"                                                      // enforced creature 1 (uses strict PnP values)
          "enfc02"   = "GORTAN6"                                                       // enforced creature 2 (uses strict PnP values)
          "enfc03"   = "OBSDEM04"                                                      // enforced creature 3 (uses strict PnP values)
      END                                                                              // ends FUNCTION call
    END
    LAUNCH_PATCH_FUNCTION ~RR#MDCSC~                                                   // Starts FUNCTION call (aTweaks' Creature Script Modification function)
      STR_VAR                                                                          // Initialize strings
        "newscript"  = "RR#HMAUR"                                                      // new AI script
        "script01"   = ""                                                              // first AI script name
        "script02"   = "None"                                                          // second AI script name
        "script03"   = "WTASIGHT"                                                      // third AI script name
        "script04"   = "OBSDEM04"                                                      // fourth AI script name
        "script05"   = "DEMMAU01"                                                      // fifth AI script name
        "script06"   = "BPPRI10A"                                                      // Big Picture script
        "script07"   = "BPDEMON"                                                       // Big Picture demon script
		"script08"   = "DW2MS3GE"                                                      // Stratagems melee script
		"script09"   = "DW2MS3GW"                                                      // Stratagems melee script
		"script10"   = "ntfiends"                                                      // NTotSC Scripts
		"script11"   = "ntmaurez"                                                      // NTotSC Scripts
    END                                                                                // ends FUNCTION call
    PATCH_IF FiendsScripts = 0 BEGIN                                                   // Only do this if we're not just adding aTweaks scripting
    // LAUNCH_PATCH_FUNCTION fire_spell_immunities END                                    // grant immunities to fire-based area effect spells
    // LAUNCH_PATCH_FUNCTION electrical_spell_immunities END                              // grant immunities to electricity-based area effect spells
      LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~                                        // delete the EFF with the designated opcode
        INT_VAR opcode_to_delete = "193" END                                           // mark opcode #193 (Invisible Detection by Script) for deletion
      LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~                                        // delete the EFF with the designated opcode
        INT_VAR opcode_to_delete = "292" END                                           // mark opcode #292 (Protection from Backstab) for deletion
    END
    PATCH_IF ((IDS_OF_SYMBOL (~animate~ ~MAUREZHI~)) > 0) BEGIN 				   	   // Infinity Animation Compatibility (IAv5b)
      WRITE_LONG 0x28 (IDS_OF_SYMBOL (~animate~ ~MAUREZHI~))	              		   // Use IA Maurezhi apperance
	  WRITE_BYTE 0x2d 107 															   // Minor color (KHAKI_GRAY)
	  WRITE_BYTE 0x2e 62  															   // Major color (DARK_LAVENDER)
	  WRITE_BYTE 0x2f 62  															   // Skin color
	END ELSE WRITE_LONG 0x28 "30464"                                                   // special case, standardize Maurezhi apperance (use Ghoul avatar)
    // =============================================================================== // the actual work ends here
  END                                                                                  // ends file validity check
END


DEFINE_PATCH_FUNCTION make_succubus BEGIN
  PATCH_INCLUDE ~aTweaks/lib/fj_cre_validity.tpp~                                      // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
  PATCH_IF valid BEGIN
    PATCH_INCLUDE ~aTweaks/lib/fj_cre_reindex.tpp~                                     // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
    // =============================================================================== // the actual work starts from here
    REMOVE_CRE_ITEM ~DW#SUMFI~                                                         // removes DW#SUMFI.ITM (SCSII's fiend immunities, prevents conflict)
    REMOVE_CRE_ITEM ~HELMNOAN~                                                         // removes HELMNOAN.ITM (no critical hit immunity in PnP)
    REMOVE_CRE_ITEM ~FINSUCC~                                                          // removes FINSUCC.ITM (Ascension Weapon, not PnP)
    REMOVE_KNOWN_SPELLS                                                                // Remove all known spells from the current creature
    REMOVE_MEMORIZED_SPELLS                                                            // Remove all memorized spells from the current creature
	REPLACE_CRE_ITEM ~RR#DTANA~ #0 #0 #0 ~UNDROPPABLE~ ~RRING~						   // PnP TANARI immunities
    REPLACE_CRE_ITEM ~IMMUNE2~ #0 #0 #0 ~UNSTEALABLE&UNDROPPABLE~ ~LRING~              // add immunity to +1 weapons and below
    newxpv = 11000
    LPM update_fiend_xp
    PATCH_IF FiendsScripts = 0 BEGIN                                                   // Only do this if we're not just adding aTweaks scripting
      LAUNCH_PATCH_FUNCTION ~RR#MDCRE~                                                 // Starts FUNCTION call (aTweaks' Creature Modification function)
        INT_VAR                                                                        // Initialize variables
         "rr#bsimm"  = "1"                                                             // Backstab immunity (1 = enable)
           newxpv
          "newmove"  = "9"                                                             // new movement rate
          "newhp"    = "48"                                                            // new hit point value
          "newac"    = "0"                                                             // new Armor Class value
          "newth"    = "15"                                                            // new THAC0 value
          "newapr"   = "2"                                                             // new number of attacks per round
          "newsvd"   = "10"                                                            // new Save vs. Death
          "newsvw"   = "12"                                                            // new Save vs. Wand
          "newsvp"   = "11"                                                            // new Save vs. Polymorph
          "newsvb"   = "12"                                                            // new Save vs. Breath
          "newsvs"   = "13"                                                            // new Save vs. Spell
          "newmr"    = "30"                                                            // new Magic Resistance value
          "newfr"    = "100"                                                           // new Resist Fire value
          "newcr"    = "50"                                                            // new Resist Cold value
          "newer"    = "100"                                                           // new Resist Electricity value
          "newlvl1"  = "6"                                                             // new level (first class)
          "newstr"   = "15"                                                            // new Strength value
          "newint"   = "16"                                                            // new Intelligence value
          "newwis"   = "14"                                                            // new Wisdom value
          "newdex"   = "17"                                                            // new Dexterity value
          "newcon"   = "12"                                                            // new Constitution value
          "newchr"   = "18"                                                            // new Charisma value
          "newmor"   = "14"                                                            // new morale value
          "newmorb"  = "5"                                                             // new morale break value
          "newmorr"  = "15"                                                            // new morale recovery value
          "newrace"  = "121"                                                           // new race (Demonic)
          "newclass" = "160"                                                           // new class (Tanari)
          "newgendr" = "2"                                                             // new gender (Female)
          "newsex"   = "2"                                                             // new sex (Female)
          "newalign" = "51"                                                            // new alignment (Chaotic Evil)
        STR_VAR                                                                        // initialize strings
          "enfc01"   = "DEMSUC01"                                                      // enforced creature 1 (uses strict PnP values)
          "enfc02"   = "GORSUC01"                                                      // enforced creature 2 (uses strict PnP values)
          "enfc03"   = "GORTAN2"                                                       // enforced creature 3 (uses strict PnP values)
          "enfc04"   = "KIRINH"                                                        // enforced creature 4 (uses strict PnP values)
          "enfc05"   = "_KIRINH"                                                       // enforced creature 5 (uses strict PnP values)
          "enfc06"   = "yugsuc01"                                                      // enforced creature 6 (uses strict PnP values)
      END                                                                              // ends FUNCTION call
    END
    LAUNCH_PATCH_FUNCTION ~RR#MDCSC~                                                   // Starts FUNCTION call (aTweaks' Creature Script Modification function)
      STR_VAR                                                                          // Initialize strings
        "newscript"  = "RR#HSUCC"                                                      // new AI script
        "script01"   = ""                                                              // first AI script name
        "script02"   = "None"                                                          // second AI script name
        "script03"   = "WTASIGHT"                                                      // third AI script name
        "script04"   = "DEMSUC"                                                        // fourth AI script name
        "script05"   = "KIRINH"                                                        // 5th AI script name
        "script06"   = "_KIRINH"                                                       // 6th AI script name
        "script07"   = "_TASIGHT"                                                      // 7th AI script name
        "script08"   = "NALMISS"                                                       // 8th AI script name
        "script09"   = "BPDEMON"                                                       // Big Picture demon script
        "script10"   = "INITDLG"                                                       // dialogue initialization script (BGT Kirinhale)
        "script11"   = "_INITDLG"                                                      // dialogue initialization script (Tutu Kirinhale)
        "script12"   = "DW2MC0GE"                                                      // Stratagems melee script
        "script13"   = "DW2MC2GW"                                                      // Stratagems melee script
		"script14"   = "ntfiends"                                                      // NTotSC Scripts
		"script15"   = "ntsuccub"                                                      // NTotSC Scripts
		"script16"   = "GRPSHT01"                                                      // NTotSC Alu-fiend script
		"skipfile01" = "X#AMELIA"                                                      // BG1 NPC Project melee script
		"skipfile02" = "FINSUCC"                                                       // Ascension demon script
    END                                                                                // ends FUNCTION call
    PATCH_IF FiendsScripts = 0 BEGIN                                                   // Only do this if we're not just adding aTweaks scripting
    // LAUNCH_PATCH_FUNCTION fire_spell_immunities END                                    // grant immunities to fire-based area effect spells
    // LAUNCH_PATCH_FUNCTION electrical_spell_immunities END                              // grant immunities to electricity-based area effect spells
      LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~                                        // delete the EFF with the designated opcode
        INT_VAR opcode_to_delete = "193" END                                           // mark opcode #193 (Invisible Detection by Script) for deletion
    END
    // PATCH_IF ("%SOURCE_RES%" STRING_EQUAL_CASE ~_KIRINH~) BEGIN                        // special case, Tutu's Kirinhale needs a proper immunity item
      // REPLACE_CRE_ITEM ~RINGDEMN~ #0 #0 #0 ~UNSTEALABLE&UNDROPPABLE~ ~RRING~           // replace the Tutu fiend immunty ring with the BG2 version
      // ADD_CRE_ITEM ~IMMUNE2~ #0 #0 #0 ~UNSTEALABLE&UNDROPPABLE~ ~LRING~                // add immunity to +1 weapons and below
    // END
    // PATCH_IF ("%SOURCE_RES%" STRING_EQUAL_CASE ~KIRINH~) BEGIN                         // special case, BGT's Kirinhale needs a proper immunity item
      // ADD_CRE_ITEM ~IMMUNE2~ #0 #0 #0 ~UNSTEALABLE&UNDROPPABLE~ ~LRING~                // add immunity to +1 weapons and below
    // END
    // PATCH_IF !("%SOURCE_RES%" STRING_EQUAL_CASE ~x#amelia~) BEGIN                      // special case for Amelia, the Succubus added by BG1 NPCs during Coran's quest, don't change animation
	PATCH_IF (LONG_AT 0x28 = (IDS_OF_SYMBOL (~animate~ ~SUCCUBUS_NWN~))) BEGIN 	   	   // NWN Succubus animation - Infinity Animation (IAv5b)
      WRITE_LONG 0x28 (IDS_OF_SYMBOL (~animate~ ~SIRINE~))	              	       	   // undo IA succubus change
	END
	// END
    // =============================================================================== // the actual work ends here
  END                                                                                  // ends file validity check
END


DEFINE_PATCH_FUNCTION make_nabassu BEGIN
  PATCH_INCLUDE ~aTweaks/lib/fj_cre_validity.tpp~                                      // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
  PATCH_IF valid BEGIN
    PATCH_INCLUDE ~aTweaks/lib/fj_cre_reindex.tpp~                                     // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
    // =============================================================================== // the actual work starts from here
    REMOVE_CRE_ITEM ~DW#SUMFI~                                                         // removes DW#SUMFI.ITM (SCSII's fiend immunities, prevents conflict)
    REMOVE_KNOWN_SPELLS                                                                // Remove all known spells from the current creature
    REMOVE_MEMORIZED_SPELLS                                                            // Remove all memorized spells from the current creature
	REPLACE_CRE_ITEM ~RR#DTANA~ #0 #0 #0 ~UNDROPPABLE~ ~RRING~						   // PnP TANARI immunities
    REPLACE_CRE_ITEM ~IMMUNE1~ #0 #0 #0 ~UNSTEALABLE&UNDROPPABLE~ ~LRING~              // add immunity to +1 weapons and below
 	REPLACE_CRE_ITEM ~REGHP2~ #0 #0 #0 ~UNDROPPABLE~ ~AMULET~
    REPLACE_CRE_ITEM ~RR#DNABA~ #0 #0 #0 ~UNDROPPABLE~ ~WEAPON1~ EQUIP                 // replace default weapon with a less powerful weapon (closer to PnP damage output)
    newxpv = 16000
    LPM update_fiend_xp
    PATCH_IF FiendsScripts = 0 BEGIN                                                   // Only do this if we're not just adding aTweaks scripting
      LAUNCH_PATCH_FUNCTION ~RR#MDCRE~                                                 // Starts FUNCTION call (aTweaks' Creature Modification function)
        INT_VAR                                                                        // Initialize variables
           newxpv
          "newmove"  = "9"                                                             // new movement rate
          "rr#bump"  = "1"                                                             // NPC bump (1 = enable)
          "newhp"    = "76"                                                            // new hit point value
          "newac"    = "-5"                                                            // new Armor Class value
          "newth"    = "13"                                                            // new THAC0 value
          "newapr"   = "3"                                                             // new number of attacks per round
          "newsvd"   = "10"                                                            // new Save vs. Death
          "newsvw"   = "12"                                                            // new Save vs. Wand
          "newsvp"   = "11"                                                            // new Save vs. Polymorph
          "newsvb"   = "12"                                                            // new Save vs. Breath
          "newsvs"   = "13"                                                            // new Save vs. Spell
          "newmr"    = "50"                                                            // new Magic Resistance value
          "newfr"    = "100"                                                           // new Resist Fire value
          "newcr"    = "50"                                                            // new Resist Cold value
          "newer"    = "100"                                                           // new Resist Electricity value
          "newlvl1"  = "7"                                                             // new level (first class)
          "newstr"   = "19"                                                            // new Strength value
          "newint"   = "14"                                                            // new Intelligence value
          "newwis"   = "15"                                                            // new Wisdom value
          "newdex"   = "14"                                                            // new Dexterity value
          "newcon"   = "19"                                                            // new Constitution value
          "newchr"   = "18"                                                            // new Charisma value
          "newmor"   = "16"                                                            // new morale value
          "newmorb"  = "4"                                                             // new morale break value
          "newmorr"  = "15"                                                            // new morale recovery value
          "newrace"  = "121"                                                           // new race (Demonic)
          "newclass" = "160"                                                           // new class (Tanari)
          "newalign" = "51"                                                            // new alignment (Chaotic Evil)
        STR_VAR                                                                        // initialize strings
          "enfc01"   = "DEMNAB01"                                                      // enforced creature 1 (uses strict PnP values)
          "enfc02"   = "DEMNAB02"                                                      // enforced creature 2 (uses strict PnP values)
          "enfc03"   = "UDNABA"                                                        // enforced creature 3 (uses strict PnP values)
          "enfc04"   = "demnabsu"                                                      // enforced creature 4 (uses strict PnP values)
          "enfc05"   = "rumar02"                                                       // enforced creature 5 (uses strict PnP values)
          "enfc06"   = "obsdem05"                                                      // enforced creature 6 (uses strict PnP values)
          "enfc07"   = "tanari01"                                                      // enforced creature 7 (uses strict PnP values)
          "enfc08"   = "dw#nabsu"                                                      // enforced creature 8 (uses strict PnP values)
          "enfc09"   = "tg#dem2"                                                       // enforced creature 9 (uses strict PnP values)
          "enfc10"   = "demnabr1"                                                      // enforced creature 10 (uses strict PnP values)
          "enfc11"   = "demnabr2"                                                      // enforced creature 11 (uses strict PnP values)
          "enfc12"   = "z#gnabas"                                                      // enforced creature 12 (uses strict PnP values)
      END                                                                              // ends FUNCTION call
    END
    PATCH_IF "%file%" STRING_COMPARE_CASE demnabsu BEGIN
      LAUNCH_PATCH_FUNCTION ~RR#MDCSC~                                                 // Starts FUNCTION call (aTweaks' Creature Script Modification function)
        STR_VAR                                                                        // Initialize strings
          "newscript"  = "rr#hnaba"                                                    // new AI script
          "script01"   = ""                                                            // first AI script name
          "script02"   = "None"                                                        // second AI script name
          "script03"   = "WTASIGHT"                                                    // third AI script name
          "script04"   = "SUMTAN01"                                                    // fourth AI script name
          "script05"   = "TANARI2"                                                     // fifth AI script name
          "script06"   = "TANARI"                                                      // sixth AI script name
          "script07"   = "DEMNAB02"                                                    // seventh AI script name
          "script08"   = "_TANARI"                                                     // 8th AI script name
          "script09"   = "_TASIGHT"                                                    // 9th AI script name
          "script10"   = "BGTANARI"                                                    // 10th AI script name
          "script11"   = "BPDEMON"                                                     // Big Picture demon script
          "script12"   = "BPTANARI"                                                    // Big Picture script
          "script13"   = "DW2MC4GE"                                                    // Stratagems melee script
		  "script14"   = "DW2MC0GE"                                                    // Stratagems melee script
		  "script15"   = "DW2MC4GE"                                                    // Stratagems melee script
		  "script16"   = "DW2MS0GE"                                                    // Stratagems melee script
		  "script17"   = "DW1MELGE"                                                    // Stratagems melee script
		  "script18"   = "DW2MM2GE"                                                    // Stratagems melee script
          "script19"   = "TANARI_"                                                     // EET
 		  "script20"   = "DEMBAL01"                                                    // TDD demon script
 		  "script21"   = "DEMNAB2"                                                     // RoT Gauntlet demon script
		  "script22"   = "F_TANARI"                                                    // Drizzt Saga demon script
		  "script23"   = "WTASI2"                                                      // RoT melee script
		  "script24"   = "F_DEMDRG"                                                    // Drizzt Saga demon script
		  "script25"   = "F_ERRTU"                                                     // Drizzt Saga demon script
		  "skipfile01" = "tg#dem2"                                                     // Refinement Demon
		  "skipfile02" = "FINNABAS"                                                    // Ascension demon script
      END                                                                              // ends FUNCTION call
    END
    PATCH_IF FiendsScripts = 0 BEGIN                                                   // Only do this if we're not just adding aTweaks scripting
    // LAUNCH_PATCH_FUNCTION fire_spell_immunities END                                    // grant immunities to fire-based area effect spells
    // LAUNCH_PATCH_FUNCTION electrical_spell_immunities END                              // grant immunities to electricity-based area effect spells
      LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~                                        // delete the EFF with the designated opcode
        INT_VAR opcode_to_delete = "193" END                                           // mark opcode #193 (Invisible Detection by Script) for deletion
    END
    PATCH_FOR_EACH ~spell~ IN                                                          // grant immunity to each of the following spells (prevents AI quirks)
                ~RR#PR211~                                                             // Nabassu's own Silence 15' Radius
    BEGIN                                                                              // execute the following
      LAUNCH_PATCH_FUNCTION ~ADD_CRE_EFFECT~                                           // Starts FUNCTION call (add new creature effect built-in function)
        INT_VAR                                                                        // initialize variables
          "opcode" = "206"                                                             // effect: #206 (Protection from spell)
          "target" = "1"                                                               // target: 1 (self)
          "timing" = "9"                                                               // timing mode: 9 (permanent after death)
          "duration" = "0"                                                             // duration: 0
          "sectype" = "0"                                                              // secondary type: none
          "probability1" = "100"                                                       // probability1: 100%
        STR_VAR                                                                        // initialize strings
          "resource"  = EVALUATE_BUFFER "%spell%"                                      // resref: the current spell
          "effsource" = ""                                                             // effsource: none
      END                                                                              // ends FUNCTION
    END
    PATCH_IF ("%SOURCE_RES%" STRING_EQUAL_CASE ~_TANAR~) BEGIN                         // special case, Tutu's Aec'Letec needs a proper immunity item
      // REPLACE_CRE_ITEM ~RINGDEMN~ #0 #0 #0 ~UNSTEALABLE&UNDROPPABLE~ ~LRING~           // replace the Tutu fiend immunty ring with the BG2 version
      WRITE_LONG 0x14 0                                                                // XP value nulled as it's handled via script for Aec'Letec
    END
    PATCH_IF ("%SOURCE_RES%" STRING_EQUAL_CASE ~TANAR~) BEGIN                          // special case, Aec'Letec's XP value on BGT
      WRITE_LONG 0x14 0                                                                // XP value nulled as it's handled via script for Aec'Letec
    END
    PATCH_IF ((IDS_OF_SYMBOL (~animate~ ~NABASSU~)) > 0) BEGIN 						   // Infinity Animation Compatibility (IAv5b)
      WRITE_LONG 0x28 (IDS_OF_SYMBOL (~animate~ ~NABASSU~))	              		   	   // Use IA nabassu apperance
	  WRITE_BYTE 0x2d 36      														   // Minor color (LIGHT_DIRTY_YELLOW)
	  WRITE_BYTE 0x2e 20      														   // Major color (DARK_MOLDY_GREEN)
	  WRITE_BYTE 0x2f 20      														   // Skin color
	  LPF DELETE_CRE_EFFECT
		INT_VAR opcode_to_delete = 51 												   // Strong-dark by RGB
		END
	END
    // =============================================================================== // the actual work ends here
  END                                                                                  // ends file validity check
END


DEFINE_PATCH_FUNCTION make_glabrezu BEGIN
  PATCH_INCLUDE ~aTweaks/lib/fj_cre_validity.tpp~                                      // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
  PATCH_IF valid BEGIN
    PATCH_INCLUDE ~aTweaks/lib/fj_cre_reindex.tpp~                                     // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
    // =============================================================================== // the actual work starts from here
    REMOVE_CRE_ITEM ~DW#SUMFI~                                                         // removes DW#SUMFI.ITM (SCSII's fiend immunities, prevents conflict)
    REMOVE_CRE_ITEM ~HELMNOAN~                                                         // removes HELMNOAN.ITM (no critical hit immunity in PnP)
    REMOVE_KNOWN_SPELLS                                                                // Remove all known spells from the current creature
    REMOVE_MEMORIZED_SPELLS                                                            // Remove all memorized spells from the current creature
    REPLACE_CRE_ITEM ~RR#DGLA2~ #0 #0 #0 ~UNDROPPABLE~ ~RRING~                         // PnP Glabrezu immunities 
    REPLACE_CRE_ITEM ~IMMUNE2~ #0 #0 #0 ~UNSTEALABLE&UNDROPPABLE~ ~LRING~              // add immunity to +1 weapons and below
    REPLACE_CRE_ITEM ~RR#DGLAB~ #0 #0 #0 ~UNDROPPABLE~ ~WEAPON1~ EQUIP                 // replace default weapon with a less powerful weapon (closer to PnP damage output)
    PATCH_IF ("%SOURCE_RES%" STRING_EQUAL_CASE ~ABYDEM01~) BEGIN                       // special case for the replaced Planar Sphere Tanar'ri
     SAY NAME1 #38955 SAY NAME2 #38955                                                 // change name to Glabrezu (was Tanar'ri)
      // REPLACE_CRE_ITEM ~IMMUNE2~ #0 #0 #0 ~UNSTEALABLE&UNDROPPABLE~ ~LRING~                // add immunity to +1 weapons and below
    END
    newxpv = 12000
    LPM update_fiend_xp
    PATCH_IF FiendsScripts = 0 BEGIN                                                   // Only do this if we're not just adding aTweaks scripting
      LAUNCH_PATCH_FUNCTION ~RR#MDCRE~                                                 // Starts FUNCTION call (aTweaks' Creature Modification function)
        INT_VAR                                                                        // Initialize variables
           newxpv
          "newmove"  = "11"                                                            // new movement rate
          "rr#bump"  = "1"                                                             // NPC bump (1 = enable)
          "newhp"    = "80"                                                            // new hit point value
          "newac"    = "-7"                                                            // new Armor Class value
          "newth"    = "11"                                                            // new THAC0 value
          "newapr"   = "5"                                                             // new number of attacks per round
          "newsvd"   = "8"                                                             // new Save vs. Death
          "newsvw"   = "10"                                                            // new Save vs. Wand
          "newsvp"   = "9"                                                             // new Save vs. Polymorph
          "newsvb"   = "9"                                                             // new Save vs. Breath
          "newsvs"   = "11"                                                            // new Save vs. Spell
          "newmr"    = "50"                                                            // new Magic Resistance value
          "newfr"    = "100"                                                           // new Resist Fire value
          "newcr"    = "50"                                                            // new Resist Cold value
          "newer"    = "100"                                                           // new Resist Electricity value
          "newar"    = 0                                                               // new Resist Acid value
          "newlvl1"  = "10"                                                            // new level (first class)
          "newstr"   = "20"                                                            // new Strength value
          "newint"   = "16"                                                            // new Intelligence value
          "newwis"   = "13"                                                            // new Wisdom value
          "newdex"   = "18"                                                            // new Dexterity value
          "newcon"   = "20"                                                            // new Constitution value
          "newchr"   = "22"                                                            // new Charisma value
          "newmor"   = "18"                                                            // new morale value
          "newmorb"  = "3"                                                             // new morale break value
          "newmorr"  = "15"                                                            // new morale recovery value
          "newrace"  = "121"                                                           // new race (Demonic)
          "newclass" = "160"                                                           // new class (Tanari)
          "newalign" = "51"                                                            // new alignment (Chaotic Evil)
        STR_VAR                                                                        // initialize strings
          "enfc01"   = "DEMGLA01"                                                      // enforced creature 1 (uses strict PnP values)
          "enfc02"   = "DEMGLAB"                                                       // enforced creature 2 (uses strict PnP values)
          "enfc03"   = "DGLAB01"                                                       // enforced creature 3 (uses strict PnP values)
          "enfc04"   = "TELTAN1"                                                       // enforced creature 4 (uses strict PnP values)
          "enfc05"   = "TELTAN2"                                                       // enforced creature 5 (uses strict PnP values)
          "enfc06"   = "demglasu"                                                      // enforced creature 6 (uses strict PnP values) 
          "enfc07"   = "demglab2"                                                      // enforced creature 7 (uses strict PnP values)
          "enfc08"   = "gortan4"                                                       // enforced creature 8 (uses strict PnP values)
          "emfc09"   = "jondem01"                                                      // enforced creature 9 (uses strict PnP values)
          "emfc10"   = "jondem03"                                                      // enforced creature 10 (uses strict PnP values)
          "enfc11"   = "jondem05"                                                      // enforced creature 11 (uses strict PnP values)  
          "enfc12"   = "abydem01"                                                      // enforced creature 12 (uses strict PnP values)
          "enfc13"   = "dw#drxg1"                                                      // enforced creature 13 (uses strict PnP values)
          "enfc14"   = "dw#drxg2"                                                      // enforced creature 14 (uses strict PnP values)
          "enfc15"   = "dw#sengl"                                                      // enforced creature 15 (uses strict PnP values)
          "enfc16"   = "BSGLABRE"                                                      // enforced creature 16 (uses strict PnP values)
          "enfc17"   = "eastdem1"                                                      // enforced creature 17 (uses strict PnP values)
          "enfc18"   = "eastdem3"                                                      // enforced creature 18 (uses strict PnP values)
          "enfc19"   = "eastdem5"                                                      // enforced creature 19 (uses strict PnP values)
          "enfc20"   = "eastdem6"                                                      // enforced creature 20 (uses strict PnP values)
          "enfc21"   = "eastdem8"                                                      // enforced creature 21 (uses strict PnP values)
          "enfc22"   = "FINGLAB"                                                       // enforced creature 22 (uses strict PnP values)
          "enfc23"   = "PSGLAB"                                                        // enforced creature 23 (uses strict PnP values)
      END                                                                              // ends FUNCTION call
    END
    PATCH_IF "%file%" STRING_COMPARE_CASE demglasu BEGIN
      LAUNCH_PATCH_FUNCTION ~RR#MDCSC~                                                 // Starts FUNCTION call (aTweaks' Creature Script Modification function)
        STR_VAR                                                                        // Initialize strings
          "newscript"  = "rr#hglab"                                                    // new AI script
          "script01"   = ""                                                            // 1st AI script name
          "script02"   = "None"                                                        // 2nd AI script name
          "script03"   = "WTASIGHT"                                                    // 3rd AI script name
          "script04"   = "MELGLAB"                                                     // 4th AI script name
          "script05"   = "DEMGLAB"                                                     // 5th AI script name
          "script06"   = "DEMGLAB2"                                                    // 6th AI script name
          "script07"   = "GLABREZ"                                                     // 7th AI script name
          "script08"   = "DEMGAJ"                                                      // 8th AI script name
          "script09"   = "TELTAN1"                                                     // 9th AI script name
          "script10"   = "TELTAN2"                                                     // 10th AI script name
          "script11"   = "TANARI"                                                      // 11th AI script name
          "script12"   = "BPDEMON"                                                     // Big Picture demon script
          "script13"   = "BPTANARI"                                                    // Big Picture Tanar'ri script
          "script14"   = "DW2MS2GE"                                             	   // Stratagems melee script
		  "script15"   = "DW2MC4GE"                 		                           // Stratagems melee script
		  "script16"   = "DW2MC3GE"                                                    // Stratagems melee script
		  "script17"   = "DW2MS0GE"                 		                           // Stratagems melee script
          "script18"   = "DW2MC0GE"                                                    // Stratagems melee script
		  "script19"   = "DEMGLAB4"                                                    // RoT demon script
		  "script20"   = "DEMGLAB3"                                                    // RoT demon script
		  "script21"   = "DEMPTJ"                                                      // TDD demon script
		  "script22"   = "BSGLABRE"                                                    // BST demon script
		  "script23"   = "KISHDEMO"                                                    // NPC stronghold demon script
		  "script24"   = "WTASI2"                                                      // RoT melee script
		  "script25"   = "WTASI3"                                                      // RoT melee script
		  "skipfile01" = "CULTMO1"                                                     // RoT Demon
		  "skipfile02" = "PSGLAB"                                                     // RoT Demon
		  "skipfile03" = "FINGLAB"													   // Ascension demon script
		END                                                                            // ends FUNCTION call
    END
    PATCH_IF FiendsScripts = 0 BEGIN                                                   // Only do this if we're not just adding aTweaks scripting
    // LAUNCH_PATCH_FUNCTION fire_spell_immunities END                                    // grant immunities to fire-based area effect spells
    // LAUNCH_PATCH_FUNCTION electrical_spell_immunities END                              // grant immunities to electricity-based area effect spells
    // LAUNCH_PATCH_FUNCTION acid_spell_immunities END                                    // grant immunities to acid-based area effect spells
      LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~                                        // delete the EFF with the designated opcode
        INT_VAR opcode_to_delete = "16" END                                            // mark opcode #16 (Haste) for deletion
    END
    WRITE_LONG 0x28 "57585"                                                           // special case, Glabrezu should use the IC_GLAB avatar
    END
    // =============================================================================== // the actual work ends here
  END                                                                                  // ends file validity check


DEFINE_PATCH_FUNCTION make_marilith BEGIN
  PATCH_INCLUDE ~aTweaks/lib/fj_cre_validity.tpp~                                     // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
  PATCH_IF valid BEGIN
    PATCH_INCLUDE ~aTweaks/lib/fj_cre_reindex.tpp~                                     // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
    // =============================================================================== // the actual work starts from here
    REMOVE_CRE_ITEM ~DW#SUMFI~                                                         // removes DW#SUMFI.ITM (SCSII's fiend immunities, prevents conflict)
    REMOVE_CRE_ITEM ~HELMNOAN~                                                         // removes HELMNOAN.ITM (no critical hit immunity in PnP)
    REMOVE_CRE_ITEM ~MARILI~                                                           // removes MARILI.ITM (vanilla off-hand weapon)
    REMOVE_KNOWN_SPELLS                                                                // Remove all known spells from the current creature
    REMOVE_MEMORIZED_SPELLS                                                            // Remove all memorized spells from the current creature
    REPLACE_CRE_ITEM ~RR#DMARI~ #0 #0 #0 ~UNDROPPABLE~ ~WEAPON1~ EQUIP                 // replace default weapon with a less powerful weapon (closer to PnP damage output)
    REPLACE_CRE_ITEM ~RR#DMARL~ #0 #0 #0 ~UNDROPPABLE~ ~SHIELD~ 	                   // replace left hand weapon with a Tail attack
    REPLACE_CRE_ITEM ~RR#DTANA~ #0 #0 #0 ~UNDROPPABLE~ ~RRING~                         // replace undead immunities with fiend immunities 
    REPLACE_CRE_ITEM ~IMMUNE2~ #0 #0 #0 ~UNSTEALABLE&UNDROPPABLE~ ~LRING~              // add immunity to +1 weapons and below
    ADD_CRE_ITEM ~IPSION~ #0 #0 #0 ~UNDROPPABLE~ ~AMULET~                              // add protection from all mind-affecting spells
    // PATCH_IF ("%SOURCE_RES%" STRING_EQUAL_CASE ~OBSDEM01~) BEGIN                       // special case for Lea'liyl (named Marilith within the Planar Sphere)
      // REPLACE_CRE_ITEM ~IMMUNE2~ #0 #0 #0 ~UNSTEALABLE&UNDROPPABLE~ ~LRING~            // add immunity to +1 weapons and below
    // END
    newxpv = 23000
    LPM update_fiend_xp
    PATCH_IF FiendsScripts = 0 BEGIN                                                   // Only do this if we're not just adding aTweaks scripting
      LAUNCH_PATCH_FUNCTION ~RR#MDCRE~                                                 // Starts FUNCTION call (aTweaks' Creature Modification function)
        INT_VAR                                                                        // Initialize variables
           newxpv
          "rr#ptwf"  = "1"                                                             // perfect two weapon fighting
          "rr#bsimm" = "1"                                                             // Backstab immunity (1 = enable)
          "rr#bump"  = "1"                                                             // NPC bump (1 = enable)
          "newmove"  = "11"                                                            // new movement rate
          "newhp"    = "96"                                                            // new hit point value
          "newac"    = "-9"                                                            // new Armor Class value
          "newth"    = "9"                                                             // new THAC0 value
          "newapr"   = "4"                                                             // new number of attacks per round
          "newsvd"   = "7"                                                             // new Save vs. Death
          "newsvw"   = "9"                                                             // new Save vs. Wand
          "newsvp"   = "8"                                                             // new Save vs. Polymorph
          "newsvb"   = "8"                                                             // new Save vs. Breath
          "newsvs"   = "10"                                                            // new Save vs. Spell
          "newmr"    = "70"                                                            // new Magic Resistance value
          "newfr"    = "100"                                                           // new Resist Fire value
          "newcr"    = "50"                                                            // new Resist Cold value
          "newer"    = "100"                                                           // new Resist Electricity value
          "newlvl1"  = "12"                                                            // new level (first class)
          "newstr"   = "19"                                                            // new Strength value
          "newint"   = "18"                                                            // new Intelligence value
          "newwis"   = "15"                                                            // new Wisdom value
          "newdex"   = "18"                                                            // new Dexterity value
          "newcon"   = "21"                                                            // new Constitution value
          "newchr"   = "20"                                                            // new Charisma value
          "newmor"   = "18"                                                            // new morale value
          "newmorb"  = "3"                                                             // new morale break value
          "newmorr"  = "15"                                                            // new morale recovery value
          "newrace"  = "121"                                                           // new race (Demonic)
          "newclass" = "160"                                                           // new class (Tanari)
          "newgendr" = "2"                                                             // new gender (Female)
          "newsex"   = "2"                                                             // new sex (Female)
          "newalign" = "51"                                                            // new alignment (Chaotic Evil)
        STR_VAR                                                                        // initialize strings
          "enfc01"   = "DEMOSUM1"                                                      // enforced creature 1 (uses strict PnP values)
          "enfc02"   = "ICMARILI"                                                      // enforced creature 2 (uses strict PnP values)
          "enfc03"   = "OBSDEM01"                                                      // enforced creature 3 (uses strict PnP values)
          "enfc04"   = "d0qpwima"                                                      // enforced creature 4 (uses strict PnP values)
          "enfc05"   = "dw#grmar"                                                      // enforced creature 5 (uses strict PnP values)
          "enfc06"   = "FINMARIL"                                                      // enforced creature 6 (uses strict PnP values)
          "enfc07"   = "F_MARI"                                                        // enforced creature 7 (uses strict PnP values)
          "enfc08"   = "CADDEM6"                                                       // enforced creature 8 (uses strict PnP values)
          "enfc09"   = "CADDEM14"                                                      // enforced creature 9 (uses strict PnP values)
          "enfc10"   = "HELDEM1"                                                       // enforced creature 10 (uses strict PnP values)
          "enfc11"   = "HELDEM2"                                                       // enforced creature 11 (uses strict PnP values)
          "enfc12"   = "MARIL"                                                         // enforced creature 12 (uses strict PnP values)
      END                                                                              // ends FUNCTION call
    END
    LAUNCH_PATCH_FUNCTION ~RR#MDCSC~                                                   // Starts FUNCTION call (aTweaks' Creature Script Modification function)
      STR_VAR                                                                          // Initialize strings
        "newscript"  = "RR#HMARI"                                                      // new AI script
        "script01"   = ""                                                              // first AI script name
        "script02"   = "None"                                                          // second AI script name
        "script03"   = "WTASIGHT"                                                      // third AI script name
        "script04"   = "ICMARILI"                                                      // fourth AI script name
        "script05"   = "MELMARI"                                                       // fifth AI script name
        "script06"   = "MARILITH"                                                      // sixth AI script name
        "script07"   = "YTOSSI"                                                        // seventh AI script name
        "script08"   = "BPDEMON"                                                       // Big Picture demon script
        "script09"   = "TANARI"                                                        // generic Tanar'ri script
        "script10"   = "GRPSHT01"                                                      // generic shout script
        "script11"   = "BPTANARI"                                                      // Big Picture Tanar'ri script
        "script12"   = "BPMARILI"                                                      // Planar Sphere Mod melee script
		"script13"   = "DW2MS3GE"                                             		   // Stratagems melee script
		"script14"   = "DW2MS0GE"                                                      // Stratagems melee script
		"script15"   = "DW2MS4GE"                                                      // Stratagems melee script
		"script16"   = "F_MARI"                                                        // Drizzt Saga Demon script
		"script17"   = "WTASI2"                                                        // Drizzt Saga Demon script
		"script18"   = "O#DAEFIG"                                                      // melee script
		"skipfile01" = "Z_2spe2"                                                       // Tales of Anegh Demon
		"skipfile02" = "PSMARI1"                                                       // Planar Sphere Mod
		"skipfile03" = "PSMARI2"                                                       // Planar Sphere Mod
		"skipfile04" = "YUXBOSSA"                                                      // TDD Mod
		"skipfile05" = "FINMARIL"                 		                               // Ascension demon script
    END                                                                                // ends FUNCTION call
    PATCH_IF FiendsScripts = 0 BEGIN                                                   // Only do this if we're not just adding aTweaks scripting
    // LAUNCH_PATCH_FUNCTION fire_spell_immunities END                                    // grant immunities to fire-based area effect spells
    // LAUNCH_PATCH_FUNCTION electrical_spell_immunities END                              // grant immunities to electricity-based area effect spells
      LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~                                        // delete the EFF with the designated opcode
        INT_VAR opcode_to_delete = "1" END                                             // mark opcode #1 (Attacks Per Round Modifier) for deletion
      LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~                                        // delete the EFF with the designated opcode
        INT_VAR opcode_to_delete = "16" END                                            // mark opcode #16 (Haste) for deletion
      LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~                                        // delete the EFF with the designated opcode
        INT_VAR opcode_to_delete = "98" END                                            // mark opcode #98 (Regeneration) for deletion
      LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~ INT_VAR opcode_to_delete = "126" END   // mark opcode #126 (Movement Modifier) for deletion
      LAUNCH_PATCH_FUNCTION ~DELETE_CRE_EFFECT~ INT_VAR opcode_to_delete = "176" END   // mark opcode #176 (Movement Modifier II) for deletion
    END
    WRITE_BYTE  0x2E "26"                                                              // major color (wood)
	
	PATCH_IF !((LONG_AT 0x28 = 20522) OR (LONG_AT 0x28 = 20562)) BEGIN			       // Compatibility with Marilith_IWD animation from IA
      WRITE_LONG 0x28 "57488"                                                          // special case, all Mariliths should use the proper avatar
	END
    // =============================================================================== // the actual work ends here
  END                                                                                  // ends file validity check
END


DEFINE_PATCH_FUNCTION make_balor BEGIN
  PATCH_INCLUDE ~aTweaks/lib/fj_cre_validity.tpp~                                      // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
  PATCH_IF valid BEGIN
    PATCH_INCLUDE ~aTweaks/lib/fj_cre_reindex.tpp~                                     // Nythrun's CRE reindex macro (this also calls the EFF macro if needed)
    // =============================================================================== // the actual work starts from here
    REMOVE_CRE_ITEM ~DW#SUMFI~                                                         // removes DW#SUMFI.ITM (SCSII's fiend immunities, prevents conflict)
    REMOVE_CRE_ITEM ~HELMNOAN~                                                         // removes HELMNOAN.ITM (no critical hit immunity in PnP)
    REMOVE_KNOWN_SPELLS                                                                // Remove all known spells from the current creature
    REMOVE_MEMORIZED_SPELLS                                                            // Remove all memorized spells from the current creature
    REPLACE_CRE_ITEM ~RR#DBAL3~ #0 #0 #0 ~UNDROPPABLE~ ~RRING~                         // replace undead immunities with fiend immunities 
    REPLACE_CRE_ITEM ~IMMUNE3~ #0 #0 #0 ~UNSTEALABLE&UNDROPPABLE~ ~LRING~              // add immunity to +2 weapons and below
    REPLACE_CRE_ITEM ~RR#DBALR~ #0 #0 #0 ~UNDROPPABLE~ ~WEAPON1~ EQUIP                 // replace right hand weapon with a Vorpal Sword
    REPLACE_CRE_ITEM ~RR#DBAL2~ #0 #0 #0 ~UNDROPPABLE~ ~SHIELD~                        // replace left hand weapon with a Flaming Whip
    SET_BG2_PROFICIENCY PROFICIENCY2WEAPON 3
    LPF minimum_proficiency
      INT_VAR
        value = 1
        proficiency = IDS_OF_SYMBOL (stats PROFICIENCYLONGSWORD)
    END
    LPF minimum_proficiency
      INT_VAR
        value = 1
        proficiency = IDS_OF_SYMBOL (stats PROFICIENCYFLAILMORNINGSTAR)
    END
    WRITE_BYTE 0x72 0                                                                  // BG1 Proficiency slot (blunt)
    newxpv = 26000
    LPM update_fiend_xp
    PATCH_IF FiendsScripts = 0 BEGIN                                                   // Only do this if we're not just adding aTweaks scripting
      LAUNCH_PATCH_FUNCTION ~RR#MDCRE~                                                 // Starts FUNCTION call (aTweaks' Creature Modification function)
        INT_VAR                                                                        // Initialize variables
           newxpv
         "rr#sinv"  = "1"                                                              // See invisible creatures (1 = enable)
         "rr#bsimm" = "1"                                                              // Backstab immunity (1 = enable)
         "newmove"  = "11"                                                             // new movement rate
         "rr#bump"  = "1"                                                              // NPC bump (1 = enable)
          "newhp"    = "104"                                                           // new hit point value
          "newac"    = "-8"                                                            // new Armor Class value
          "newth"    = "7"                                                             // new THAC0 value
          "newapr"   = "1"                                                             // new number of attacks per round
          "newsvd"   = "5"                                                             // new Save vs. Death
          "newsvw"   = "7"                                                             // new Save vs. Wand
          "newsvp"   = "6"                                                             // new Save vs. Polymorph
          "newsvb"   = "5"                                                             // new Save vs. Breath
          "newsvs"   = "8"                                                             // new Save vs. Spell
          "newmr"    = "70"                                                            // new Magic Resistance value
          "newfr"    = "100"                                                           // new Resist Fire value
          "newcr"    = "50"                                                            // new Resist Cold value
          "newer"    = "100"                                                           // new Resist Electricity value
          "newlvl1"  = "20"                                                            // new level (first class)
          "newstr"   = "21"                                                            // new Strength value
          "newint"   = "20"                                                            // new Intelligence value
          "newwis"   = "16"                                                            // new Wisdom value
          "newdex"   = "18"                                                            // new Dexterity value
          "newcon"   = "20"                                                            // new Constitution value
          "newchr"   = "25"                                                            // new Charisma value
          "newmor"   = "18"                                                            // new morale value
          "newmorb"  = "3"                                                             // new morale break value
          "newmorr"  = "15"                                                            // new morale recovery value
          "newrace"  = "121"                                                           // new race (Demonic)
          "newclass" = "160"                                                           // new class (Tanari)
          "newalign" = "51"                                                            // new alignment (Chaotic Evil)
        STR_VAR                                                                        // initialize strings
          "enfc01"   = "BALOR01"                                                       // enforced creature 1 (uses strict PnP values)
          "enfc02"   = "DEMBAL01"                                                      // enforced creature 2 (uses strict PnP values)
          "enfc03"   = "DEMBAL02"                                                      // enforced creature 3 (uses strict PnP values)
          "enfc04"   = "UDBALOR"                                                       // enforced creature 4 (uses strict PnP values)
          "enfc05"   = "telbal1"                                                       // enforced creature 5 (uses strict PnP values)
          "enfc06"   = "telbal2"                                                       // enforced creature 6 (uses strict PnP values) 
          "enfc07"   = "gordem"                                                        // enforced creature 7 (uses strict PnP values)
          "enfc08"   = "gordemc1"                                                      // enforced creature 8 (uses strict PnP values)
          "enfc09"   = "jondem02"                                                      // enforced creature 9 (uses strict PnP values)
          "enfc10"   = "jondem04"                                                      // enforced creature 10 (uses strict PnP values)
          "enfc11"   = "sudemon"                                                       // enforced creature 11 (uses strict PnP values)
          "enfc12"   = "sudemon2"                                                      // enforced creature 12 (uses strict PnP values)
          "enfc13"   = "sudemde1"                                                      // enforced creature 13 (uses strict PnP values)
          "enfc14"   = "sudemde2"                                                      // enforced creature 14 (uses strict PnP values)
          "enfc15"   = "sudemw1"                                                       // enforced creature 15 (uses strict PnP values)
          "notenf01" = "ACQ17003"                                                      // non-enforced creature 1 (uses best stat values)
          "notenf02" = "godmari4"                                                      // non-enforced creature 2 (uses best stat values)
          "notenf03" = "caddem1"                                                       // non-enforced creature 3 (uses best stat values)
          "notenf04" = "CADDEM16"                                                      // non-enforced creature 4 (uses best stat values)
          "notenf05" = "CADDEM21"                                                      // non-enforced creature 5 (uses best stat values)
          "notenf06" = "endragor"                                                      // non-enforced creature 6 (uses best stat values)
          "notenf07" = "errtu"                                                         // non-enforced creature 7 (uses best stat values)
          "notenf08" = "f_demdrg"                                                      // non-enforced creature 8 (uses best stat values)
          "notenf09" = "f_tanari"                                                      // non-enforced creature 9 (uses best stat values)
          "notenf10" = "holytana"                                                      // non-enforced creature 10 (uses best stat values)
      END                                                                              // ends FUNCTION call
    END
    LAUNCH_PATCH_FUNCTION ~RR#MDCSC~                                                   // Starts FUNCTION call (aTweaks' Creature Script Modification function)
      STR_VAR                                                                          // Initialize strings
        "newscript"  = "RR#HBALR"                                                      // new AI script
        "script01"   = ""                                                              // first AI script name
        "script02"   = "None"                                                          // second AI script name
        "script03"   = "WTASIGHT"                                                      // third AI script name
        "script04"   = "BALOR01"                                                       // fourth AI script name
        "script05"   = "DEMBAL01"                                                      // fifth AI script name
        "script06"   = "DEMBAL02"                                                      // sixth AI script name
        "script07"   = "DEMOSUM2"                                                      // seventh AI script name
        "script08"   = "ROCKROOM"                                                      // 8th AI script name
        "script09"   = "TELBAL01"                                                      // 9th AI script name
        "script10"   = "MELBALOR"                                                      // 10th AI script name
        "script11"   = "SUDEMON"                                                       // 11th AI script name
        "script12"   = "ATTKNEU2"                                                      // 12th AI script name
        "script13"   = "DEMPTJ"                                                        // 13th AI script name
        "script14"   = "TANARI"                                                        // 14th AI script name
        "script15"   = "BPDEMON"                                                       // Big Picture demon script
        "script16"   = "BPTANARI"                                                      // Big Picture Tanar'ri script
        "script17"   = "dw#subal"                                                      // Stratagems Suldanesselar Balor script
 		"script18"   = "Z#GBALOR"                                                      // Spellhold Gauntlet script
 		"script19"   = "R#DEMON"                                                       // Improved Asylum script
 		"script20"   = "DEMBAL03"                                                      // RoT Demon script
 		"script21"   = "DEMBAL04"                                                      // RoT Demon script
 		"script22"   = "VA#BALOR"                                                      // Tower of Deception script
 		"script23"   = "Z_2BALOR"                                                      // Tales of Anegh script
 		"script24"   = "WTASI2"                                                        // Tales of Anegh script
 		"script25"   = "F_TANARI"                                                      // Drizzt Saga demon script
 		"script26"   = "ERRTU"                                                         // TDD demon script
 		"script27"   = "F_DEMDRG"                                                      // Drizzt Saga demon script
		"script28"   = "Z#GBALOR"                                                      // Tales of Anegh script
		"script29"   = "DW2MS2GE"                                                      // Tales of Anegh script
 		"script30"   = "DW2MS0GE"                                                      // Tales of Anegh script
        "script31"   = "DW2MS4GE"                                                      // Stratagems melee script
        "script32"   = "DW2MC4GE"                                                      // Stratagems melee script
 		"script33"   = "DW2MC0GE"                                                      // Stratagems melee script
 		"script34"   = "DW2MC3GE"                                                      // Stratagems melee script
 		"script35"   = "DW2MS3GE"                                                      // Stratagems melee script
 		"script36"   = "DW2MM2GE"                                                      // Tales of Anegh script
 		"script37"   = "O#LLFIGH"                                                      // melee fighting script
        "skipfile01" = "GORTAN1"                                                       // skip script patching for a designated file
        "skipfile02" = "M05DEMON"                                                      // skip script patching for a designated file
        "skipfile03" = "GORDEMC1"                                                      // skip script patching for a designated file
        "skipfile04" = "tg#did3"                                                       // skip script patching for a designated file
        "skipfile05" = "tg#did4"                                                       // skip script patching for a designated file
        "skipfile06" = "DW#BASUM"                                                      // skip script patching for a designated file
		"skipfile07" = "FINBALOR"													   // Ascension demon script
    END                                                                                // ends FUNCTION call
    PATCH_IF FiendsScripts = 0 BEGIN                                                   // Only do this if we're not just adding aTweaks scripting
      SET_BG2_PROFICIENCY PROFICIENCYLONGSWORD 1
      SET_BG2_PROFICIENCY PROFICIENCYFLAILMORNINGSTAR 1
      // LAUNCH_PATCH_FUNCTION fire_spell_immunities END                                  // grant immunities to fire-based area effect spells
      // LAUNCH_PATCH_FUNCTION electrical_spell_immunities END                            // grant immunities to electricity-based area effect spells
      // LAUNCH_PATCH_FUNCTION hover_immunities END                                       // grant immunities to ground-based spells
      // LAUNCH_PATCH_FUNCTION insect_spell_immunities END                                // add immunity to insect spells
      // LAUNCH_PATCH_FUNCTION web_immunity END                                           // grant immunities to web spells
      // LAUNCH_PATCH_FUNCTION entangle_immunities END                                    // add immunity to Entangle spells and abilities
    END
    PATCH_IF ("%SOURCE_RES%" STRING_EQUAL_CASE ~BALOR01~) BEGIN                        // special case, an (unused?) Balor should be flagged as hostile
      WRITE_BYTE  0x270 "255"                                                          // set initial allegiance to ENEMY
    END
    PATCH_IF ("%SOURCE_RES%" STRING_EQUAL_CASE ~DEMBAL01~) BEGIN                       // special case, an (unused?) Balor should be flagged as hostile
      WRITE_BYTE  0x270 "255"                                                          // set initial allegiance to ENEMY
    END
    // =============================================================================== // the actual work ends here
  END                                                                                  // ends file validity check
END


DEFINE_PATCH_FUNCTION make_ultroloth BEGIN
  PATCH_INCLUDE ~aTweaks/lib/fj_cre_validity.tpp~                                      // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
  PATCH_IF valid BEGIN
    // =============================================================================== // the actual work starts from here
    SAY NAME1 @733 SAY NAME2 @733                                                      //Ultroloth
    WRITE_LONG 0x14 26000
    WRITE_LONG 0x28 25088                                                              //MAGE_MALE_HUMAN
    WRITE_BYTE 0x2c 30                                                                 //Metal color, standard
    WRITE_BYTE 0x2d 19                                                                 //Minor, red
    WRITE_BYTE 0x2e 65                                                                 //Major, black
    WRITE_BYTE 0x2f 63                                                                 //Skin, a sort of grey-purple
    WRITE_BYTE 0x30 65                                                                 //Leather, black
    WRITE_BYTE 0x31 28                                                                 //Armour, standard
    WRITE_BYTE 0x32 63                                                                 //Hair, grey-purple
    REPLACE_CRE_ITEM ~RR#DYUGO~ #0 #0 #0 ~UNDROPPABLE~ ~RRING~                         // replace fiend immunities with pnp Yugoloth immunities 
    REPLACE_CRE_ITEM ~IMMUNE3~ #0 #0 #0 ~UNSTEALABLE&UNDROPPABLE~ ~LRING~              // add immunity to +2 weapons and below
    REPLACE_CRE_ITEM fl#ultr #0 #0 #0 ~UNDROPPABLE~ ~WEAPON1~ EQUIP
    REPLACE_CRE_ITEM fl#yugro #0 #0 #0 ~UNDROPPABLE~ ~ARMOR~
    LAUNCH_PATCH_FUNCTION RR#MDCRE
      INT_VAR
        "newhp"        = 130
        "newac"        = "-8"
        "newth"        = 7
        "newapr"       = 2
        "newsvd"       = 5
        "newsvw"       = 7
        "newsvp"       = 6
        "newsvb"       = 5
        "newsvs"       = 8
        "newlvl1"      = 15
        "newmr"        = 60
        "newfr"        = 100
        "newcr"        = "-100"
        "newer"        = 0
        "newar"        = 100
        "newstr"       = 21
        "newdex"       = 18 
        "newcon"       = 18
        "newint"       = 20
        "newwis"       = 20
        "newchr"       = 25
        "newmor"       = 16
        "newalign"     = 35 //NE
        "newclass"     = 255                                                           //NO_CLASS
        
        "enforce"      = 1
    END
    // LAUNCH_PATCH_FUNCTION fire_spell_immunities END                                    // grant immunities to fire-based area effect spells
    // LAUNCH_PATCH_FUNCTION acid_spell_immunities END                                    // grant immunities to acid-based area effect spells
  END
END


DEFINE_PATCH_FUNCTION make_nycaloth BEGIN
  PATCH_INCLUDE ~aTweaks/lib/fj_cre_validity.tpp~                                      // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
  PATCH_IF valid BEGIN
    // =============================================================================== // the actual work starts from here
    SAY NAME1 @734 SAY NAME2 @734                                                      //Nycaloth   
    WRITE_LONG 0x14 25000
    REPLACE_CRE_ITEM ~RR#DYUGO~ #0 #0 #0 ~UNDROPPABLE~ ~RRING~                         // replace fiend immunities with pnp Yugoloth immunities 
    REPLACE_CRE_ITEM ~IMMUNE2~ #0 #0 #0 ~UNSTEALABLE&UNDROPPABLE~ ~LRING~              // add immunity to +1 weapons and below
    REPLACE_CRE_ITEM ~fl#nyca~ #0 #0 #0 ~UNDROPPABLE~ ~WEAPON1~ EQUIP
    LPF DELETE_CRE_EFFECT INT_VAR opcode_to_delete = 292 END                           //Immunity to backstab 
    PATCH_IF ((IDS_OF_SYMBOL (~animate~ ~NABASSU~)) > 0) BEGIN 						   // Infinity Animation Compatibility (IAv5b)
      WRITE_LONG 0x28 (IDS_OF_SYMBOL (~animate~ ~NABASSU~))	              		   	   // Use IA nabassu apperance  
	  LAUNCH_PATCH_FUNCTION ~ADD_CRE_EFFECT~                                           // Starts FUNCTION call (add new creature effect built-in function)
	  INT_VAR                                                                          // initialize numeric variables
	  "opcode" = "51"                                                                  // effect: #51 (Colour: Strong/Dark by RGB)
	  "target" = "1"                                                                   // target: 1 (self)
	  "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
	  "duration" = "0"                                                                 // duration: 0
	  "sectype" = "0"                                                                  // secondary type: none
	  "parameter1" = "180812288"                                                       // param1: (color designation)
	  "parameter2" = "2"                                                               // param2: 2 (location - major color)
	  "probability1" = "100"                                                           // probability1: 100%
	  END                                                                              // ends FUNCTION call
	  PATCH_FOR_EACH ~rr#color~ IN  ~50~ BEGIN                                         // grant immunity to the color glow/pulse effects (they disrupt aTweaks' re-coloring)
	    LAUNCH_PATCH_FUNCTION ~ADD_CRE_EFFECT~                                           // Starts FUNCTION call
	    INT_VAR                                                                          // initialize variables
	    "opcode" = "101"                                                                 // effect: #101 (Protection from Opcode)
	    "target" = "1"                                                                   // target: 1 (self)
	    "timing" = "9"                                                                   // timing mode: 9 (permanent after death)
	    "duration" = "0"                                                                 // duration: 0
	    "parameter2" = EVALUATE_BUFFER "%rr#color%"                                      // param2: evaluated opcode
	    "sectype" = "0"                                                                  // secondary type: none
	    "probability1" = "100"                                                           // probability1: 100%
	    END
	  END
	END 						   													   // Infinity Animation Compatibility (IAv5b)
    LAUNCH_PATCH_FUNCTION RR#MDCRE
      INT_VAR
        newhp        = 110
        newac        = "-6"
        newth        = 9
        newapr       = 1
        newsvd       = 8
        newsvw       = 10
        newsvp       = 9
        newsvb       = 9
        newsvs       = 11
        newlvl1      = 11
        newmr        = 70
        newfr        = 100
        newcr        = "-100"
        newer        = 0
        newar        = 100 
        newstr       = 20
        newdex       = 18
        newcon       = 18
        newint       = 18 
        newwis       = 18
        newchr       = 16
        newmor       = 16
        newalign     = 35 //NE
        newclass     = 255 //NO_CLASS 
        
        enforce      = 1
    END
    // LAUNCH_PATCH_FUNCTION fire_spell_immunities END                                    // grant immunities to fire-based area effect spells
    // LAUNCH_PATCH_FUNCTION acid_spell_immunities END                                    // grant immunities to acid-based area effect spells
  END
END


DEFINE_PATCH_FUNCTION make_arcanaloth BEGIN
  PATCH_INCLUDE ~aTweaks/lib/fj_cre_validity.tpp~                                      // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
  PATCH_IF valid BEGIN
    // =============================================================================== // the actual work starts from here
    SAY NAME1 @735 SAY NAME2 @735                                                      //Arcanaloth 
    WRITE_LONG 0x14 20000
    WRITE_LONG 0x28 25088                                                              //MAGE_MALE_HUMAN
    WRITE_BYTE 0x2c 30                                                                 //Metal color, standard
    WRITE_BYTE 0x2d 60                                                                 //Minor, purple
    WRITE_BYTE 0x2e 58                                                                 //Major, blue
    WRITE_BYTE 0x2f 8                                                                  //Skin, a sort of brown
    WRITE_BYTE 0x30 58                                                                 //Leather, blue
    WRITE_BYTE 0x31 28                                                                 //Armour, standard
    WRITE_BYTE 0x32 8                                                                  //Hair, brown
    REPLACE_CRE_ITEM ~RR#DYUGO~ #0 #0 #0 ~UNDROPPABLE~ ~RRING~                         // replace fiend immunities with pnp Yugoloth immunities 
    REPLACE_CRE_ITEM ~IMMUNE3~ #0 #0 #0 ~UNSTEALABLE&UNDROPPABLE~ ~LRING~              // add immunity to +2 weapons and below
    REPLACE_CRE_ITEM ~fl#arca1~ #0 #0 #0 ~UNDROPPABLE~ ~WEAPON1~ EQUIP
    REPLACE_CRE_ITEM ~fl#arca2~ #0 #0 #0 ~UNDROPPABLE~ ~SHIELD~
    SET_BG2_PROFICIENCY PROFICIENCY2WEAPON 3
    REPLACE_CRE_ITEM ~fl#yugro~ #0 #0 #0 ~UNDROPPABLE~ ~ARMOR~
    LPF DELETE_CRE_EFFECT INT_VAR opcode_to_delete = 292 END                           //Immunity to backstab
    LPF DELETE_CRE_EFFECT INT_VAR opcode_to_delete = 193 END                           //Invisibility detection
    LAUNCH_PATCH_FUNCTION RR#MDCRE
      INT_VAR
        newhp        = 120
        newac        = "-8"
        newth        = 9
        newapr       = 2
        newsvd       = 10
        newsvw       = 12
        newsvp       = 11
        newsvb       = 12
        newsvs       = 13
        newlvl1      = 12
        newmr        = 60
        newfr        = 100
        newcr        = "-100"
        newer        = 0
        newar        = 100 
        newstr       = 17
        newdex       = 15
        newcon       = 15
        newint       = 20
        newwis       = 18
        newchr       = 19 
        newmor       = 16
        newalign     = 35 //NE
        newclass     = 1 //Mage
        
        enforce      = 1
    END
    // LAUNCH_PATCH_FUNCTION fire_spell_immunities END                                    // grant immunities to fire-based area effect spells
    // LAUNCH_PATCH_FUNCTION acid_spell_immunities END                                    // grant immunities to acid-based area effect spells
    ADD_MEMORIZED_SPELL spwi118 #0 wizard      //Chromatic Orb
    ADD_MEMORIZED_SPELL spwi106 #0 wizard (2)  //Blindness
    ADD_MEMORIZED_SPELL spwi125 #0 wizard      //Spook
    ADD_MEMORIZED_SPELL spwi212 #1 wizard      //Mirror Image 
    ADD_MEMORIZED_SPELL spwi211 #1 wizard (2)  //Melf's Acid Arrow
    ADD_MEMORIZED_SPELL spwi205 #1 wizard      //Horror
    ADD_MEMORIZED_SPELL spwi303 #2 wizard      //Flame Arrow
    ADD_MEMORIZED_SPELL spwi308 #2 wizard      //Lightning Bolt
    ADD_MEMORIZED_SPELL spwi325 #2 wizard (2)  //Melf's Minute Meteors
    ADD_MEMORIZED_SPELL spwi408 #3 wizard      //Stoneskin
    ADD_MEMORIZED_SPELL spwi419 #3 wizard (2)  //Secret Word
    ADD_MEMORIZED_SPELL spwi412 #3 wizard      //Greater Malison
    ADD_MEMORIZED_SPELL spwi507 #4 wizard      //Hold Monster
    ADD_MEMORIZED_SPELL spwi506 #4 wizard      //Domination
    ADD_MEMORIZED_SPELL spwi513 #4 wizard      //Breach
    ADD_MEMORIZED_SPELL spwi508 #4 wizard      //Chaos
    ADD_MEMORIZED_SPELL spwi615 #5 wizard      //Chain Lightning
  END
END


DEFINE_PATCH_FUNCTION make_shadow_fiend BEGIN
  PATCH_INCLUDE ~aTweaks/lib/fj_cre_validity.tpp~                                      // Nythrun's CRE validity macro (detects corrupt and invalid CREs)
  PATCH_IF valid BEGIN
    // =============================================================================== // the actual work starts from here
    REMOVE_CRE_ITEM ~IMMUNE1~                                                          // removes IMMUNE1.ITM (immunity to +1 weapons and below)
    REMOVE_CRE_ITEM ~IMMUNE2~                                                          // removes IMMUNE2.ITM (immunity to +2 weapons and below)
    REMOVE_CRE_ITEM ~RING95~                                                           // removes RING95.ITM (Hunded immunities)
    REPLACE_CRE_ITEM ~RR#DSHA2~ #0 #0 #0 ~UNDROPPABLE~ ~RRING~                         // replace fiend immunities with pnp Shadow Fiend immunities 
	REPLACE_CRE_ITEM fl#shaf1 #0 #0 #0 UNDROPPABLE weapon1 EQUIP
    REPLACE_CRE_ITEM fl#shaf2 #0 #0 #0 UNDROPPABLE shield
    // REMOVE_CRE_ITEM immune1 ring95
    WRITE_BYTE 0x273 255 //NO_CLASS
    LAUNCH_PATCH_FUNCTION RR#MDCRE
      INT_VAR
        newxp        = 2000
        newhp        = 59
        newac        = 5
        newth        = 13
        newapr       = 2
        newsvd       = 13
        newsvw       = 15
        newsvp       = 14
        newsvb       = 16
        newsvs       = 16
        newlvl1      = 17
        newmr        = 0
        newfr        = 100
        newcr        = 100
        newer        = 100
        newar        = 0
        newrs        = 0
        newrc        = 0
        newrp        = 0
        newrm        = 0
        newstr       = 13
        newdex       = 10
        newcon       = 9
        newint       = 12 
        newwis       = 11
        newchr       = 19
        newmor       = 16
        newalign     = 0x33 //CE
        rr#ptwf      = 1
        
        enforce      = 1
	  END
	LAUNCH_PATCH_FUNCTION ~RR#MDCSC~                                                   // Starts FUNCTION call (aTweaks' Creature Script Modification function)
      STR_VAR
        "newscript" = "fl#shafi"
        "script01" = "wtasight"                                                       // third AI script name
        "script02" = "bpmag14m"                                                       // Big Picture mage script
        "script03" = "bpwtsigt"                                                       // Big Picture melee script
        "script04" = "bpshadow"                                                       // Big Picture shadow script
        "script05" = "dw2MC0GE"                                                       // Stratagems melee script
		"script06" = "O#LLENEM"                                                       // Sellswords melee script
	  END
    // LAUNCH_PATCH_FUNCTION fire_spell_immunities END
    // LAUNCH_PATCH_FUNCTION cold_spell_immunities END
    // LAUNCH_PATCH_FUNCTION electrical_spell_immunities END
    // LAUNCH_PATCH_FUNCTION extraplanar_traits END
  END
END
